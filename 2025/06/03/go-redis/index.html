<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>Go-Redis | LeoBlog</title><meta name="keywords" content="Backend,Go,数据库,Redis,缓存"><meta name="author" content="King Leonardo"><meta name="copyright" content="King Leonardo"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="Go-Redis"><meta name="application-name" content="Go-Redis"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="Go-Redis"><meta property="og:url" content="http://example.com/2025/06/03/go-redis/index.html"><meta property="og:site_name" content="LeoBlog"><meta property="og:description" content="这是一篇初学Go的文章，包含项目构建及项目工程化基本流程"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://imgs.161517.xyz/2025/05/10/1003.jpg"><meta property="article:author" content="King Leonardo"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://imgs.161517.xyz/2025/05/10/1003.jpg"><meta name="description" content="这是一篇初学Go的文章，包含项目构建及项目工程化基本流程"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://example.com/2025/06/03/go-redis/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//static.cloudflareinsights.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script defer="defer" data-pjax="data-pjax" src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon="{&quot;token&quot;: &quot;63ee268ee87a46d98e0eeaab5bdafc9a&quot;}"></script><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w","backTitle":"♪(^∇^*)"},
  LA51: undefined,
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: undefined,
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":false,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: King Leonardo","link":"链接: ","source":"来源: LeoBlog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'LeoBlog',
  title: 'Go-Redis',
  postAI: '',
  pageFillDescription: 'Redis 的使用, 1. 环境准备, 1.1 安装 Go Redis 客户端, 1.2 安装和运行 Redis 服务器, 1.3 Redis 配置修改 (Windows), 1.3.1 找到 Redis 配置文件, 1.3.2 主要配置项更改, 1.3.3 重启 Redis (Windows), 1.3.3.1 作为 Windows 服务运行, 1.3.3.2 通过命令行手动运行, 2. 基本 Redis 操作, 2.1 连接 Redis, 2.2 设置和获取字符串, 2.3 设置过期时间, 3. 在 Gin 中集成 Redis, 3.1 初始化 Redis 客户端, 3.2 创建 Gin 路由处理 Redis 操作, 3.3 处理错误, 4. 使用 Redis 作为缓存, 4.1 实现缓存中间件, 4.2 在路由中使用缓存, 5. 高级用法（可选）, 5.1 Redis 连接池, 5.2 使用 Redis 实现分布式锁, 5.3 Pubx2FSub（发布x2F订阅）的使用是一个开源的许可内存数据结构存储可用作数据库缓存和消息代理它支持多种数据结构如字符串哈希列表集合有序集合等在框架中集成可以极大地提高应用程序的性能和可扩展性本教程将介绍如何在应用程序中连接进行基本操作如设置和获取键值以及如何使用进行会话管理和缓存环境准备在开始之前请确保您的开发环境已准备就绪安装客户端我们将使用库作为客户端它是语言中最流行和功能最丰富的客户端之一安装和运行服务器您可以通过多种方式安装和运行服务器推荐最简单快捷的方式或者只运行核心这将启动一个名为的容器并将容器的端口映射到主机的端口手动安装或可以从官方网站下载或使用安装完成后确保服务器正在运行默认监听端口您可以使用来测试连接如果返回则表示连接成功配置修改在系统中通常以服务形式运行或通过命令行手动启动它的行为通过文件进行配置找到配置文件如果您是手动安装文件通常位于您解压安装包的根目录下例如或找到文件后使用记事本或等文本编辑器打开它主要配置项更改以下是一些您可能会经常更改或需要注意的重要配置项及其修改建议请根据您的需求取消注释删除行首的并修改对应的值作用指定服务器监听的地址修改默认情况下可能没有明确的设置或者它会监听所有可用接口如果您需要限制访问可以将其设置为特定地址默认可能没有这一行或只监听本地监听所有可用仅用于测试生产环境请谨慎重要提示在没有密码或防火墙保护的情况下将设置为并暴露在公网是非常危险的作用指定服务器监听的端口修改如果您希望监听非标准端口可以在此修改保持默认或修改为其他端口如作用保护模式在没有设置和密码设置的情况下只允许本地回环地址访问修改强烈建议保持为如果您需要从外部连接且不设置密码不推荐则必须将其设置为但同时需要设置防火墙规则来限制访问作用设置连接密码修改在生产环境中强烈建议设置一个强密码取消注释并替换为您的密码设置您的密码作用设置可用的数据库数量默认有个数据库索引从到修改通常默认值已足够根据您的应用程序需求调整作用设置可用的最大内存量当达到此限制时将根据配置来决定如何处理新数据修改在生产环境中强烈建议设置此项以防止使用过多内存导致系统不稳定设置最大内存为当达到限制时优先删除带有过期时间的键并且删除最少使用的键作用在上这会使作为守护进程后台进程运行在上这个设置通常不生效或行为不同因为服务或控制台程序有自己的后台机制如果您是通过直接运行它通常会占用控制台窗口如果您将其作为服务安装则由服务管理器控制后台运行修改通常无需在下修改此项保持即可代码段作用设置日志级别可选值有修改开发调试阶段可以设置为或生产环境通常设置为或以减少日志量代码段重启修改配置文件后您需要重启服务器以使更改生效重启方式取决于您如何在上运行作为服务运行如果您的实例是作为服务安装并运行的这是推荐的生产环境部署方式可以通过的服务管理器来重启按下键输入然后按回车键打开服务管理器在服务列表中找到名为或类似名称例如的服务右键点击该服务然后选择重启通过命令行手动运行如果您是通过命令行直接运行您需要先停止当前的进程然后重新启动它停止当前进程打开一个新的命令提示符或窗口使用连接到您的实例并发送命令如果设置了密码请添加参数如果运行在控制台窗口中发送命令后该控制台窗口通常会自动关闭使用更新后的配置文件启动服务器打开一个新的命令提示符或窗口导航到所在的目录执行以下命令指定您的配置文件路径或如果配置文件在其他路径这将会在当前控制台窗口中启动如果您想让它在后台运行不占用控制台可以考虑使用命令但通常建议安装为服务重启后您可以使用连接到并执行命令或命令来验证新的配置是否已生效基本操作在使用之前我们先了解库的基本操作连接创建客户端实例服务器地址如果有密码请填写数据库索引默认为命令检查连接应该输出设置和获取字符串设置一个键值对表示永不过期获取键的值如果键不存在删除键再次尝试获取已删除的键设置过期时间可以为键设置过期时间使其在一段时间后自动删除设置一个带过期时间的键秒后过期立即获取等待秒让键过期再次获取应该已经过期在中集成现在我们将把功能集成到应用程序中初始化客户端在应用程序启动时最好只初始化一次客户端并将其作为依赖注入到处理函数中或者存储在一个全局变量中但推荐依赖注入我们通常将客户端实例存储在的中或者作为自定义结构体的字段传递定义一个全局的客户端变量或者通过依赖注入服务器地址如果有密码请填写数据库索引测试连接初始化客户端注册相关的路由创建路由处理操作接下来我们将为操作创建的路由处理函数续处理路由将键值对存储到设置键值对并设置分钟过期时间处理路由从获取键的值处理路由从删除键方法返回受影响的键数量处理错误在实际应用中处理操作可能出现的错误至关重要库在键不存在时会返回错误其他网络或服务器错误则会返回不同的错误类型务必对这些错误进行检查和处理使用作为缓存最常见的用途之一是作为应用程序的缓存层我们可以创建一个中间件来实现简单的缓存功能实现缓存中间件这个中间件将尝试从获取响应如果命中缓存则直接返回如果未命中则继续执行后续处理函数并将结果缓存起来是一个简单的缓存中间件生成缓存键通常使用请求的或更复杂的哈希尝试从获取缓存数据缓存命中直接返回缓存的数据阻止后续处理函数执行如果出错不阻止请求继续执行创建一个响应写入器捕获响应内容继续处理请求检查状态码只缓存成功的响应将响应内容缓存到是一个自定义的用于捕获响应体函数续应用全局中间件设置一个带缓存的路由组将缓存中间件应用于此组缓存秒模拟一个耗时操作非缓存路由在路由中使用缓存在上面的例子中我们已经演示了如何将应用到一个路由组所有该组下的路由都会受益于缓存测试缓存启动服务器第一次访问您会看到日志输出和请求会延迟秒在秒内再次访问您会看到日志输出请求会立即返回且值与第一次相同因为它返回的是缓存的数据等待秒以上再次访问缓存过期您会再次看到和秒延迟值会更新访问每次访问都会立即返回没有缓存高级用法可选连接池客户端本身就包含了连接池管理在中您可以配置等选项来优化连接池行为最大连接数最小空闲连接数从连接池获取连接的超时时间空闲连接的关闭时间使用实现分布式锁当您有多个服务实例需要对共享资源进行互斥访问时可以使用实现分布式锁提供了和命令的封装可以用来构建简单的锁尝试获取分布式锁命令在键不存在时设置键值并设置过期时间如果设置成功返回如果键已存在返回释放分布式锁使用脚本确保原子性检查值是否匹配然后删除键这是为了防止释放了的锁在路由中使用建议使用或其他唯一标识执行需要加锁的业务逻辑模拟业务操作发布订阅支持发布订阅模式允许客户端订阅频道并接收其他客户端发布的消息这在实现实时通知或事件驱动架构时非常有用订阅一个频道确保订阅器在退出时关闭等待订阅就绪获取消息通道在这里处理接收到的消息例如推送到客户端启动一个监听消息发布消息的路由测试运行上面的应用程序访问查看应用程序的控制台输出您会看到表明消息已成功发布并被订阅者接收',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-08-26 23:08:02',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">LeoBlog</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://imgs.161517.xyz/2025/06/02/wechat-pay-qr.jpg" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://imgs.161517.xyz/2025/06/02/wechat-pay-qr.jpg"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://imgs.161517.xyz/2025/06/02/alipay-qr.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://imgs.161517.xyz/2025/06/02/alipay-qr.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Backend/" style="font-size: 1.05rem;">Backend<sup>5</sup></a><a href="/tags/GORM/" style="font-size: 1.05rem;">GORM<sup>1</sup></a><a href="/tags/Gin/" style="font-size: 1.05rem;">Gin<sup>1</sup></a><a href="/tags/Go/" style="font-size: 1.05rem;">Go<sup>4</sup></a><a href="/tags/Hexo/" style="font-size: 1.05rem;">Hexo<sup>1</sup></a><a href="/tags/Redis/" style="font-size: 1.05rem;">Redis<sup>1</sup></a><a href="/tags/Viper/" style="font-size: 1.05rem;">Viper<sup>1</sup></a><a href="/tags/Web-Framework/" style="font-size: 1.05rem;">Web Framework<sup>1</sup></a><a href="/tags/frontend/" style="font-size: 1.05rem;">frontend<sup>1</sup></a><a href="/tags/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/" style="font-size: 1.05rem;">博客搭建<sup>1</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 1.05rem;">数据库<sup>2</sup></a><a href="/tags/%E7%BC%93%E5%AD%98/" style="font-size: 1.05rem;">缓存<sup>1</sup></a><a href="/tags/%E9%85%8D%E7%BD%AE%E8%AF%BB%E5%8F%96/" style="font-size: 1.05rem;">配置读取<sup>1</sup></a><a href="/tags/%E9%A1%B9%E7%9B%AE/" style="font-size: 1.05rem;">项目<sup>2</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/06/"><span class="card-archive-list-date">六月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">7</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/03/"><span class="card-archive-list-date">三月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url">学习笔记</a><i class="anzhiyufont anzhiyu-icon-angle-right post-meta-separator"></i><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E5%90%8E%E7%AB%AF/" itemprop="url">后端</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/Backend/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>Backend</span></a><a class="article-meta__tags" href="/tags/Go/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>Go</span></a><a class="article-meta__tags" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>数据库</span></a><a class="article-meta__tags" href="/tags/Redis/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>Redis</span></a><a class="article-meta__tags" href="/tags/%E7%BC%93%E5%AD%98/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>缓存</span></a></span></div></div><h1 class="post-title" itemprop="name headline">Go-Redis</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-06-03T02:27:15.838Z" title="发表于 2025-06-03 10:27:15">2025-06-03</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-08-26T15:08:02.657Z" title="更新于 2025-08-26 23:08:02">2025-08-26</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">5.2k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>22分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="Go-Redis"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为成都"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>成都</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://imgs.161517.xyz/2025/05/10/1003.jpg"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://example.com/2025/06/03/go-redis/"><header><a class="post-meta-categories" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url">学习笔记</a><a class="post-meta-categories" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E5%90%8E%E7%AB%AF/" itemprop="url">后端</a><a href="/tags/Backend/" tabindex="-1" itemprop="url">Backend</a><a href="/tags/Go/" tabindex="-1" itemprop="url">Go</a><a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" tabindex="-1" itemprop="url">数据库</a><a href="/tags/Redis/" tabindex="-1" itemprop="url">Redis</a><a href="/tags/%E7%BC%93%E5%AD%98/" tabindex="-1" itemprop="url">缓存</a><h1 id="CrawlerTitle" itemprop="name headline">Go-Redis</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">King Leonardo</span><time itemprop="dateCreated datePublished" datetime="2025-06-03T02:27:15.838Z" title="发表于 2025-06-03 10:27:15">2025-06-03</time><time itemprop="dateCreated datePublished" datetime="2025-08-26T15:08:02.657Z" title="更新于 2025-08-26 23:08:02">2025-08-26</time></header><h1 id="Redis-的使用"><a href="#Redis-的使用" class="headerlink" title="Redis 的使用"></a>Redis 的使用</h1><p>Redis 是一个开源的（BSD 许可）内存数据结构存储，可用作数据库、缓存和消息代理。它支持多种数据结构，如字符串、哈希、列表、集合、有序集合等。在 Gin 框架中集成 Redis 可以极大地提高应用程序的性能和可扩展性。</p>
<p>本教程将介绍如何在 Gin 应用程序中连接 Redis、进行基本操作（如设置和获取键值）、以及如何使用 Redis 进行会话管理和缓存。</p>
<h2 id="1-环境准备"><a href="#1-环境准备" class="headerlink" title="1. 环境准备"></a>1. 环境准备</h2><p>在开始之前，请确保您的开发环境已准备就绪。</p>
<h3 id="1-1-安装-Go-Redis-客户端"><a href="#1-1-安装-Go-Redis-客户端" class="headerlink" title="1.1 安装 Go Redis 客户端"></a>1.1 安装 Go Redis 客户端</h3><p>我们将使用 <code>go-redis/redis/v8</code> 库作为 Redis 客户端。它是 Go 语言中最流行和功能最丰富的 Redis 客户端之一。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get -u github.com/go-redis/redis/v8</span><br></pre></td></tr></table></figure>

<h3 id="1-2-安装和运行-Redis-服务器"><a href="#1-2-安装和运行-Redis-服务器" class="headerlink" title="1.2 安装和运行 Redis 服务器"></a>1.2 安装和运行 Redis 服务器</h3><p>您可以通过多种方式安装和运行 Redis 服务器：</p>
<ul>
<li><p><strong>Docker (推荐)</strong>：最简单快捷的方式。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run --name my-redis -p 6379:6379 -d redis/redis-stack-server:latest</span><br><span class="line">    <span class="comment"># 或者只运行 Redis 核心</span></span><br><span class="line">    <span class="comment"># docker run --name my-redis -p 6379:6379 -d redis:latest</span></span><br></pre></td></tr></table></figure>

<p>这将启动一个名为 <code>my-redis</code> 的 Redis 容器，并将容器的 6379 端口映射到主机的 6379 端口。</p>
</li>
<li><p><strong>手动安装</strong>：</p>
<ul>
<li><strong>macOS (Homebrew)</strong>: <code>brew install redis</code></li>
<li><strong>Linux (apt&#x2F;yum)</strong>: <code>sudo apt update &amp;&amp; sudo apt install redis-server</code> 或 <code>sudo yum install redis</code></li>
<li><strong>Windows</strong>: 可以从官方网站下载或使用 WSL2。</li>
</ul>
</li>
</ul>
<p>安装完成后，确保 Redis 服务器正在运行（默认监听 6379 端口）。您可以使用 <code>redis-cli ping</code> 来测试连接。如果返回 <code>PONG</code> 则表示连接成功。</p>
<h3 id="1-3-Redis-配置修改-Windows"><a href="#1-3-Redis-配置修改-Windows" class="headerlink" title="1.3 Redis 配置修改 (Windows)"></a>1.3 Redis 配置修改 (Windows)</h3><p>在 Windows 系统中，Redis 通常以服务形式运行或通过命令行手动启动。它的行为通过 <strong><code>redis.windows.conf</code></strong> 文件进行配置。</p>
<h4 id="1-3-1-找到-Redis-配置文件"><a href="#1-3-1-找到-Redis-配置文件" class="headerlink" title="1.3.1 找到 Redis 配置文件"></a>1.3.1 找到 Redis 配置文件</h4><p>如果您是手动安装 Redis for Windows，<code>redis.windows.conf</code> 文件通常位于您解压 Redis 安装包的根目录下。</p>
<p>例如：<code>C:\Program Files\Redis\redis.windows.conf</code> 或 <code>C:\redis-x.x.x\redis.windows.conf</code>。</p>
<p>找到文件后，使用记事本、Notepad++ 或 VS Code 等文本编辑器打开它。</p>
<h4 id="1-3-2-主要配置项更改"><a href="#1-3-2-主要配置项更改" class="headerlink" title="1.3.2 主要配置项更改"></a>1.3.2 主要配置项更改</h4><p>以下是一些您可能会经常更改或需要注意的重要配置项及其修改建议。请根据您的需求取消注释（删除行首的 <code>#</code>）并修改对应的值。</p>
<ul>
<li><p><strong><code>bind</code></strong></p>
<ul>
<li><p><strong>作用</strong>：指定 Redis 服务器监听的 IP 地址。</p>
</li>
<li><p>修改：默认情况下，Redis for Windows 可能没有明确的 <code>bind</code> 设置，或者它会监听所有可用接口。如果您需要限制访问，可以将其设置为特定 IP 地址。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># bind 127.0.0.1           # 默认可能没有这一行，或只监听本地</span><br><span class="line">bind 0.0.0.0               # 监听所有可用 IP (仅用于测试，生产环境请谨慎)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>重要提示</strong>：在没有密码或防火墙保护的情况下，将 <code>bind</code> 设置为 <code>0.0.0.0</code> 并暴露在公网是非常危险的。</p>
</li>
</ul>
</li>
<li><p><strong><code>port</code></strong></p>
<ul>
<li><p><strong>作用</strong>：指定 Redis 服务器监听的 TCP 端口。</p>
</li>
<li><p>修改：如果您希望 Redis 监听非标准端口，可以在此修改</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">port 6379 # 保持默认或修改为其他端口，如 6380</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong><code>protected-mode</code></strong></p>
<ul>
<li><p><strong>作用</strong>：保护模式，在没有 <code>bind</code> 设置和 <code>requirepass</code>（密码）设置的情况下，只允许本地回环地址（127.0.0.1）访问。</p>
</li>
<li><p>修改：强烈建议保持为 <code>yes</code>。如果您需要从外部连接且不设置密码（不推荐），则必须将其设置为 <code>no</code>，但同时需要设置 Windows 防火墙规则来限制访问。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protected-mode yes</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong><code>requirepass</code></strong></p>
<ul>
<li><p><strong>作用</strong>：设置 Redis 连接密码。</p>
</li>
<li><p>修改：**在生产环境中，强烈建议设置一个强密码。**取消注释并替换 <code>foobared</code> 为您的密码。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">requirepass your_strong_password_here # 设置您的密码</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong><code>databases</code></strong></p>
<ul>
<li><p><strong>作用</strong>：设置可用的数据库数量。Redis 默认有 16 个数据库，索引从 0 到 15。</p>
</li>
<li><p>修改：通常默认值已足够，根据您的应用程序需求调整。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">databases 16</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong><code>maxmemory</code></strong></p>
<ul>
<li><p><strong>作用</strong>：设置 Redis 可用的最大内存量。当达到此限制时，Redis 将根据 <code>maxmemory-policy</code> 配置来决定如何处理新数据。</p>
</li>
<li><p>修改：在生产环境中，强烈建议设置此项，以防止 Redis 使用过多内存导致系统不稳定。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">maxmemory 2gb # 设置最大内存为 2GB</span><br><span class="line"># 当达到 maxmemory 限制时，优先删除带有过期时间的键，并且删除最少使用的键</span><br><span class="line">maxmemory-policy allkeys-lru</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong><code>daemonize</code></strong></p>
<ul>
<li><p><strong>作用</strong>：在 Linux&#x2F;macOS 上，这会使 Redis 作为守护进程（后台进程）运行。在 Windows 上，这个设置通常<strong>不生效</strong>或行为不同，因为 Windows 服务或控制台程序有自己的后台机制。如果您是通过 <code>redis-server.exe</code> 直接运行，它通常会占用控制台窗口。如果您将其作为服务安装，则由服务管理器控制后台运行。</p>
</li>
<li><p>修改</p>
<p>：通常无需在 Windows 下修改此项，保持 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">no</span><br></pre></td></tr></table></figure>

<p> 即可。</p>
<p>代码段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">daemonize no</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong><code>loglevel</code></strong></p>
<ul>
<li><p><strong>作用</strong>：设置日志级别。可选值有 <code>debug</code>, <code>verbose</code>, <code>notice</code>, <code>warning</code>。</p>
</li>
<li><p>修改</p>
<p>：开发&#x2F;调试阶段可以设置为 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">debug</span><br></pre></td></tr></table></figure>

<p> 或 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">verbose</span><br></pre></td></tr></table></figure>

<p>生产环境通常设置为 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">notice</span><br></pre></td></tr></table></figure>

<p> 或 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">warning</span><br></pre></td></tr></table></figure>

<p>，以减少日志量。</p>
<p>代码段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loglevel notice</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<hr>
<h4 id="1-3-3-重启-Redis-Windows"><a href="#1-3-3-重启-Redis-Windows" class="headerlink" title="1.3.3 重启 Redis (Windows)"></a>1.3.3 重启 Redis (Windows)</h4><p>修改配置文件后，您需要重启 Redis 服务器以使更改生效。重启方式取决于您如何在 Windows 上运行 Redis。</p>
<h5 id="1-3-3-1-作为-Windows-服务运行"><a href="#1-3-3-1-作为-Windows-服务运行" class="headerlink" title="1.3.3.1 作为 Windows 服务运行"></a>1.3.3.1 作为 Windows 服务运行</h5><p>如果您的 Redis 实例是作为 Windows 服务安装并运行的（这是推荐的生产环境部署方式），可以通过 Windows 的服务管理器来重启：</p>
<ol>
<li>按下 <code>Win + R</code> 键，输入 <code>services.msc</code>，然后按回车键打开 <strong>服务</strong> 管理器。</li>
<li>在服务列表中找到名为 <strong><code>Redis</code></strong> 或类似名称（例如 <code>Redis6379</code>）的服务。</li>
<li>右键点击该服务，然后选择 <strong>重启</strong>。</li>
</ol>
<h5 id="1-3-3-2-通过命令行手动运行"><a href="#1-3-3-2-通过命令行手动运行" class="headerlink" title="1.3.3.2 通过命令行手动运行"></a>1.3.3.2 通过命令行手动运行</h5><p>如果您是通过命令行直接运行 <code>redis-server.exe</code>，您需要先停止当前的进程，然后重新启动它：</p>
<ol>
<li><p><strong>停止当前 Redis 进程：</strong></p>
<ul>
<li><p>打开一个新的命令提示符 (CMD) 或 PowerShell 窗口。</p>
</li>
<li><p>使用 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli.exe</span><br></pre></td></tr></table></figure>

<p> 连接到您的 Redis 实例并发送 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHUTDOWN</span><br></pre></td></tr></table></figure>

<p> 命令。</p>
<p>DOS</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli.exe -h 127.0.0.1 -p 6379 SHUTDOWN</span><br></pre></td></tr></table></figure>

<ul>
<li><p>如果设置了密码，请添加 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-a</span><br></pre></td></tr></table></figure>

<p> 参数：</p>
<p>DOS</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli.exe -h 127.0.0.1 -p 6379 -a your_password SHUTDOWN</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>如果 Redis 运行在控制台窗口中，发送 <code>SHUTDOWN</code> 命令后，该控制台窗口通常会自动关闭。</p>
</li>
</ul>
</li>
<li><p><strong>使用更新后的配置文件启动 Redis 服务器：</strong></p>
<ul>
<li><p>打开一个新的命令提示符 (CMD) 或 PowerShell 窗口。</p>
</li>
<li><p>导航到 <code>redis-server.exe</code> 所在的目录。</p>
</li>
<li><p>执行以下命令，指定您的配置文件路径：</p>
<p>DOS</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-server.exe redis.windows.conf</span><br><span class="line"># 或如果配置文件在其他路径：</span><br><span class="line"># redis-server.exe C:\path\to\your\redis.windows.conf</span><br></pre></td></tr></table></figure>
</li>
<li><p>这将会在当前控制台窗口中启动 Redis。如果您想让它在后台运行（不占用控制台），可以考虑使用 <code>start</code> 命令（但通常建议安装为服务）。</p>
</li>
</ul>
</li>
</ol>
<p>重启后，您可以使用 <code>redis-cli.exe</code> 连接到 Redis 并执行 <code>PING</code> 命令或 <code>CONFIG GET &lt;config_name&gt;</code> 命令来验证新的配置是否已生效。</p>
<h2 id="2-基本-Redis-操作"><a href="#2-基本-Redis-操作" class="headerlink" title="2. 基本 Redis 操作"></a>2. 基本 Redis 操作</h2><p>在使用 Gin 之前，我们先了解 <code>go-redis</code> 库的基本操作。</p>
<h3 id="2-1-连接-Redis"><a href="#2-1-连接-Redis" class="headerlink" title="2.1 连接 Redis"></a>2.1 连接 Redis</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/go-redis/redis/v8&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ctx = context.Background()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 创建 Redis 客户端实例</span></span><br><span class="line">	rdb := redis.NewClient(&amp;redis.Options&#123;</span><br><span class="line">		Addr:     <span class="string">&quot;localhost:6379&quot;</span>, <span class="comment">// Redis 服务器地址</span></span><br><span class="line">		Password: <span class="string">&quot;&quot;</span>,               <span class="comment">// 如果有密码，请填写</span></span><br><span class="line">		DB:       <span class="number">0</span>,                <span class="comment">// 数据库索引，默认为 0</span></span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// PING 命令检查连接</span></span><br><span class="line">	pong, err := rdb.Ping(ctx).Result()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;Error connecting to Redis:&quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">&quot;Redis connected:&quot;</span>, pong) <span class="comment">// 应该输出 PONG</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-设置和获取字符串"><a href="#2-2-设置和获取字符串" class="headerlink" title="2.2 设置和获取字符串"></a>2.2 设置和获取字符串</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/go-redis/redis/v8&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ctx = context.Background()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	rdb := redis.NewClient(&amp;redis.Options&#123;</span><br><span class="line">		Addr: <span class="string">&quot;localhost:6379&quot;</span>,</span><br><span class="line">		DB:   <span class="number">0</span>,</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置一个键值对</span></span><br><span class="line">	err := rdb.Set(ctx, <span class="string">&quot;mykey&quot;</span>, <span class="string">&quot;Hello Redis from Go!&quot;</span>, <span class="number">0</span>).Err() <span class="comment">// 0 表示永不过期</span></span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;Error setting key:&quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">&quot;Key &#x27;mykey&#x27; set successfully.&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 获取键的值</span></span><br><span class="line">	val, err := rdb.Get(ctx, <span class="string">&quot;mykey&quot;</span>).Result()</span><br><span class="line">	<span class="keyword">if</span> err == redis.Nil &#123; <span class="comment">// 如果键不存在</span></span><br><span class="line">		fmt.Println(<span class="string">&quot;Key &#x27;mykey&#x27; does not exist.&quot;</span>)</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;Error getting key:&quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;Value of &#x27;mykey&#x27;:&quot;</span>, val)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 删除键</span></span><br><span class="line">	_, err = rdb.Del(ctx, <span class="string">&quot;mykey&quot;</span>).Result()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;Error deleting key:&quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">&quot;Key &#x27;mykey&#x27; deleted successfully.&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 再次尝试获取已删除的键</span></span><br><span class="line">	val, err = rdb.Get(ctx, <span class="string">&quot;mykey&quot;</span>).Result()</span><br><span class="line">	<span class="keyword">if</span> err == redis.Nil &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;Key &#x27;mykey&#x27; is now deleted.&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-设置过期时间"><a href="#2-3-设置过期时间" class="headerlink" title="2.3 设置过期时间"></a>2.3 设置过期时间</h3><p>Redis 可以为键设置过期时间，使其在一段时间后自动删除。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/go-redis/redis/v8&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ctx = context.Background()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	rdb := redis.NewClient(&amp;redis.Options&#123;</span><br><span class="line">		Addr: <span class="string">&quot;localhost:6379&quot;</span>,</span><br><span class="line">		DB:   <span class="number">0</span>,</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置一个带过期时间的键 (5 秒后过期)</span></span><br><span class="line">	err := rdb.Set(ctx, <span class="string">&quot;expire_key&quot;</span>, <span class="string">&quot;This key will expire.&quot;</span>, <span class="number">5</span>*time.Second).Err()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;Error setting key with expiry:&quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">&quot;Key &#x27;expire_key&#x27; set with 5s expiry.&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 立即获取</span></span><br><span class="line">	val, _ := rdb.Get(ctx, <span class="string">&quot;expire_key&quot;</span>).Result()</span><br><span class="line">	fmt.Println(<span class="string">&quot;Initial value of &#x27;expire_key&#x27;:&quot;</span>, val)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 等待 6 秒，让键过期</span></span><br><span class="line">	time.Sleep(<span class="number">6</span> * time.Second)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 再次获取，应该已经过期</span></span><br><span class="line">	val, err = rdb.Get(ctx, <span class="string">&quot;expire_key&quot;</span>).Result()</span><br><span class="line">	<span class="keyword">if</span> err == redis.Nil &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;Key &#x27;expire_key&#x27; has expired.&quot;</span>)</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;Error getting expired key:&quot;</span>, err)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;Value of &#x27;expire_key&#x27; (should be expired):&quot;</span>, val)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-在-Gin-中集成-Redis"><a href="#3-在-Gin-中集成-Redis" class="headerlink" title="3. 在 Gin 中集成 Redis"></a>3. 在 Gin 中集成 Redis</h2><p>现在我们将把 Redis 功能集成到 Gin 应用程序中。</p>
<h3 id="3-1-初始化-Redis-客户端"><a href="#3-1-初始化-Redis-客户端" class="headerlink" title="3.1 初始化 Redis 客户端"></a>3.1 初始化 Redis 客户端</h3><p>在 Gin 应用程序启动时，最好只初始化一次 Redis 客户端，并将其作为依赖注入到处理函数中，或者存储在一个全局变量中（但推荐依赖注入）。</p>
<p>我们通常将 Redis 客户端实例存储在 Gin 的 <code>gin.Context</code> 中，或者作为自定义结构体的字段传递。</p>
<p><strong><code>main.go</code></strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/go-redis/redis/v8&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个全局的 Redis 客户端变量 (或者通过依赖注入)</span></span><br><span class="line"><span class="keyword">var</span> Rdb *redis.Client</span><br><span class="line"><span class="keyword">var</span> Ctx = context.Background()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">initRedis</span><span class="params">()</span></span> &#123;</span><br><span class="line">	Rdb = redis.NewClient(&amp;redis.Options&#123;</span><br><span class="line">		Addr:     <span class="string">&quot;localhost:6379&quot;</span>, <span class="comment">// Redis 服务器地址</span></span><br><span class="line">		Password: <span class="string">&quot;&quot;</span>,               <span class="comment">// 如果有密码，请填写</span></span><br><span class="line">		DB:       <span class="number">0</span>,                <span class="comment">// 数据库索引</span></span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 测试连接</span></span><br><span class="line">	pong, err := Rdb.Ping(Ctx).Result()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalf(<span class="string">&quot;Could not connect to Redis: %v&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">&quot;Connected to Redis:&quot;</span>, pong)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 初始化 Redis 客户端</span></span><br><span class="line">	initRedis()</span><br><span class="line"></span><br><span class="line">	router := gin.Default()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 注册 Redis 相关的路由</span></span><br><span class="line">	router.GET(<span class="string">&quot;/set/:key/:value&quot;</span>, setKeyValue)</span><br><span class="line">	router.GET(<span class="string">&quot;/get/:key&quot;</span>, getKeyValue)</span><br><span class="line">	router.DELETE(<span class="string">&quot;/delete/:key&quot;</span>, deleteKey)</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">&quot;Gin server running on :8080&quot;</span>)</span><br><span class="line">	router.Run(<span class="string">&quot;:8080&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-创建-Gin-路由处理-Redis-操作"><a href="#3-2-创建-Gin-路由处理-Redis-操作" class="headerlink" title="3.2 创建 Gin 路由处理 Redis 操作"></a>3.2 创建 Gin 路由处理 Redis 操作</h3><p>接下来，我们将为 Redis 操作创建 Gin 的路由处理函数。</p>
<p><strong><code>main.go</code> (续)</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// setKeyValue 处理 /set/:key/:value 路由，将键值对存储到 Redis</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">setKeyValue</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	key := c.Param(<span class="string">&quot;key&quot;</span>)</span><br><span class="line">	value := c.Param(<span class="string">&quot;value&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置键值对，并设置 1 分钟过期时间</span></span><br><span class="line">	err := Rdb.Set(Ctx, key, value, <span class="number">1</span>*time.Minute).Err()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		c.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;error&quot;</span>: fmt.Sprintf(<span class="string">&quot;Failed to set key: %v&quot;</span>, err)&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;message&quot;</span>: fmt.Sprintf(<span class="string">&quot;Key &#x27;%s&#x27; set successfully with value &#x27;%s&#x27;&quot;</span>, key, value)&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// getKeyValue 处理 /get/:key 路由，从 Redis 获取键的值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getKeyValue</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	key := c.Param(<span class="string">&quot;key&quot;</span>)</span><br><span class="line"></span><br><span class="line">	val, err := Rdb.Get(Ctx, key).Result()</span><br><span class="line">	<span class="keyword">if</span> err == redis.Nil &#123;</span><br><span class="line">		c.JSON(http.StatusNotFound, gin.H&#123;<span class="string">&quot;error&quot;</span>: fmt.Sprintf(<span class="string">&quot;Key &#x27;%s&#x27; not found&quot;</span>, key)&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		c.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;error&quot;</span>: fmt.Sprintf(<span class="string">&quot;Failed to get key: %v&quot;</span>, err)&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;key&quot;</span>: key, <span class="string">&quot;value&quot;</span>: val&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// deleteKey 处理 /delete/:key 路由，从 Redis 删除键</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">deleteKey</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	key := c.Param(<span class="string">&quot;key&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Del 方法返回受影响的键数量</span></span><br><span class="line">	deleted, err := Rdb.Del(Ctx, key).Result()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		c.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;error&quot;</span>: fmt.Sprintf(<span class="string">&quot;Failed to delete key: %v&quot;</span>, err)&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> deleted == <span class="number">0</span> &#123;</span><br><span class="line">		c.JSON(http.StatusNotFound, gin.H&#123;<span class="string">&quot;message&quot;</span>: fmt.Sprintf(<span class="string">&quot;Key &#x27;%s&#x27; not found or already deleted&quot;</span>, key)&#125;)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;message&quot;</span>: fmt.Sprintf(<span class="string">&quot;Key &#x27;%s&#x27; deleted successfully&quot;</span>, key)&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-3-处理错误"><a href="#3-3-处理错误" class="headerlink" title="3.3 处理错误"></a>3.3 处理错误</h3><p>在实际应用中，处理 Redis 操作可能出现的错误至关重要。<code>go-redis</code> 库在键不存在时会返回 <code>redis.Nil</code> 错误，其他网络或 Redis 服务器错误则会返回不同的错误类型。务必对这些错误进行检查和处理。</p>
<h2 id="4-使用-Redis-作为缓存"><a href="#4-使用-Redis-作为缓存" class="headerlink" title="4. 使用 Redis 作为缓存"></a>4. 使用 Redis 作为缓存</h2><p>Redis 最常见的用途之一是作为应用程序的缓存层。我们可以创建一个 Gin 中间件来实现简单的缓存功能。</p>
<h3 id="4-1-实现缓存中间件"><a href="#4-1-实现缓存中间件" class="headerlink" title="4.1 实现缓存中间件"></a>4.1 实现缓存中间件</h3><p>这个中间件将尝试从 Redis 获取响应，如果命中缓存，则直接返回；如果未命中，则继续执行后续处理函数，并将结果缓存起来。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;bytes&quot;</span></span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/go-redis/redis/v8&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ... (initRedis, Rdb, Ctx declarations from previous section)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// CacheMiddleware 是一个简单的缓存中间件</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">CacheMiddleware</span><span class="params">(cacheDuration time.Duration)</span></span> gin.HandlerFunc &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		<span class="comment">// 生成缓存键：通常使用请求的 URL 或更复杂的哈希</span></span><br><span class="line">		cacheKey := <span class="string">&quot;cache:&quot;</span> + c.Request.RequestURI</span><br><span class="line">		log.Printf(<span class="string">&quot;Attempting to fetch from cache for key: %s\n&quot;</span>, cacheKey)</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 尝试从 Redis 获取缓存数据</span></span><br><span class="line">		cachedResponse, err := Rdb.Get(Ctx, cacheKey).Result()</span><br><span class="line">		<span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="comment">// 缓存命中！直接返回缓存的数据</span></span><br><span class="line">			log.Printf(<span class="string">&quot;Cache HIT for key: %s\n&quot;</span>, cacheKey)</span><br><span class="line">			c.Header(<span class="string">&quot;X-Cache&quot;</span>, <span class="string">&quot;HIT&quot;</span>)</span><br><span class="line">			c.Data(http.StatusOK, <span class="string">&quot;application/json&quot;</span>, []<span class="type">byte</span>(cachedResponse))</span><br><span class="line">			c.Abort() <span class="comment">// 阻止后续处理函数执行</span></span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> err == redis.Nil &#123;</span><br><span class="line">			log.Printf(<span class="string">&quot;Cache MISS for key: %s\n&quot;</span>, cacheKey)</span><br><span class="line">			c.Header(<span class="string">&quot;X-Cache&quot;</span>, <span class="string">&quot;MISS&quot;</span>)</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			log.Printf(<span class="string">&quot;Error getting from Redis cache: %v\n&quot;</span>, err)</span><br><span class="line">			<span class="comment">// 如果 Redis 出错，不阻止请求继续执行</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 创建一个响应写入器，捕获响应内容</span></span><br><span class="line">		blw := &amp;bodyLogWriter&#123;body: bytes.NewBufferString(<span class="string">&quot;&quot;</span>), ResponseWriter: c.Writer&#125;</span><br><span class="line">		c.Writer = blw</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 继续处理请求</span></span><br><span class="line">		c.Next()</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 检查状态码，只缓存成功的响应 (200 OK)</span></span><br><span class="line">		<span class="keyword">if</span> c.Writer.Status() == http.StatusOK &#123;</span><br><span class="line">			<span class="comment">// 将响应内容缓存到 Redis</span></span><br><span class="line">			err = Rdb.Set(Ctx, cacheKey, blw.body.String(), cacheDuration).Err()</span><br><span class="line">			<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">				log.Printf(<span class="string">&quot;Error setting Redis cache: %v\n&quot;</span>, err)</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				log.Printf(<span class="string">&quot;Response cached for key: %s, duration: %s\n&quot;</span>, cacheKey, cacheDuration)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// bodyLogWriter 是一个自定义的 ResponseWriter，用于捕获响应体</span></span><br><span class="line"><span class="keyword">type</span> bodyLogWriter <span class="keyword">struct</span> &#123;</span><br><span class="line">	gin.ResponseWriter</span><br><span class="line">	body *bytes.Buffer</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(w bodyLogWriter)</span></span> Write(b []<span class="type">byte</span>) (<span class="type">int</span>, <span class="type">error</span>) &#123;</span><br><span class="line">	w.body.Write(b)</span><br><span class="line">	<span class="keyword">return</span> w.ResponseWriter.Write(b)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(w bodyLogWriter)</span></span> WriteString(s <span class="type">string</span>) (<span class="type">int</span>, <span class="type">error</span>) &#123;</span><br><span class="line">	w.body.WriteString(s)</span><br><span class="line">	<span class="keyword">return</span> w.ResponseWriter.WriteString(s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// main 函数 (续)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	initRedis()</span><br><span class="line">	router := gin.Default()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 应用全局 Logger 中间件</span></span><br><span class="line">	router.Use(gin.Logger())</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置一个带缓存的路由组</span></span><br><span class="line">	cachedGroup := router.Group(<span class="string">&quot;/cached&quot;</span>)</span><br><span class="line">	<span class="comment">// 将缓存中间件应用于此组，缓存 10 秒</span></span><br><span class="line">	cachedGroup.Use(CacheMiddleware(<span class="number">10</span> * time.Second))</span><br><span class="line">	&#123;</span><br><span class="line">		cachedGroup.GET(<span class="string">&quot;/data&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">			log.Println(<span class="string">&quot;Executing /cached/data handler (simulating slow operation)...&quot;</span>)</span><br><span class="line">			time.Sleep(<span class="number">2</span> * time.Second) <span class="comment">// 模拟一个耗时操作</span></span><br><span class="line">			c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;data&quot;</span>: <span class="string">&quot;This is cached data!&quot;</span>, <span class="string">&quot;timestamp&quot;</span>: time.Now().Format(time.RFC3339)&#125;)</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 非缓存路由</span></span><br><span class="line">	router.GET(<span class="string">&quot;/no-cache-data&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		log.Println(<span class="string">&quot;Executing /no-cache-data handler...&quot;</span>)</span><br><span class="line">		c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;data&quot;</span>: <span class="string">&quot;This data is not cached.&quot;</span>, <span class="string">&quot;timestamp&quot;</span>: time.Now().Format(time.RFC3339)&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">&quot;Gin server running on :8080&quot;</span>)</span><br><span class="line">	router.Run(<span class="string">&quot;:8080&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-在路由中使用缓存"><a href="#4-2-在路由中使用缓存" class="headerlink" title="4.2 在路由中使用缓存"></a>4.2 在路由中使用缓存</h3><p>在上面的例子中，我们已经演示了如何将 <code>CacheMiddleware</code> 应用到一个路由组 (<code>/cached</code>)。所有该组下的路由都会受益于缓存。</p>
<p><strong>测试缓存：</strong></p>
<ol>
<li>启动 Gin 服务器。</li>
<li>第一次访问 <code>http://localhost:8080/cached/data</code>：您会看到日志输出 <code>Executing /cached/data handler...</code> 和 <code>Cache MISS</code>，请求会延迟 2 秒。</li>
<li>在 10 秒内再次访问 <code>http://localhost:8080/cached/data</code>：您会看到日志输出 <code>Cache HIT</code>，请求会立即返回，且 <code>timestamp</code> 值与第一次相同（因为它返回的是缓存的数据）。</li>
<li>等待 10 秒以上，再次访问 <code>http://localhost:8080/cached/data</code>：缓存过期，您会再次看到 <code>Cache MISS</code> 和 2 秒延迟，<code>timestamp</code> 值会更新。</li>
<li>访问 <code>http://localhost:8080/no-cache-data</code>：每次访问都会立即返回，没有缓存。</li>
</ol>
<h2 id="5-高级用法（可选）"><a href="#5-高级用法（可选）" class="headerlink" title="5. 高级用法（可选）"></a>5. 高级用法（可选）</h2><h3 id="5-1-Redis-连接池"><a href="#5-1-Redis-连接池" class="headerlink" title="5.1 Redis 连接池"></a>5.1 Redis 连接池</h3><p><code>go-redis</code> 客户端本身就包含了连接池管理。在 <code>redis.NewClient</code> 中，您可以配置 <code>PoolSize</code>、<code>MinIdleConns</code> 等选项来优化连接池行为。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">rdb := redis.NewClient(&amp;redis.Options&#123;</span><br><span class="line">    Addr:         <span class="string">&quot;localhost:6379&quot;</span>,</span><br><span class="line">    Password:     <span class="string">&quot;&quot;</span>,</span><br><span class="line">    DB:           <span class="number">0</span>,</span><br><span class="line">    PoolSize:     <span class="number">10</span>,  <span class="comment">// 最大连接数</span></span><br><span class="line">    MinIdleConns: <span class="number">5</span>,   <span class="comment">// 最小空闲连接数</span></span><br><span class="line">    PoolTimeout:  <span class="number">30</span> * time.Second, <span class="comment">// 从连接池获取连接的超时时间</span></span><br><span class="line">    IdleTimeout:  <span class="number">5</span> * time.Minute,  <span class="comment">// 空闲连接的关闭时间</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="5-2-使用-Redis-实现分布式锁"><a href="#5-2-使用-Redis-实现分布式锁" class="headerlink" title="5.2 使用 Redis 实现分布式锁"></a>5.2 使用 Redis 实现分布式锁</h3><p>当您有多个服务实例需要对共享资源进行互斥访问时，可以使用 Redis 实现分布式锁。<code>go-redis</code> 提供了 <code>SetNX</code>（Set if Not eXists）和 <code>Expire</code> 命令的封装，可以用来构建简单的锁。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/go-redis/redis/v8&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ObtainLock 尝试获取分布式锁</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ObtainLock</span><span class="params">(client *redis.Client, key <span class="type">string</span>, value <span class="type">string</span>, expiration time.Duration)</span></span> (<span class="type">bool</span>, <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="comment">// SetNX 命令在键不存在时设置键值，并设置过期时间</span></span><br><span class="line">	<span class="comment">// 如果设置成功，返回 true；如果键已存在，返回 false</span></span><br><span class="line">	ok, err := client.SetNX(Ctx, key, value, expiration).Result()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>, err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ok, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ReleaseLock 释放分布式锁</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ReleaseLock</span><span class="params">(client *redis.Client, key <span class="type">string</span>, value <span class="type">string</span>)</span></span> (<span class="type">bool</span>, <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="comment">// 使用 Lua 脚本确保原子性：检查值是否匹配，然后删除键</span></span><br><span class="line">	<span class="comment">// 这是为了防止 A 释放了 B 的锁</span></span><br><span class="line">	script := <span class="string">`</span></span><br><span class="line"><span class="string">		if redis.call(&quot;GET&quot;, KEYS[1]) == ARGV[1] then</span></span><br><span class="line"><span class="string">			return redis.call(&quot;DEL&quot;, KEYS[1])</span></span><br><span class="line"><span class="string">		else</span></span><br><span class="line"><span class="string">			return 0</span></span><br><span class="line"><span class="string">		end</span></span><br><span class="line"><span class="string">	`</span></span><br><span class="line">	result, err := client.Eval(Ctx, script, []<span class="type">string</span>&#123;key&#125;, value).Result()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>, err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> result.(<span class="type">int64</span>) == <span class="number">1</span>, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在 Gin 路由中使用</span></span><br><span class="line"><span class="comment">// router.GET(&quot;/lock-resource&quot;, func(c *gin.Context) &#123;</span></span><br><span class="line"><span class="comment">//     lockKey := &quot;my_resource_lock&quot;</span></span><br><span class="line"><span class="comment">//     lockValue := &quot;unique_session_id_123&quot; // 建议使用 UUID 或其他唯一标识</span></span><br><span class="line"><span class="comment">//     lockTTL := 10 * time.Second</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//     locked, err := ObtainLock(Rdb, lockKey, lockValue, lockTTL)</span></span><br><span class="line"><span class="comment">//     if err != nil &#123;</span></span><br><span class="line"><span class="comment">//         c.JSON(http.StatusInternalServerError, gin.H&#123;&quot;error&quot;: &quot;Failed to obtain lock&quot;&#125;)</span></span><br><span class="line"><span class="comment">//         return</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//     if !locked &#123;</span></span><br><span class="line"><span class="comment">//         c.JSON(http.StatusConflict, gin.H&#123;&quot;message&quot;: &quot;Resource is currently locked by another process&quot;&#125;)</span></span><br><span class="line"><span class="comment">//         return</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//     defer func() &#123;</span></span><br><span class="line"><span class="comment">//         released, releaseErr := ReleaseLock(Rdb, lockKey, lockValue)</span></span><br><span class="line"><span class="comment">//         if releaseErr != nil &#123;</span></span><br><span class="line"><span class="comment">//             log.Printf(&quot;Failed to release lock for %s: %v&quot;, lockKey, releaseErr)</span></span><br><span class="line"><span class="comment">//         &#125; else if !released &#123;</span></span><br><span class="line"><span class="comment">//             log.Printf(&quot;Lock %s not released by current process (value mismatch)&quot;, lockKey)</span></span><br><span class="line"><span class="comment">//         &#125; else &#123;</span></span><br><span class="line"><span class="comment">//             log.Printf(&quot;Lock %s released successfully&quot;, lockKey)</span></span><br><span class="line"><span class="comment">//         &#125;</span></span><br><span class="line"><span class="comment">//     &#125;()</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//     // 执行需要加锁的业务逻辑</span></span><br><span class="line"><span class="comment">//     time.Sleep(5 * time.Second) // 模拟业务操作</span></span><br><span class="line"><span class="comment">//     c.JSON(http.StatusOK, gin.H&#123;&quot;message&quot;: &quot;Resource accessed successfully with lock&quot;&#125;)</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br></pre></td></tr></table></figure>

<h3 id="5-3-Pub-Sub（发布-订阅）"><a href="#5-3-Pub-Sub（发布-订阅）" class="headerlink" title="5.3 Pub&#x2F;Sub（发布&#x2F;订阅）"></a>5.3 Pub&#x2F;Sub（发布&#x2F;订阅）</h3><p>Redis 支持发布&#x2F;订阅模式，允许客户端订阅频道并接收其他客户端发布的消息，这在实现实时通知或事件驱动架构时非常有用。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/go-redis/redis/v8&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Rdb *redis.Client</span><br><span class="line"><span class="keyword">var</span> Ctx = context.Background()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">initRedis</span><span class="params">()</span></span> &#123;</span><br><span class="line">	Rdb = redis.NewClient(&amp;redis.Options&#123;</span><br><span class="line">		Addr: <span class="string">&quot;localhost:6379&quot;</span>,</span><br><span class="line">		DB:   <span class="number">0</span>,</span><br><span class="line">	&#125;)</span><br><span class="line">	_, err := Rdb.Ping(Ctx).Result()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalf(<span class="string">&quot;Could not connect to Redis: %v&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">&quot;Connected to Redis for Pub/Sub&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// SubscribeToChannel 订阅一个 Redis 频道</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SubscribeToChannel</span><span class="params">(channel <span class="type">string</span>)</span></span> &#123;</span><br><span class="line">	pubsub := Rdb.Subscribe(Ctx, channel)</span><br><span class="line">	<span class="keyword">defer</span> pubsub.Close() <span class="comment">// 确保订阅器在退出时关闭</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 等待订阅就绪</span></span><br><span class="line">	_, err := pubsub.Receive(Ctx)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Printf(<span class="string">&quot;Error receiving from pubsub: %v&quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	log.Printf(<span class="string">&quot;Subscribed to channel: %s&quot;</span>, channel)</span><br><span class="line"></span><br><span class="line">	ch := pubsub.Channel() <span class="comment">// 获取消息通道</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> msg := <span class="keyword">range</span> ch &#123;</span><br><span class="line">		log.Printf(<span class="string">&quot;Received message from channel &#x27;%s&#x27;: %s&quot;</span>, msg.Channel, msg.Payload)</span><br><span class="line">		<span class="comment">// 在这里处理接收到的消息，例如推送到 WebSocket 客户端</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	initRedis()</span><br><span class="line"></span><br><span class="line">	router := gin.Default()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 启动一个 goroutine 监听 Redis 消息</span></span><br><span class="line">	<span class="keyword">go</span> SubscribeToChannel(<span class="string">&quot;my_chat_channel&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 发布消息的路由</span></span><br><span class="line">	router.GET(<span class="string">&quot;/publish/:message&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		message := c.Param(<span class="string">&quot;message&quot;</span>)</span><br><span class="line">		err := Rdb.Publish(Ctx, <span class="string">&quot;my_chat_channel&quot;</span>, message).Err()</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			c.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;error&quot;</span>: fmt.Sprintf(<span class="string">&quot;Failed to publish message: %v&quot;</span>, err)&#125;)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">		c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;message&quot;</span>: fmt.Sprintf(<span class="string">&quot;Message &#x27;%s&#x27; published to &#x27;my_chat_channel&#x27;&quot;</span>, message)&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">&quot;Gin server running on :8080&quot;</span>)</span><br><span class="line">	router.Run(<span class="string">&quot;:8080&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>测试 Pub&#x2F;Sub：</strong></p>
<ol>
<li>运行上面的 Gin 应用程序。</li>
<li>访问 <code>http://localhost:8080/publish/hello_world</code>。</li>
<li>查看应用程序的控制台输出，您会看到 <code>Received message from channel &#39;my_chat_channel&#39;: hello_world</code>，表明消息已成功发布并被订阅者接收。</li>
</ol>
<hr>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imgs.161517.xyz/2025/03/27/22-00-44-kid1412.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imgs.161517.xyz/2025/03/27/22-00-44-kid1412.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">King Leonardo</div><div class="post-copyright__author_desc">个人博客</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://example.com/2025/06/03/go-redis/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://example.com/2025/06/03/go-redis/')">Go-Redis</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://imgs.161517.xyz/2025/06/02/wechat-pay-qr.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imgs.161517.xyz/2025/06/02/wechat-pay-qr.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://imgs.161517.xyz/2025/06/02/alipay-qr.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imgs.161517.xyz/2025/06/02/alipay-qr.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://example.com/2025/06/03/go-redis/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=Go-Redis&amp;url=http://example.com/2025/06/03/go-redis/&amp;pic=https://imgs.161517.xyz/2025/05/10/1003.jpg" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">LeoBlog</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/Backend/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>Backend<span class="tagsPageCount">5</span></a><a class="post-meta__box__tags" href="/tags/Go/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>Go<span class="tagsPageCount">4</span></a><a class="post-meta__box__tags" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>数据库<span class="tagsPageCount">2</span></a><a class="post-meta__box__tags" href="/tags/Redis/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>Redis<span class="tagsPageCount">1</span></a><a class="post-meta__box__tags" href="/tags/%E7%BC%93%E5%AD%98/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>缓存<span class="tagsPageCount">1</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://imgs.161517.xyz/2025/05/10/1003.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/06/03/viper/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imgs.161517.xyz/2025/05/10/1004.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Viper 极简配置读取</div></div></a></div><div class="next-post pull-right"><a href="/2025/06/28/go-tags/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imgs.161517.xyz/2025/05/10/1010.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Go-Tags</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2025/06/03/backend-gin/" title="Gin Web Framework 使用"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imgs.161517.xyz/2025/05/10/1001.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-06-03</div><div class="title">Gin Web Framework 使用</div></div></a></div><div><a href="/2025/06/02/backend-go/" title="Go 项目工程化指南"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imgs.161517.xyz/2025/05/10/1008.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-06-02</div><div class="title">Go 项目工程化指南</div></div></a></div><div><a href="/2025/06/03/backend-gorm/" title="GORM 数据库操作"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imgs.161517.xyz/2025/05/10/1009.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-06-03</div><div class="title">GORM 数据库操作</div></div></a></div><div><a href="/2025/06/28/go-tags/" title="Go-Tags"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imgs.161517.xyz/2025/05/10/1010.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-06-28</div><div class="title">Go-Tags</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imgs.161517.xyz/2025/03/27/22-00-44-kid1412.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__description">这是我的个人博客，用于交流、学习技术，欢迎访问！</div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">King Leonardo</h1><div class="author-info__desc">个人博客</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/kingleonardo999" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a></div></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://imgs.161517.xyz/2025/03/27/19-05-30-front.jpg) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://imgs.161517.xyz/2025/03/27/19-00-44-back.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis-%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">1.</span> <span class="toc-text">Redis 的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">1.1.</span> <span class="toc-text">1. 环境准备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E5%AE%89%E8%A3%85-Go-Redis-%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.1 安装 Go Redis 客户端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E5%AE%89%E8%A3%85%E5%92%8C%E8%BF%90%E8%A1%8C-Redis-%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">1.1.2.</span> <span class="toc-text">1.2 安装和运行 Redis 服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-Redis-%E9%85%8D%E7%BD%AE%E4%BF%AE%E6%94%B9-Windows"><span class="toc-number">1.1.3.</span> <span class="toc-text">1.3 Redis 配置修改 (Windows)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-1-%E6%89%BE%E5%88%B0-Redis-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.1.3.1.</span> <span class="toc-text">1.3.1 找到 Redis 配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-2-%E4%B8%BB%E8%A6%81%E9%85%8D%E7%BD%AE%E9%A1%B9%E6%9B%B4%E6%94%B9"><span class="toc-number">1.1.3.2.</span> <span class="toc-text">1.3.2 主要配置项更改</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-3-%E9%87%8D%E5%90%AF-Redis-Windows"><span class="toc-number">1.1.3.3.</span> <span class="toc-text">1.3.3 重启 Redis (Windows)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-3-3-1-%E4%BD%9C%E4%B8%BA-Windows-%E6%9C%8D%E5%8A%A1%E8%BF%90%E8%A1%8C"><span class="toc-number">1.1.3.3.1.</span> <span class="toc-text">1.3.3.1 作为 Windows 服务运行</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-3-3-2-%E9%80%9A%E8%BF%87%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%89%8B%E5%8A%A8%E8%BF%90%E8%A1%8C"><span class="toc-number">1.1.3.3.2.</span> <span class="toc-text">1.3.3.2 通过命令行手动运行</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%9F%BA%E6%9C%AC-Redis-%E6%93%8D%E4%BD%9C"><span class="toc-number">1.2.</span> <span class="toc-text">2. 基本 Redis 操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E8%BF%9E%E6%8E%A5-Redis"><span class="toc-number">1.2.1.</span> <span class="toc-text">2.1 连接 Redis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E8%AE%BE%E7%BD%AE%E5%92%8C%E8%8E%B7%E5%8F%96%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.2 设置和获取字符串</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E8%AE%BE%E7%BD%AE%E8%BF%87%E6%9C%9F%E6%97%B6%E9%97%B4"><span class="toc-number">1.2.3.</span> <span class="toc-text">2.3 设置过期时间</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%9C%A8-Gin-%E4%B8%AD%E9%9B%86%E6%88%90-Redis"><span class="toc-number">1.3.</span> <span class="toc-text">3. 在 Gin 中集成 Redis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E5%88%9D%E5%A7%8B%E5%8C%96-Redis-%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">1.3.1.</span> <span class="toc-text">3.1 初始化 Redis 客户端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E5%88%9B%E5%BB%BA-Gin-%E8%B7%AF%E7%94%B1%E5%A4%84%E7%90%86-Redis-%E6%93%8D%E4%BD%9C"><span class="toc-number">1.3.2.</span> <span class="toc-text">3.2 创建 Gin 路由处理 Redis 操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E5%A4%84%E7%90%86%E9%94%99%E8%AF%AF"><span class="toc-number">1.3.3.</span> <span class="toc-text">3.3 处理错误</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E4%BD%BF%E7%94%A8-Redis-%E4%BD%9C%E4%B8%BA%E7%BC%93%E5%AD%98"><span class="toc-number">1.4.</span> <span class="toc-text">4. 使用 Redis 作为缓存</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E5%AE%9E%E7%8E%B0%E7%BC%93%E5%AD%98%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">1.4.1.</span> <span class="toc-text">4.1 实现缓存中间件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E5%9C%A8%E8%B7%AF%E7%94%B1%E4%B8%AD%E4%BD%BF%E7%94%A8%E7%BC%93%E5%AD%98"><span class="toc-number">1.4.2.</span> <span class="toc-text">4.2 在路由中使用缓存</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%89"><span class="toc-number">1.5.</span> <span class="toc-text">5. 高级用法（可选）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-Redis-%E8%BF%9E%E6%8E%A5%E6%B1%A0"><span class="toc-number">1.5.1.</span> <span class="toc-text">5.1 Redis 连接池</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E4%BD%BF%E7%94%A8-Redis-%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81"><span class="toc-number">1.5.2.</span> <span class="toc-text">5.2 使用 Redis 实现分布式锁</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-Pub-Sub%EF%BC%88%E5%8F%91%E5%B8%83-%E8%AE%A2%E9%98%85%EF%BC%89"><span class="toc-number">1.5.3.</span> <span class="toc-text">5.3 Pub&#x2F;Sub（发布&#x2F;订阅）</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/06/28/go-tags/" title="Go-Tags"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imgs.161517.xyz/2025/05/10/1010.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Go-Tags"/></a><div class="content"><a class="title" href="/2025/06/28/go-tags/" title="Go-Tags">Go-Tags</a><time datetime="2025-06-28T03:49:46.968Z" title="发表于 2025-06-28 11:49:46">2025-06-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/03/go-redis/" title="Go-Redis"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imgs.161517.xyz/2025/05/10/1003.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Go-Redis"/></a><div class="content"><a class="title" href="/2025/06/03/go-redis/" title="Go-Redis">Go-Redis</a><time datetime="2025-06-03T02:27:15.838Z" title="发表于 2025-06-03 10:27:15">2025-06-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/03/viper/" title="Viper 极简配置读取"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imgs.161517.xyz/2025/05/10/1004.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Viper 极简配置读取"/></a><div class="content"><a class="title" href="/2025/06/03/viper/" title="Viper 极简配置读取">Viper 极简配置读取</a><time datetime="2025-06-03T02:26:53.696Z" title="发表于 2025-06-03 10:26:53">2025-06-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/03/backend-gorm/" title="GORM 数据库操作"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imgs.161517.xyz/2025/05/10/1009.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="GORM 数据库操作"/></a><div class="content"><a class="title" href="/2025/06/03/backend-gorm/" title="GORM 数据库操作">GORM 数据库操作</a><time datetime="2025-06-03T02:26:36.843Z" title="发表于 2025-06-03 10:26:36">2025-06-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/03/backend-gin/" title="Gin Web Framework 使用"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imgs.161517.xyz/2025/05/10/1001.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Gin Web Framework 使用"/></a><div class="content"><a class="title" href="/2025/06/03/backend-gin/" title="Gin Web Framework 使用">Gin Web Framework 使用</a><time datetime="2025-06-03T02:24:54.100Z" title="发表于 2025-06-03 10:24:54">2025-06-03</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2025 By <a class="footer-bar-link" href="/" title="King Leonardo" target="_blank">King Leonardo</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">8</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">14</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">3</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Backend/" style="font-size: 0.88rem;">Backend<sup>5</sup></a><a href="/tags/GORM/" style="font-size: 0.88rem;">GORM<sup>1</sup></a><a href="/tags/Gin/" style="font-size: 0.88rem;">Gin<sup>1</sup></a><a href="/tags/Go/" style="font-size: 0.88rem;">Go<sup>4</sup></a><a href="/tags/Hexo/" style="font-size: 0.88rem;">Hexo<sup>1</sup></a><a href="/tags/Redis/" style="font-size: 0.88rem;">Redis<sup>1</sup></a><a href="/tags/Viper/" style="font-size: 0.88rem;">Viper<sup>1</sup></a><a href="/tags/Web-Framework/" style="font-size: 0.88rem;">Web Framework<sup>1</sup></a><a href="/tags/frontend/" style="font-size: 0.88rem;">frontend<sup>1</sup></a><a href="/tags/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/" style="font-size: 0.88rem;">博客搭建<sup>1</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 0.88rem;">数据库<sup>2</sup></a><a href="/tags/%E7%BC%93%E5%AD%98/" style="font-size: 0.88rem;">缓存<sup>1</sup></a><a href="/tags/%E9%85%8D%E7%BD%AE%E8%AF%BB%E5%8F%96/" style="font-size: 0.88rem;">配置读取<sup>1</sup></a><a href="/tags/%E9%A1%B9%E7%9B%AE/" style="font-size: 0.88rem;">项目<sup>2</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.cbd.int/pangu@4.0.7/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script async src="/anzhiyu/random.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>