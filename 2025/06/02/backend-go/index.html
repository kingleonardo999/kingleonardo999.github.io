<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>Go + Gin | LeoBlog</title><meta name="keywords" content="Backend,Go,Gin,Viper,GORM"><meta name="author" content="King Leonardo"><meta name="copyright" content="King Leonardo"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="Go + Gin"><meta name="application-name" content="Go + Gin"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="Go + Gin"><meta property="og:url" content="http://example.com/2025/06/02/backend-go/index.html"><meta property="og:site_name" content="LeoBlog"><meta property="og:description" content="这是一篇初学Go和Gin框架的文章，包含项目构建及项目工程化基本流程"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://imgs.161517.xyz/2025/05/10/1008.jpg"><meta property="article:author" content="King Leonardo"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://imgs.161517.xyz/2025/05/10/1008.jpg"><meta name="description" content="这是一篇初学Go和Gin框架的文章，包含项目构建及项目工程化基本流程"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://example.com/2025/06/02/backend-go/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//static.cloudflareinsights.com"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script defer="defer" data-pjax="data-pjax" src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon="{&quot;token&quot;: &quot;63ee268ee87a46d98e0eeaab5bdafc9a&quot;}"></script><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2024/07/27/125766904/ba62475f396df9de3316a08ed9e65d86_5680958632268053399..png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: undefined,
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":false,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: King Leonardo","link":"链接: ","source":"来源: LeoBlog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'LeoBlog',
  title: 'Go + Gin',
  postAI: '',
  pageFillDescription: 'Go 项目工程化指南, 1. Go 项目的创建与初始化, 1.1 初始化一个新的 Go Modules 项目, 1.2 Go 项目基本结构, 1.3 编译和打包成可执行文件, 1.3.1 基本编译, 1.3.2 交叉编译 (Cross-Compilation), 1.3.3 减小可执行文件大小, 1.3.4 生成静态链接的二进制文件 (推荐用于 Docker), 2. 依赖管理, 2.1 添加新的依赖, 2.2 更新现有依赖, 2.3 移除不再使用的依赖, 2.4 查看依赖图, 2.5 供应商模式 (Vendor Mode), 3. 拉取别人的 Go 项目并下载依赖, 3.1 克隆项目, 3.2 下载并安装依赖, 3.3 编译和运行项目, 3.4 处理网络代理问题, 3.5 处理私有仓库依赖, 4. 常见的工程化问题与解决方案, 4.1 解决依赖版本冲突, 4.2 跨平台编译, 4.3 代码风格检查与格式化, 4.4 单元测试与集成测试, 4.5 Git 版本控制最佳实践, 4.6 Docker 化 Go 应用, 结语, Gin Web Framework, 准备工作, 基础结构, 1. 路由 (Routing), 1.1 基本路由, 1.2 路径参数 (Path Parameters), 1.3 查询字符串参数 (Query String Parameters), 1.4 路由组 (Route Groups), 2. 参数绑定 (Binding), 2.1 JSON 请求体绑定, 2.2 Form (x-www-form-urlencoded 或 multipartx2Fform-data) 绑定, 2.3 查询参数绑定, 3. 响应 (Responses), 3.1 JSON 响应, 3.2 纯文本响应, 3.3 HTML 响应, 3.4 重定向 (Redirect), 4. 中间件 (Middlewares), 4.1 全局中间件, 4.2 路由组中间件, 4.3 单个路由中间件, 4.4 中间件中的上下文数据传递, 5. 错误处理 (Error Handling), 总结, GORM 数据库操作速查手册, 准备工作, 数据库连接与模型定义, 1. 插入数据 (Create), 1.1 插入单条记录, 1.2 批量插入记录, 2. 查询数据 (Retrieve), 2.1 根据主键查询 (First x2F Find), 2.2 根据条件查询 (Where), 2.3 查询所有记录 (Find), 2.4 排序、限制和偏移 (Order Limit Offset), 3. 更新数据 (Update), 3.1 更新单个字段 (Update), 3.2 更新多个字段 (Updates), 3.3 计数器更新 (Inc x2F Dec), 4. 删除数据 (Delete), 4.1 软删除 (Soft Delete), 4.2 硬删除 (Permanent Delete), 总结, Viper 极简配置读取指南, 1. 安装 Viper, 2. 准备配置文件, 3. 编写 Go 代码读取配置并绑定到结构体, 4. 运行你的程序, 结构体绑定小贴士：, Redis 的使用, 1. 环境准备, 1.1 安装 Go Redis 客户端, 1.2 安装和运行 Redis 服务器, 1.3 Redis 配置修改 (Windows), 1.3.1 找到 Redis 配置文件, 1.3.2 主要配置项更改, 1.3.3 重启 Redis (Windows), 1.3.3.1 作为 Windows 服务运行, 1.3.3.2 通过命令行手动运行, 2. 基本 Redis 操作, 2.1 连接 Redis, 2.2 设置和获取字符串, 2.3 设置过期时间, 3. 在 Gin 中集成 Redis, 3.1 初始化 Redis 客户端, 3.2 创建 Gin 路由处理 Redis 操作, 3.3 处理错误, 4. 使用 Redis 作为缓存, 4.1 实现缓存中间件, 4.2 在路由中使用缓存, 5. 高级用法（可选）, 5.1 Redis 连接池, 5.2 使用 Redis 实现分布式锁, 5.3 Pubx2FSub（发布x2F订阅）项目工程化指南本文档旨在提供语言项目从零开始创建管理依赖以及协作开发时可能遇到的工程性问题的解决方案项目的创建与初始化语言的项目管理主要依赖于从开始引入并在成为默认初始化一个新的项目在你的工作目录下创建一个新的项目文件夹并进入该文件夹然后运行命令来初始化这会在当前目录生成一个文件建议使用你的域名用户名项目名作为模块名例如文件是的核心它定义了项目的模块路径版本以及项目的所有依赖项目基本结构一个典型的项目结构如下模块定义文件依赖校验和文件由自动维护不要手动修改始终随一起提交主程序入口文件如果项目只有一个入口点配置文件目录例如等内部包只能被当前模块内代码导入不能被其他模块导入数据模型定义业务逻辑服务外部接口定义例如接口定义或者定义路由及处理函数包含多个主程序入口的目录每个子目录代表一个可执行程序例如服务器入口例如命令行工具入口共享包可以被当前模块和其他模块导入不常用推荐通用工具函数脚本文件例如构建脚本部署脚本等部署相关文件例如额外集成测试或性能测试与内部测试分开环境变量文件敏感信息不提交容器化文件项目说明文档忽略文件配置关键点模块定义文件手动编辑或通过等命令自动维护记录了所有依赖的加密校验和用于保证依赖的完整性和安全性不要手动修改始终随一起提交到版本控制通常是主程序的入口文件如果项目简单只有一个可执行程序可以放在根目录如果项目包含多个可执行程序如一个服务和一个命令行工具则会将各自的放在目录下的子目录中这是推荐的内部包存放位置目录下的包只能被当前模块内的代码导入和使用不能被其他模块导入这有助于限制包的可见性和职责当你的项目包含多个独立的可执行文件时这是组织它们的最佳实践每个子目录都是一个独立的程序入口例如负责启动服务器而负责启动一个命令行工具编译和打包成可执行文件语言提供了一个强大的命令可以将你的源代码编译成独立的可执行二进制文件基本编译在项目根目录下如果你的主程序入口是在项目根目录这条命令会编译当前目录下的源代码并生成一个名为的可执行文件在上会是如果你的主程序入口在目录下例如这条命令会编译目录下的源代码并生成一个名为的可执行文件编译完成后你会在当前目录或者你指定的输出目录找到这个可执行文件你可以直接运行它或者交叉编译语言的强大之处在于其天生支持交叉编译这意味着你可以在一个操作系统上编译出在另一个操作系统上运行的可执行文件而无需安装目标平台的环境通过设置目标操作系统和目标架构环境变量来实现常用组合完整的和列表请运行减小可执行文件大小对于生产环境部署你可能希望减小可执行文件的大小可以使用编译标志移除符号表移除调试信息这会显著减小二进制文件大小但也会使调试变得困难生成静态链接的二进制文件推荐用于如果你的程序使用了例如某些数据库驱动或图像处理库生成的二进制文件可能会依赖系统上的库为了生成完全独立的二进制文件特别适合镜像可以禁用禁用确保编译目标是这是大多数生产环境容器的默认环境这会生成一个完全静态链接的二进制文件不依赖目标系统的任何库非常适合构建轻量级的镜像例如基于或的镜像依赖管理让依赖管理变得非常简单添加新的依赖当你需要引入一个新的第三方库时可以在代码中直接它然后运行以下命令将框架添加到你的项目中或者你也可以只在代码中新的包然后运行会自动分析代码下载所有缺失的依赖并清理不再使用的依赖这两种方式都会更新和文件更新现有依赖要将某个依赖更新到最新版本更新到最新的兼容版本只更新到最新的补丁版本更新到指定版本移除不再使用的依赖如果你的代码不再使用某个依赖命令会自动帮你清理和文件中的相关条目查看依赖图显示模块依赖图供应商模式在某些特定场景下例如网络环境受限严格的依赖版本控制你可能希望将所有依赖的源代码复制到项目本地的目录中这会在项目根目录创建一个文件夹包含所有依赖的源代码启用模式编译注意默认情况下会优先使用进行依赖下载只有在显式指定时或者在不可用的情况下才会使用目录对于大多数现代项目不建议默认使用模式直接依赖更简单拉取别人的项目并下载依赖当你了一个项目后安装其依赖通常非常简单克隆项目下载并安装依赖进入项目根目录即文件所在的目录然后运行这个命令会执行以下操作读取解析项目所需的模块及其版本下载模块如果本地缓存中没有这些模块它会从默认是在国内可能需要配置代理下载验证校验和检查文件中记录的校验和确保下载的模块没有被篡改清理如果代码中不再使用的依赖会从和中移除这是最推荐和最常用的方法编译和运行项目在依赖下载完成后你可以直接编译或运行项目编译当前目录下的项目生成可执行文件运行编译后的可执行文件直接运行当前目录下的项目不会生成可执行文件如果项目有多个命令行入口例如目录你需要指定要运行的入口文件处理网络代理问题在中国大陆地区访问或一些上的模块可能会遇到网络问题你可以设置代理临时设置永久设置推荐加入到或中这将把设置为国内的模块代理表示如果代理失败尝试直接连接处理私有仓库依赖如果项目依赖了私有仓库例如公司内部的仓库可能无法直接下载你需要配置或告诉哪些模块是私有的不要通过公共代理去查找假设你的私有仓库都在下在处理中定义的模块时会直接从版本控制系统如拉取而不是通过这意味着你需要确保客户端配置了正确的认证方式例如密钥或用户名密码常见的工程化问题与解决方案解决依赖版本冲突当两个依赖包共同依赖于同一个第三方包但要求不同版本时可能会发生冲突优先尝试运行的最小版本选择算法通常能很好地解决冲突它会选择所有依赖方都满足的最低兼容版本手动调整如果无法解决你可以手动在中使用指令明确指定一个版本或者使用指令替换掉某个模块示例假设冲突你需要指定这个版本替换本地模块用于开发或测试替换远程模块例如修复了上游注意指令通常只在开发环境中或为了解决特定问题时使用不建议大量用于生产环境因为它可能导致构建环境不一致跨平台编译语言支持轻松地进行交叉编译编译可执行文件编译可执行文件编译可执行文件和是环境变量分别指定目标操作系统和架构代码风格检查与格式化社区有强大的工具来强制一致的代码风格格式化代码使所有代码符合官方风格格式化当前模块所有文件建议在提交代码前执行此命令大多数如都会在保存时自动运行已弃用推荐静态代码分析工具用于检查潜在的代码问题和风格建议如果没有安装注意已经不再维护推荐使用更强大的静态分析工具集安装建议在流程中集成单元测试与集成测试内置了测试框架编写测试在与源文件同级的目录下创建文件测试逻辑运行测试运行当前模块所有测试详细输出测试结果运行测试并生成代码覆盖率报告版本控制最佳实践始终提交和它们定义了项目的依赖必须和代码一起版本控制使用忽略编译生成的可执行文件临时文件编辑器生成的文件等如果不使用模式可以不忽略化应用将应用打包成镜像以方便部署示例多阶段构建阶段构建拷贝和以利用缓存拷贝源代码编译应用是为了生成静态链接的可执行文件更易于分发强制重新编译所有包解决静态链接问题移除调试信息和符号表减小镜像大小根据你的入口调整阶段运行从构建阶段复制可执行文件暴露端口如果你的应用是服务运行应用构建镜像运行容器结语通过遵循这些项目工程化指南你将能够更高效更规范地创建维护和协作语言项目良好的工程实践是保证项目质量和长期可维护性的关键是一个用语言编写的框架它以其高性能和低内存占用而闻名具有类似的但性能更好这得益于其高度优化的路由器本文档将介绍的核心概念和常用功能包括路由参数绑定响应中间件等准备工作首先你需要安装框架基础结构一个基本的应用通常包含以下部分用于状态码用于打印输出创建一个路由器实例包含了和中间件定义路由和处理函数方法用于返回响应用于返回纯文本响应运行服务器默认在端口启动运行后访问或即可看到效果路由提供了简洁的来定义各种请求方法的路由基本路由你可以使用等方法来处理不同的请求请求请求请求获取路径参数请求路径参数使用冒号定义路径参数你可以通过参数名来获取匹配等获取路径参数多参数匹配查询字符串参数通过参数名或参数名默认值获取中的查询参数访问获取参数如果不存在则为空字符串获取参数如果不存在则为路由组使用可以组织路由并为路由组应用相同的中间件创建一个路由组创建一个路由组参数绑定提供了强大的参数绑定功能可以将请求数据等自动绑定到结构体请求体绑定使用或在绑定失败时会返回错误你可以根据错误进行处理标签表示该字段是必需的标签用于字段名映射示例请求体或绑定使用或示例字段需要是有效的邮箱格式示例请求体查询参数绑定可以将查询参数绑定到结构体示例响应提供了多种发送响应的方法响应这是最常用的响应类型简单的结构体结构体切片纯文本响应响应你需要加载模板加载模板文件假设文件在目录下示例重定向中间件中间件是在请求被处理之前或之后执行的代码支持全局中间件路由组中间件和单个路由中间件全局中间件应用于所有路由已经默认包含了和手动添加中间件如果不用请求日志崩溃恢复路由组中间件应用于路由组内的所有路由简单模拟认证调用链中的下一个中间件或处理函数为组应用单个路由中间件只应用于特定的路由中间件中的上下文数据传递你可以使用和在中间件之间或中间件和处理函数之间传递数据假设从或其他地方解析出用户信息设置上下文变量获取上下文变量错误处理允许你收集和处理请求过程中发生的错误记录一个错误也可以在错误后中止请求链的中间件会自动打印中的错误你也可以创建自定义的错误处理中间件来集中管理错误响应总结是一个快速灵活且易于使用的框架掌握以上基础知识你就可以开始构建功能强大的应用了还有许多高级特性例如文件上传静态文件服务模板渲染和管理表单处理自定义验证器查阅官方文档以获取更多详细信息和高级用法数据库操作速查手册是语言中一个功能强大的库它提供了简洁的来操作数据库支持多种数据库如等本文档将介绍的常用操作插入查询更新和删除并演示如何将查询结果赋值给语言的变量准备工作在开始之前确保你已经安装了和相应的数据库驱动示例中使用你可以替换为其他数据库驱动数据库连接与模型定义首先我们需要建立数据库连接和定义一个数据模型示例使用是一个模型映射到数据库中的表包含了常用的字段是自增主键姓名非空邮箱唯一且非空年龄余额默认值为还可以添加其他字段例如全局实例实际项目中通常通过依赖注入管理连接到数据库自动迁移模式根据结构体创建或更新数据库表这里可以调用各种操作函数进行演示开始操作演示插入操作插入查询操作查询第一页每页条更新操作更新删除操作删除软删除硬删除如果需要再次查询所有用户看软删除效果再次查询所有用户插入数据使用方法将新的记录插入到数据库中插入单条记录插入单条用户记录传入结构体指针会将新记录的填充回结构体使用示例此时会被填充为新插入记录的自增批量插入记录传递一个结构体切片给即可实现批量插入批量插入用户记录传入结构体切片指针使用示例查询数据提供了多种查询方法可以灵活地检索数据查询结果会赋值给语言的变量根据主键查询查找主键匹配的第一个记录如果没有找到记录会是查找主键匹配的所有记录如果找到多个只会赋值给切片根据查询用户会根据主键查找如果找不到会返回传入结构体指针和主键值使用示例根据条件查询使用方法添加查询条件根据邮箱查询用户方法用于构建查询条件使用占位符防止注入根据姓名模糊查询所有匹配的用户声明一个结构体切片来存储多条记录使用进行模糊匹配复杂条件查询链式调用多个条件使用示例查找名字中包含的用户查询所有记录不带条件的方法会查询表中的所有记录查询所有用户声明一个结构体切片使用示例排序限制和偏移用于分页和排序查询结果分页查询用户计算偏移量使用示例查询第一页每页条更新数据提供了多种更新数据的方法更新单个字段方法用于更新模型的单个字段根据更新用户姓名和邮箱首先找到记录更新单个字段更新单个字段更新多个字段使用或结构体使用结构体更新或者使用更新使用示例更新多个字段方法用于更新模型的多个字段根据邮箱更新用户年龄和余额使用找到记录然后用更新使用示例计数器更新用于原子性地增加或减少字段值增加用户年龄或者使用方法删除数据支持软删除和硬删除软删除如果你的模型嵌入了或包含字段默认会进行软删除它不会真正删除记录而是将字段设置为当前时间软删除的记录在常规查询中不会被检索到除非使用方法软删除用户使用方法进行软删除传入结构体指针和主键值查找被软删除的用户需要使用方法可以查询被软删除的记录使用示例软删除为的用户此时应该找不到为的用户可以找到被软删除的用户硬删除如果你想彻底从数据库中删除记录可以使用硬删除用户使用进行硬删除使用示例硬删除为的用户总结本文档涵盖了中最常用的数据库操作方法还有许多高级功能例如关联一对一一对多多对多关系事务确保一系列数据库操作的原子性预加载一次性加载关联数据以避免查询问题钩子在创建更新删除等操作前后执行自定义逻辑原生当无法满足需求时直接执行语句查阅官方文档以获取更多详细信息和高级用法极简配置读取指南是语言中一个非常方便的配置库如果你想从文件中读取配置并将其映射到结构体以便于类型安全的调用能轻松搞定安装首先确保你的项目安装了准备配置文件支持多种配置文件格式比如等我们以格式为例创建一个名为的文件在你的项目根目录下这个字段在结构体中会用到如果配置文件没有会用结构体的默认值编写代码读取配置并绑定到结构体下面是一个简单的程序演示了如何使用读取文件中的配置并将其绑定到一个结构体用于输出错误信息结构体映射整个配置文件标签告诉如何将配置键映射到结构体字段映射配置部分映射配置部分即使配置文件没有结构体也有默认值设置配置文件的名称不带扩展名对应等设置配置文件的类型可选但推荐明确指定明确告诉配置文件是格式添加查找配置文件的路径会按照添加的顺序查找找到第一个就停止在当前目录查找在当前目录下的文件夹中查找如果你把放在这里读取配置文件如果配置文件没找到这通常不是一个致命错误因为你可能想在生产环境通过环境变量或代码默认值提供配置其他类型的错误如文件损坏是致命错误绑定配置到结构体定义一个结构体变量来接收配置设置默认值到结构体字段可选但推荐如果配置文件中没有这里设置的会生效通过结构体访问配置值推荐类型安全方便调用通过结构体访问配置还可以直接通过实例获取值适用于少量或不方便映射到结构体的配置直接通过访问配置注意当使用后结构体是主要的访问方式但实例仍然可以获取任何已加载的配置运行你的程序将上面的代码保存为确保文件与在同一目录下打开终端进入该目录然后运行你将看到程序成功读取并将其内容绑定到结构体然后通过结构体字段访问配置值结构体绑定小贴士标签告诉如何将配置文件中的字段映射到结构体的对应字段这是必不可少的嵌套结构体对于配置文件中的嵌套配置如和结构体也应使用嵌套结构体来匹配默认值如果结构体字段是基本类型如并且你在代码中给它赋了初始值例如那么在配置文件中没有这个键时这个默认值就会被保留如果配置文件有则会被覆盖的使用是一个开源的许可内存数据结构存储可用作数据库缓存和消息代理它支持多种数据结构如字符串哈希列表集合有序集合等在框架中集成可以极大地提高应用程序的性能和可扩展性本教程将介绍如何在应用程序中连接进行基本操作如设置和获取键值以及如何使用进行会话管理和缓存环境准备在开始之前请确保您的开发环境已准备就绪安装客户端我们将使用库作为客户端它是语言中最流行和功能最丰富的客户端之一安装和运行服务器您可以通过多种方式安装和运行服务器推荐最简单快捷的方式或者只运行核心这将启动一个名为的容器并将容器的端口映射到主机的端口手动安装或可以从官方网站下载或使用安装完成后确保服务器正在运行默认监听端口您可以使用来测试连接如果返回则表示连接成功配置修改在系统中通常以服务形式运行或通过命令行手动启动它的行为通过文件进行配置找到配置文件如果您是手动安装文件通常位于您解压安装包的根目录下例如或找到文件后使用记事本或等文本编辑器打开它主要配置项更改以下是一些您可能会经常更改或需要注意的重要配置项及其修改建议请根据您的需求取消注释删除行首的并修改对应的值作用指定服务器监听的地址修改默认情况下可能没有明确的设置或者它会监听所有可用接口如果您需要限制访问可以将其设置为特定地址默认可能没有这一行或只监听本地监听所有可用仅用于测试生产环境请谨慎重要提示在没有密码或防火墙保护的情况下将设置为并暴露在公网是非常危险的作用指定服务器监听的端口修改如果您希望监听非标准端口可以在此修改保持默认或修改为其他端口如作用保护模式在没有设置和密码设置的情况下只允许本地回环地址访问修改强烈建议保持为如果您需要从外部连接且不设置密码不推荐则必须将其设置为但同时需要设置防火墙规则来限制访问作用设置连接密码修改在生产环境中强烈建议设置一个强密码取消注释并替换为您的密码设置您的密码作用设置可用的数据库数量默认有个数据库索引从到修改通常默认值已足够根据您的应用程序需求调整作用设置可用的最大内存量当达到此限制时将根据配置来决定如何处理新数据修改在生产环境中强烈建议设置此项以防止使用过多内存导致系统不稳定设置最大内存为当达到限制时优先删除带有过期时间的键并且删除最少使用的键作用在上这会使作为守护进程后台进程运行在上这个设置通常不生效或行为不同因为服务或控制台程序有自己的后台机制如果您是通过直接运行它通常会占用控制台窗口如果您将其作为服务安装则由服务管理器控制后台运行修改通常无需在下修改此项保持即可代码段作用设置日志级别可选值有修改开发调试阶段可以设置为或生产环境通常设置为或以减少日志量代码段重启修改配置文件后您需要重启服务器以使更改生效重启方式取决于您如何在上运行作为服务运行如果您的实例是作为服务安装并运行的这是推荐的生产环境部署方式可以通过的服务管理器来重启按下键输入然后按回车键打开服务管理器在服务列表中找到名为或类似名称例如的服务右键点击该服务然后选择重启通过命令行手动运行如果您是通过命令行直接运行您需要先停止当前的进程然后重新启动它停止当前进程打开一个新的命令提示符或窗口使用连接到您的实例并发送命令如果设置了密码请添加参数如果运行在控制台窗口中发送命令后该控制台窗口通常会自动关闭使用更新后的配置文件启动服务器打开一个新的命令提示符或窗口导航到所在的目录执行以下命令指定您的配置文件路径或如果配置文件在其他路径这将会在当前控制台窗口中启动如果您想让它在后台运行不占用控制台可以考虑使用命令但通常建议安装为服务重启后您可以使用连接到并执行命令或命令来验证新的配置是否已生效基本操作在使用之前我们先了解库的基本操作连接创建客户端实例服务器地址如果有密码请填写数据库索引默认为命令检查连接应该输出设置和获取字符串设置一个键值对表示永不过期获取键的值如果键不存在删除键再次尝试获取已删除的键设置过期时间可以为键设置过期时间使其在一段时间后自动删除设置一个带过期时间的键秒后过期立即获取等待秒让键过期再次获取应该已经过期在中集成现在我们将把功能集成到应用程序中初始化客户端在应用程序启动时最好只初始化一次客户端并将其作为依赖注入到处理函数中或者存储在一个全局变量中但推荐依赖注入我们通常将客户端实例存储在的中或者作为自定义结构体的字段传递定义一个全局的客户端变量或者通过依赖注入服务器地址如果有密码请填写数据库索引测试连接初始化客户端注册相关的路由创建路由处理操作接下来我们将为操作创建的路由处理函数续处理路由将键值对存储到设置键值对并设置分钟过期时间处理路由从获取键的值处理路由从删除键方法返回受影响的键数量处理错误在实际应用中处理操作可能出现的错误至关重要库在键不存在时会返回错误其他网络或服务器错误则会返回不同的错误类型务必对这些错误进行检查和处理使用作为缓存最常见的用途之一是作为应用程序的缓存层我们可以创建一个中间件来实现简单的缓存功能实现缓存中间件这个中间件将尝试从获取响应如果命中缓存则直接返回如果未命中则继续执行后续处理函数并将结果缓存起来是一个简单的缓存中间件生成缓存键通常使用请求的或更复杂的哈希尝试从获取缓存数据缓存命中直接返回缓存的数据阻止后续处理函数执行如果出错不阻止请求继续执行创建一个响应写入器捕获响应内容继续处理请求检查状态码只缓存成功的响应将响应内容缓存到是一个自定义的用于捕获响应体函数续应用全局中间件设置一个带缓存的路由组将缓存中间件应用于此组缓存秒模拟一个耗时操作非缓存路由在路由中使用缓存在上面的例子中我们已经演示了如何将应用到一个路由组所有该组下的路由都会受益于缓存测试缓存启动服务器第一次访问您会看到日志输出和请求会延迟秒在秒内再次访问您会看到日志输出请求会立即返回且值与第一次相同因为它返回的是缓存的数据等待秒以上再次访问缓存过期您会再次看到和秒延迟值会更新访问每次访问都会立即返回没有缓存高级用法可选连接池客户端本身就包含了连接池管理在中您可以配置等选项来优化连接池行为最大连接数最小空闲连接数从连接池获取连接的超时时间空闲连接的关闭时间使用实现分布式锁当您有多个服务实例需要对共享资源进行互斥访问时可以使用实现分布式锁提供了和命令的封装可以用来构建简单的锁尝试获取分布式锁命令在键不存在时设置键值并设置过期时间如果设置成功返回如果键已存在返回释放分布式锁使用脚本确保原子性检查值是否匹配然后删除键这是为了防止释放了的锁在路由中使用建议使用或其他唯一标识执行需要加锁的业务逻辑模拟业务操作发布订阅支持发布订阅模式允许客户端订阅频道并接收其他客户端发布的消息这在实现实时通知或事件驱动架构时非常有用订阅一个频道确保订阅器在退出时关闭等待订阅就绪获取消息通道在这里处理接收到的消息例如推送到客户端启动一个监听消息发布消息的路由测试运行上面的应用程序访问查看应用程序的控制台输出您会看到表明消息已成功发布并被订阅者接收',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-06-02 20:40:41',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">LeoBlog</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://imgs.161517.xyz/2025/06/02/wechat-pay-qr.jpg" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://imgs.161517.xyz/2025/06/02/wechat-pay-qr.jpg"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://imgs.161517.xyz/2025/06/02/alipay-qr.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://imgs.161517.xyz/2025/06/02/alipay-qr.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Backend/" style="font-size: 1.05rem;">Backend<sup>1</sup></a><a href="/tags/GORM/" style="font-size: 1.05rem;">GORM<sup>1</sup></a><a href="/tags/Gin/" style="font-size: 1.05rem;">Gin<sup>1</sup></a><a href="/tags/Go/" style="font-size: 1.05rem;">Go<sup>1</sup></a><a href="/tags/Hexo/" style="font-size: 1.05rem;">Hexo<sup>1</sup></a><a href="/tags/Markdown/" style="font-size: 1.05rem;">Markdown<sup>1</sup></a><a href="/tags/Viper/" style="font-size: 1.05rem;">Viper<sup>1</sup></a><a href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" style="font-size: 1.05rem;">前端开发<sup>1</sup></a><a href="/tags/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/" style="font-size: 1.05rem;">博客搭建<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/06/"><span class="card-archive-list-date">六月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/03/"><span class="card-archive-list-date">三月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA/" itemprop="url">项目构建</a><i class="anzhiyufont anzhiyu-icon-angle-right post-meta-separator"></i><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA/%E5%90%8E%E7%AB%AF%E5%AD%A6%E4%B9%A0/" itemprop="url">后端学习</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/Backend/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>Backend</span></a><a class="article-meta__tags" href="/tags/Go/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>Go</span></a><a class="article-meta__tags" href="/tags/Gin/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>Gin</span></a><a class="article-meta__tags" href="/tags/Viper/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>Viper</span></a><a class="article-meta__tags" href="/tags/GORM/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>GORM</span></a></span></div></div><h1 class="post-title" itemprop="name headline">Go + Gin</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-06-02T12:30:45.605Z" title="发表于 2025-06-02 20:30:45">2025-06-02</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-06-02T12:40:41.290Z" title="更新于 2025-06-02 20:40:41">2025-06-02</time></span></div><div class="meta-secondline"><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为成都"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>成都</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://imgs.161517.xyz/2025/05/10/1008.jpg"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://example.com/2025/06/02/backend-go/"><header><a class="post-meta-categories" href="/categories/%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA/" itemprop="url">项目构建</a><a class="post-meta-categories" href="/categories/%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA/%E5%90%8E%E7%AB%AF%E5%AD%A6%E4%B9%A0/" itemprop="url">后端学习</a><a href="/tags/Backend/" tabindex="-1" itemprop="url">Backend</a><a href="/tags/Go/" tabindex="-1" itemprop="url">Go</a><a href="/tags/Gin/" tabindex="-1" itemprop="url">Gin</a><a href="/tags/Viper/" tabindex="-1" itemprop="url">Viper</a><a href="/tags/GORM/" tabindex="-1" itemprop="url">GORM</a><h1 id="CrawlerTitle" itemprop="name headline">Go + Gin</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">King Leonardo</span><time itemprop="dateCreated datePublished" datetime="2025-06-02T12:30:45.605Z" title="发表于 2025-06-02 20:30:45">2025-06-02</time><time itemprop="dateCreated datePublished" datetime="2025-06-02T12:40:41.290Z" title="更新于 2025-06-02 20:40:41">2025-06-02</time></header><h1 id="Go-项目工程化指南"><a href="#Go-项目工程化指南" class="headerlink" title="Go 项目工程化指南"></a>Go 项目工程化指南</h1><p>本文档旨在提供 Go 语言项目从零开始创建、管理依赖以及协作开发时可能遇到的工程性问题的解决方案。</p>
<h2 id="1-Go-项目的创建与初始化"><a href="#1-Go-项目的创建与初始化" class="headerlink" title="1. Go 项目的创建与初始化"></a>1. Go 项目的创建与初始化</h2><p>Go 语言的项目管理主要依赖于 Go Modules。从 Go 1.11 开始引入，并在 Go 1.16 成为默认。</p>
<h3 id="1-1-初始化一个新的-Go-Modules-项目"><a href="#1-1-初始化一个新的-Go-Modules-项目" class="headerlink" title="1.1 初始化一个新的 Go Modules 项目"></a>1.1 初始化一个新的 Go Modules 项目</h3><p>在你的工作目录下，创建一个新的项目文件夹，并进入该文件夹。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> my-go-project</span><br><span class="line"><span class="built_in">cd</span> my-go-project</span><br></pre></td></tr></table></figure>

<p>然后，运行 <code>go mod init</code> 命令来初始化 Go Module。这会在当前目录生成一个 <code>go.mod</code> 文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go mod init your_module_name <span class="comment"># 建议使用你的域名/用户名/项目名作为模块名，例如: github.com/your-username/my-go-project</span></span><br></pre></td></tr></table></figure>

<p><code>go.mod</code> 文件是 Go Modules 的核心，它定义了项目的模块路径、Go 版本以及项目的所有依赖。</p>
<h3 id="1-2-Go-项目基本结构"><a href="#1-2-Go-项目基本结构" class="headerlink" title="1.2 Go 项目基本结构"></a>1.2 Go 项目基本结构</h3><p>一个典型的 Go 项目结构如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">my-go-project/</span><br><span class="line">├── go.mod                <span class="comment"># 模块定义文件</span></span><br><span class="line">├── go.sum                <span class="comment"># 依赖校验和文件 (由 Go 自动维护，不要手动修改，始终随 go.mod 一起提交)</span></span><br><span class="line">├── main.go               <span class="comment"># 主程序入口文件 (如果项目只有一个入口点)</span></span><br><span class="line">├── config/               <span class="comment"># 配置文件目录，例如 config.json, application.yaml 等</span></span><br><span class="line">│   └── app.yaml</span><br><span class="line">├── internal/             <span class="comment"># 内部包，只能被当前模块内代码导入，不能被其他模块导入。</span></span><br><span class="line">│   ├── model/            <span class="comment"># 数据模型定义</span></span><br><span class="line">│   │   └── user.go</span><br><span class="line">│   └── service/          <span class="comment"># 业务逻辑服务</span></span><br><span class="line">│       └── user_service.go</span><br><span class="line">├── api/                  <span class="comment"># 外部接口定义，例如 RESTful API 接口定义，或者 Protobuf/Swagger 定义</span></span><br><span class="line">│   └── user_handler.go   <span class="comment"># API 路由及处理函数</span></span><br><span class="line">├── cmd/                  <span class="comment"># 包含多个主程序入口的目录，每个子目录代表一个可执行程序</span></span><br><span class="line">│   ├── web/              <span class="comment"># 例如：Web 服务器入口</span></span><br><span class="line">│   │   └── main.go</span><br><span class="line">│   └── cli/              <span class="comment"># 例如：命令行工具入口</span></span><br><span class="line">│       └── main.go</span><br><span class="line">├── pkg/                  <span class="comment"># 共享包，可以被当前模块和其他模块导入 (不常用，推荐 internal)</span></span><br><span class="line">│   └── utils/            <span class="comment"># 通用工具函数</span></span><br><span class="line">│       └── helper.go</span><br><span class="line">├── scripts/              <span class="comment"># 脚本文件，例如构建脚本、部署脚本等</span></span><br><span class="line">├── deployments/          <span class="comment"># 部署相关文件，例如 Kubernetes YAML，Ansible Playbooks</span></span><br><span class="line">├── tests/                <span class="comment"># 额外集成测试或性能测试 (与内部测试分开)</span></span><br><span class="line">├── .<span class="built_in">env</span>                  <span class="comment"># 环境变量文件 (敏感信息不提交 Git)</span></span><br><span class="line">├── Dockerfile            <span class="comment"># Docker 容器化文件</span></span><br><span class="line">├── README.md             <span class="comment"># 项目说明文档</span></span><br><span class="line">└── .gitignore            <span class="comment"># Git 忽略文件配置</span></span><br></pre></td></tr></table></figure>

<p><strong>关键点：</strong></p>
<ul>
<li><strong><code>go.mod</code></strong>: 模块定义文件，手动编辑或通过 <code>go get</code>、<code>go mod tidy</code> 等命令自动维护。</li>
<li><strong><code>go.sum</code></strong>: 记录了所有依赖的加密校验和，用于保证依赖的完整性和安全性。<strong>不要手动修改</strong>，始终随 <code>go.mod</code> 一起提交到版本控制。</li>
<li><strong><code>main.go</code></strong>: 通常是主程序的入口文件，如果项目简单只有一个可执行程序，可以放在根目录。如果项目包含多个可执行程序（如一个 Web 服务和一个命令行工具），则会将各自的 <code>main.go</code> 放在 <code>cmd/</code> 目录下的子目录中。</li>
<li><strong><code>internal/</code></strong>: 这是 Go 推荐的内部包存放位置。<code>internal</code> 目录下的包<strong>只能被当前模块内的代码导入和使用</strong>，不能被其他模块导入。这有助于限制包的可见性和职责。</li>
<li><strong><code>cmd/</code></strong>: 当你的项目包含多个独立的可执行文件时，这是组织它们的最佳实践。每个子目录都是一个独立的程序入口。例如，<code>cmd/web/main.go</code> 负责启动 Web 服务器，而 <code>cmd/cli/main.go</code> 负责启动一个命令行工具。</li>
</ul>
<h3 id="1-3-编译和打包成可执行文件"><a href="#1-3-编译和打包成可执行文件" class="headerlink" title="1.3 编译和打包成可执行文件"></a>1.3 编译和打包成可执行文件</h3><p>Go 语言提供了一个强大的 <code>go build</code> 命令，可以将你的 Go 源代码编译成独立的可执行二进制文件。</p>
<h4 id="1-3-1-基本编译"><a href="#1-3-1-基本编译" class="headerlink" title="1.3.1 基本编译"></a>1.3.1 基本编译</h4><p>在项目根目录下（<code>my-go-project/</code>）：</p>
<ul>
<li><p><strong>如果你的主程序入口是 <code>main.go</code> (在项目根目录)：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go build -o myapp .</span><br></pre></td></tr></table></figure>

<p>这条命令会编译当前目录下的 Go 源代码，并生成一个名为 <code>myapp</code> 的可执行文件。在 Windows 上会是 <code>myapp.exe</code>。</p>
</li>
<li><p><strong>如果你的主程序入口在 <code>cmd/</code> 目录下 (例如 <code>cmd/web/main.go</code>)：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go build -o myweb_app ./cmd/web</span><br></pre></td></tr></table></figure>

<p>这条命令会编译 <code>cmd/web</code> 目录下的 Go 源代码，并生成一个名为 <code>myweb_app</code> 的可执行文件。</p>
</li>
</ul>
<p>编译完成后，你会在当前目录（或者你指定的输出目录）找到这个可执行文件。你可以直接运行它：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./myapp <span class="comment"># Linux/macOS</span></span><br><span class="line">.\myapp.exe <span class="comment"># Windows</span></span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./myweb_app <span class="comment"># Linux/macOS</span></span><br><span class="line">.\myweb_app.exe <span class="comment"># Windows</span></span><br></pre></td></tr></table></figure>

<h4 id="1-3-2-交叉编译-Cross-Compilation"><a href="#1-3-2-交叉编译-Cross-Compilation" class="headerlink" title="1.3.2 交叉编译 (Cross-Compilation)"></a>1.3.2 交叉编译 (Cross-Compilation)</h4><p>Go 语言的强大之处在于其天生支持交叉编译，这意味着你可以在一个操作系统上编译出在另一个操作系统上运行的可执行文件，而无需安装目标平台的 Go 环境。</p>
<p>通过设置 <code>GOOS</code> (目标操作系统) 和 <code>GOARCH</code> (目标架构) 环境变量来实现：</p>
<p><strong>常用组合：</strong></p>
<ul>
<li><p><strong>Linux (64-bit AMD)</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GOOS=linux GOARCH=amd64 go build -o myapp_linux_amd64 .</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Windows (64-bit AMD)</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GOOS=windows GOARCH=amd64 go build -o myapp_windows_amd64.exe .</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>macOS (64-bit Intel)</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GOOS=darwin GOARCH=amd64 go build -o myapp_darwin_amd64 .</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>macOS (ARM64 &#x2F; Apple Silicon)</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GOOS=darwin GOARCH=arm64 go build -o myapp_darwin_arm64 .</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Linux (ARM64)</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GOOS=linux GOARCH=arm64 go build -o myapp_linux_arm64 .</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>完整的 <code>GOOS</code> 和 <code>GOARCH</code> 列表，请运行：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go tool dist list</span><br></pre></td></tr></table></figure>

<h4 id="1-3-3-减小可执行文件大小"><a href="#1-3-3-减小可执行文件大小" class="headerlink" title="1.3.3 减小可执行文件大小"></a>1.3.3 减小可执行文件大小</h4><p>对于生产环境部署，你可能希望减小可执行文件的大小。可以使用 <code>-ldflags</code> 编译标志：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go build -o myapp -ldflags <span class="string">&quot;-s -w&quot;</span> .</span><br></pre></td></tr></table></figure>

<ul>
<li><code>-s</code>: 移除符号表（debug information）。</li>
<li><code>-w</code>: 移除 DWARF 调试信息。</li>
</ul>
<p>这会显著减小二进制文件大小，但也会使调试变得困难。</p>
<h4 id="1-3-4-生成静态链接的二进制文件-推荐用于-Docker"><a href="#1-3-4-生成静态链接的二进制文件-推荐用于-Docker" class="headerlink" title="1.3.4 生成静态链接的二进制文件 (推荐用于 Docker)"></a>1.3.4 生成静态链接的二进制文件 (推荐用于 Docker)</h4><p>如果你的 Go 程序使用了 CGO (例如，某些数据库驱动或图像处理库)，生成的二进制文件可能会依赖系统上的 C 库。为了生成完全独立的二进制文件（特别适合 Docker 镜像），可以禁用 CGO：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -o myapp_static_linux -ldflags <span class="string">&quot;-s -w&quot;</span> .</span><br></pre></td></tr></table></figure>

<ul>
<li><code>CGO_ENABLED=0</code>: 禁用 CGO。</li>
<li><code>GOOS=linux GOARCH=amd64</code>: 确保编译目标是 Linux AMD64，这是大多数生产环境 Docker 容器的默认环境。</li>
</ul>
<p>这会生成一个完全静态链接的二进制文件，不依赖目标系统的任何 C 库，非常适合构建轻量级的 Docker 镜像 (例如基于 <code>scratch</code> 或 <code>alpine</code> 的镜像)。</p>
<h2 id="2-依赖管理"><a href="#2-依赖管理" class="headerlink" title="2. 依赖管理"></a>2. 依赖管理</h2><p>Go Modules 让依赖管理变得非常简单。</p>
<h3 id="2-1-添加新的依赖"><a href="#2-1-添加新的依赖" class="headerlink" title="2.1 添加新的依赖"></a>2.1 添加新的依赖</h3><p>当你需要引入一个新的第三方库时，可以在代码中直接 <code>import</code> 它。然后，运行以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get github.com/gin-gonic/gin <span class="comment"># 将 gin 框架添加到你的项目中</span></span><br></pre></td></tr></table></figure>

<p>或者，你也可以只在代码中 <code>import</code> 新的包，然后运行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go mod tidy <span class="comment"># Go 会自动分析代码，下载所有缺失的依赖，并清理不再使用的依赖</span></span><br></pre></td></tr></table></figure>

<p>这两种方式都会更新 <code>go.mod</code> 和 <code>go.sum</code> 文件。</p>
<h3 id="2-2-更新现有依赖"><a href="#2-2-更新现有依赖" class="headerlink" title="2.2 更新现有依赖"></a>2.2 更新现有依赖</h3><p>要将某个依赖更新到最新版本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">go get -u github.com/gin-gonic/gin <span class="comment"># 更新到最新的兼容版本</span></span><br><span class="line">go get -u=patch github.com/gin-gonic/gin <span class="comment"># 只更新到最新的补丁版本</span></span><br><span class="line">go get github.com/gin-gonic/gin@v1.7.0 <span class="comment"># 更新到指定版本</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-移除不再使用的依赖"><a href="#2-3-移除不再使用的依赖" class="headerlink" title="2.3 移除不再使用的依赖"></a>2.3 移除不再使用的依赖</h3><p>如果你的代码不再使用某个依赖，<code>go mod tidy</code> 命令会自动帮你清理 <code>go.mod</code> 和 <code>go.sum</code> 文件中的相关条目。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go mod tidy</span><br></pre></td></tr></table></figure>

<h3 id="2-4-查看依赖图"><a href="#2-4-查看依赖图" class="headerlink" title="2.4 查看依赖图"></a>2.4 查看依赖图</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go mod graph <span class="comment"># 显示模块依赖图</span></span><br></pre></td></tr></table></figure>

<h3 id="2-5-供应商模式-Vendor-Mode"><a href="#2-5-供应商模式-Vendor-Mode" class="headerlink" title="2.5 供应商模式 (Vendor Mode)"></a>2.5 供应商模式 (Vendor Mode)</h3><p>在某些特定场景下（例如，网络环境受限、严格的依赖版本控制），你可能希望将所有依赖的源代码复制到项目本地的 <code>vendor</code> 目录中。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go mod vendor</span><br></pre></td></tr></table></figure>

<p>这会在项目根目录创建一个 <code>vendor</code> 文件夹，包含所有依赖的源代码。</p>
<ul>
<li><p>启用 vendor 模式编译:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">go build -mod=vendor</span><br><span class="line">go run -mod=vendor .</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>注意</strong>: 默认情况下，Go 会优先使用 Go Modules Proxy 进行依赖下载。只有在显式指定 <code>-mod=vendor</code> 时，或者在 Go Modules Proxy 不可用的情况下，才会使用 <code>vendor</code> 目录。对于大多数现代 Go 项目，不建议默认使用 <code>vendor</code> 模式，直接依赖 Go Modules Proxy 更简单。</p>
</li>
</ul>
<h2 id="3-拉取别人的-Go-项目并下载依赖"><a href="#3-拉取别人的-Go-项目并下载依赖" class="headerlink" title="3. 拉取别人的 Go 项目并下载依赖"></a>3. 拉取别人的 Go 项目并下载依赖</h2><p>当你 <code>git clone</code> 了一个 Go 项目后，安装其依赖通常非常简单。</p>
<h3 id="3-1-克隆项目"><a href="#3-1-克隆项目" class="headerlink" title="3.1 克隆项目"></a>3.1 克隆项目</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/some-user/some-go-project.git</span><br><span class="line"><span class="built_in">cd</span> some-go-project</span><br></pre></td></tr></table></figure>

<h3 id="3-2-下载并安装依赖"><a href="#3-2-下载并安装依赖" class="headerlink" title="3.2 下载并安装依赖"></a>3.2 下载并安装依赖</h3><p>进入项目根目录（即 <code>go.mod</code> 文件所在的目录），然后运行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go mod tidy</span><br></pre></td></tr></table></figure>

<p>这个命令会执行以下操作：</p>
<ol>
<li><strong>读取 <code>go.mod</code></strong>: 解析项目所需的模块及其版本。</li>
<li><strong>下载模块</strong>: 如果本地 Go Module 缓存中没有这些模块，它会从 Go Modules Proxy（默认是 <code>proxy.golang.org</code>，在国内可能需要配置代理）下载。</li>
<li><strong>验证校验和</strong>: 检查 <code>go.sum</code> 文件中记录的校验和，确保下载的模块没有被篡改。</li>
<li><strong>清理</strong>: 如果代码中不再使用的依赖，会从 <code>go.mod</code> 和 <code>go.sum</code> 中移除。</li>
</ol>
<p><strong>这是最推荐和最常用的方法。</strong></p>
<h3 id="3-3-编译和运行项目"><a href="#3-3-编译和运行项目" class="headerlink" title="3.3 编译和运行项目"></a>3.3 编译和运行项目</h3><p>在依赖下载完成后，你可以直接编译或运行项目：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">go build .       <span class="comment"># 编译当前目录下的 Go 项目，生成可执行文件</span></span><br><span class="line">./your_executable <span class="comment"># 运行编译后的可执行文件</span></span><br><span class="line"></span><br><span class="line">go run .         <span class="comment"># 直接运行当前目录下的 Go 项目 (不会生成可执行文件)</span></span><br></pre></td></tr></table></figure>

<p>如果项目有多个命令行入口（例如 <code>cmd/</code> 目录），你需要指定要运行的入口文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go run ./cmd/mycli</span><br></pre></td></tr></table></figure>

<h3 id="3-4-处理网络代理问题"><a href="#3-4-处理网络代理问题" class="headerlink" title="3.4 处理网络代理问题"></a>3.4 处理网络代理问题</h3><p>在中国大陆地区，访问 <code>proxy.golang.org</code> 或一些 GitHub 上的 Go 模块可能会遇到网络问题。你可以设置 Go 代理：</p>
<p><strong>临时设置：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> GOPROXY=https://goproxy.cn,direct</span><br></pre></td></tr></table></figure>

<p><strong>永久设置（推荐加入到 <code>~/.bashrc</code>, <code>~/.zshrc</code> 或 <code>~/.profile</code> 中）：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go <span class="built_in">env</span> -w GOPROXY=https://goproxy.cn,direct</span><br></pre></td></tr></table></figure>

<p>这将把 <code>GOPROXY</code> 设置为国内的 Go 模块代理 <code>goproxy.cn</code>。<code>direct</code> 表示如果代理失败，尝试直接连接。</p>
<h3 id="3-5-处理私有仓库依赖"><a href="#3-5-处理私有仓库依赖" class="headerlink" title="3.5 处理私有仓库依赖"></a>3.5 处理私有仓库依赖</h3><p>如果项目依赖了私有 Git 仓库（例如公司内部的 GitLab 仓库），Go 可能无法直接下载。你需要配置 <code>GOPRIVATE</code> 或 <code>GONOPROXY</code>&#x2F;<code>GONOSUM</code>。</p>
<p><strong><code>GOPRIVATE</code></strong>: 告诉 Go 哪些模块是私有的，不要通过公共代理去查找。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go <span class="built_in">env</span> -w GOPRIVATE=git.example.com/* <span class="comment"># 假设你的私有仓库都在 git.example.com 下</span></span><br></pre></td></tr></table></figure>

<p>Go 在处理 <code>GOPRIVATE</code> 中定义的模块时，会直接从版本控制系统（如 Git）拉取，而不是通过 <code>GOPROXY</code>。这意味着你需要确保 Git 客户端配置了正确的认证方式（例如 SSH 密钥或用户名&#x2F;密码）。</p>
<h2 id="4-常见的工程化问题与解决方案"><a href="#4-常见的工程化问题与解决方案" class="headerlink" title="4. 常见的工程化问题与解决方案"></a>4. 常见的工程化问题与解决方案</h2><h3 id="4-1-解决依赖版本冲突"><a href="#4-1-解决依赖版本冲突" class="headerlink" title="4.1 解决依赖版本冲突"></a>4.1 解决依赖版本冲突</h3><p>当两个依赖包共同依赖于同一个第三方包，但要求不同版本时，可能会发生冲突。</p>
<ul>
<li><p><strong><code>go mod tidy</code></strong>: 优先尝试运行 <code>go mod tidy</code>。Go Modules 的最小版本选择 (MVS) 算法通常能很好地解决冲突，它会选择所有依赖方都满足的最低兼容版本。</p>
</li>
<li><p>手动调整 <code>go.mod</code>:  <code>go mod tidy</code> 如果无法解决，你可以手动在 <code>go.mod</code>中使用 <code>require</code>指令明确指定一个版本，或者使用 <code>replace</code>指令替换掉某个模块。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// go.mod 示例</span></span><br><span class="line">module my-<span class="keyword">go</span>-project</span><br><span class="line"></span><br><span class="line"><span class="keyword">go</span> <span class="number">1.22</span></span><br><span class="line"></span><br><span class="line">require (</span><br><span class="line">    github.com/gin-gonic/gin v1<span class="number">.9</span><span class="number">.0</span></span><br><span class="line">    github.com/spf13/viper v1<span class="number">.11</span><span class="number">.0</span> <span class="comment">// 假设冲突，你需要指定这个版本</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 替换本地模块 (用于开发或测试)</span></span><br><span class="line"><span class="comment">// replace example.com/my/local/module =&gt; ../my/local/module</span></span><br><span class="line"><span class="comment">// 替换远程模块 (例如，修复了上游 bug)</span></span><br><span class="line"><span class="comment">// replace github.com/old/module v1.2.3 =&gt; github.com/new/module v1.2.4</span></span><br></pre></td></tr></table></figure>

<p>注意: <code>replace</code> 指令通常只在开发环境中或为了解决特定问题时使用，不建议大量用于生产环境，因为它可能导致构建环境不一致。</p>
</li>
</ul>
<h3 id="4-2-跨平台编译"><a href="#4-2-跨平台编译" class="headerlink" title="4.2 跨平台编译"></a>4.2 跨平台编译</h3><p>Go 语言支持轻松地进行交叉编译。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编译 Linux 64-bit 可执行文件</span></span><br><span class="line">GOOS=linux GOARCH=amd64 go build -o myapp_linux_amd64 .</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编译 Windows 64-bit 可执行文件</span></span><br><span class="line">GOOS=windows GOARCH=amd64 go build -o myapp_windows_amd64.exe .</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编译 macOS ARM64 (Apple Silicon) 可执行文件</span></span><br><span class="line">GOOS=darwin GOARCH=arm64 go build -o myapp_darwin_arm64 .</span><br></pre></td></tr></table></figure>

<p><code>GOOS</code> 和 <code>GOARCH</code> 是 Go 环境变量，分别指定目标操作系统和架构。</p>
<h3 id="4-3-代码风格检查与格式化"><a href="#4-3-代码风格检查与格式化" class="headerlink" title="4.3 代码风格检查与格式化"></a>4.3 代码风格检查与格式化</h3><p>Go 社区有强大的工具来强制一致的代码风格。</p>
<ul>
<li><p><strong><code>go fmt</code></strong>: 格式化代码，使所有代码符合 Go 官方风格。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go <span class="built_in">fmt</span> ./... <span class="comment"># 格式化当前模块所有 Go 文件</span></span><br></pre></td></tr></table></figure>

<p>建议在提交代码前执行此命令。大多数 IDE (如 GoLand, VS Code) 都会在保存时自动运行 <code>go fmt</code>。</p>
</li>
<li><p><strong><code>golint</code> (已弃用，推荐 <code>staticcheck</code>)</strong>: 静态代码分析工具，用于检查潜在的代码问题和风格建议。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">go get golang.org/x/lint/golint <span class="comment"># 如果没有安装</span></span><br><span class="line">golint ./...</span><br></pre></td></tr></table></figure>

<p><strong>注意：<code>golint</code> 已经不再维护，推荐使用 <code>staticcheck</code>。</strong></p>
</li>
<li><p><strong><code>staticcheck</code></strong>: 更强大的静态分析工具集。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">go install honnef.co/go/tools/cmd/staticcheck@latest <span class="comment"># 安装</span></span><br><span class="line">staticcheck ./...</span><br></pre></td></tr></table></figure>

<p>建议在 CI&#x2F;CD 流程中集成 <code>staticcheck</code>。</p>
</li>
</ul>
<h3 id="4-4-单元测试与集成测试"><a href="#4-4-单元测试与集成测试" class="headerlink" title="4.4 单元测试与集成测试"></a>4.4 单元测试与集成测试</h3><p>Go 内置了测试框架。</p>
<ul>
<li><p><strong>编写测试</strong>: 在与 Go 源文件同级的目录下创建 <code>_test.go</code> 文件。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// my_package_test.go</span></span><br><span class="line"><span class="keyword">package</span> my_package</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;testing&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestMyFunction</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    <span class="comment">// ... 测试逻辑</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>运行测试</strong>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">go <span class="built_in">test</span> ./... <span class="comment"># 运行当前模块所有测试</span></span><br><span class="line">go <span class="built_in">test</span> -v ./... <span class="comment"># 详细输出测试结果</span></span><br><span class="line">go <span class="built_in">test</span> -cover ./... <span class="comment"># 运行测试并生成代码覆盖率报告</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="4-5-Git-版本控制最佳实践"><a href="#4-5-Git-版本控制最佳实践" class="headerlink" title="4.5 Git 版本控制最佳实践"></a>4.5 Git 版本控制最佳实践</h3><ul>
<li><p><strong>始终提交 <code>go.mod</code> 和 <code>go.sum</code></strong>: 它们定义了项目的依赖，必须和代码一起版本控制。</p>
</li>
<li><p>使用 <code>.gitignore</code>: 忽略编译生成的可执行文件、临时文件、编辑器生成的文件等。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># Binaries for programs and plugins</span><br><span class="line">*.exe</span><br><span class="line">*.dll</span><br><span class="line">*.so</span><br><span class="line">*.dylib</span><br><span class="line">*.rpm</span><br><span class="line">*.deb</span><br><span class="line">*.ko</span><br><span class="line"></span><br><span class="line"># Test binary, generated with `go test -c`</span><br><span class="line">*.test</span><br><span class="line"></span><br><span class="line"># Output of the go toolchain when building a test binary using stubs (race detector, cgo)</span><br><span class="line">*.out</span><br><span class="line"></span><br><span class="line"># External tool specific artifacts</span><br><span class="line">.idea/ # GoLand IDE files</span><br><span class="line">.vscode/ # VS Code IDE files</span><br><span class="line">.DS_Store</span><br><span class="line"></span><br><span class="line"># Dependencies (vendor folder)</span><br><span class="line"># vendor/ # 如果不使用 vendor 模式，可以不忽略</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="4-6-Docker-化-Go-应用"><a href="#4-6-Docker-化-Go-应用" class="headerlink" title="4.6 Docker 化 Go 应用"></a>4.6 Docker 化 Go 应用</h3><p>将 Go 应用打包成 Docker 镜像以方便部署。</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Dockerfile 示例 (多阶段构建)</span></span><br><span class="line"><span class="comment"># 阶段 1: 构建</span></span><br><span class="line"><span class="keyword">FROM</span> golang:<span class="number">1.22</span> AS builder</span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拷贝 go.mod 和 go.sum 以利用 Docker 缓存</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> go.mod go.sum ./</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> go mod download</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拷贝源代码</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . .</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 编译应用</span></span><br><span class="line"><span class="comment"># CGO_ENABLED=0 是为了生成静态链接的可执行文件，更易于分发</span></span><br><span class="line"><span class="comment"># -a 强制重新编译所有包</span></span><br><span class="line"><span class="comment"># -installsuffix cgo 解决 cgo 静态链接问题</span></span><br><span class="line"><span class="comment"># -ldflags &quot;-s -w&quot; 移除调试信息和符号表，减小镜像大小</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -ldflags <span class="string">&quot;-s -w&quot;</span> -o main ./cmd/your_app <span class="comment"># 根据你的入口调整</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 阶段 2: 运行</span></span><br><span class="line"><span class="keyword">FROM</span> alpine:latest</span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /root/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从构建阶段复制可执行文件</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=builder /app/main .</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 暴露端口 (如果你的应用是 Web 服务)</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行应用</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;./main&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p><strong>构建 Docker 镜像：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t my-go-app .</span><br></pre></td></tr></table></figure>

<p><strong>运行 Docker 容器：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 8080:8080 my-go-app</span><br></pre></td></tr></table></figure>

<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>通过遵循这些 Go 项目工程化指南，你将能够更高效、更规范地创建、维护和协作 Go 语言项目。良好的工程实践是保证项目质量和长期可维护性的关键。</p>
<hr>
<h1 id="Gin-Web-Framework"><a href="#Gin-Web-Framework" class="headerlink" title="Gin Web Framework"></a>Gin Web Framework</h1><p>Gin 是一个用 Go 语言编写的 HTTP Web 框架，它以其高性能和低内存占用而闻名。Gin 具有类似 Martini 的 API，但性能更好，这得益于其高度优化的 HTTP 路由器。</p>
<p>本文档将介绍 Gin 的核心概念和常用功能，包括路由、参数绑定、JSON 响应、中间件等。</p>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>首先，你需要安装 Gin 框架：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get -u github.com/gin-gonic/gin</span><br></pre></td></tr></table></figure>

<h3 id="基础结构"><a href="#基础结构" class="headerlink" title="基础结构"></a>基础结构</h3><p>一个基本的 Gin 应用通常包含以下部分：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;net/http&quot;</span> <span class="comment">// 用于 HTTP 状态码</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span>      <span class="comment">// 用于打印输出</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 1. 创建一个 Gin 路由器实例</span></span><br><span class="line">	<span class="comment">// gin.Default() 包含了 Logger 和 Recovery 中间件</span></span><br><span class="line">	router := gin.Default()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 2. 定义路由和处理函数 (Handlers)</span></span><br><span class="line">	router.GET(<span class="string">&quot;/&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		<span class="comment">// c.JSON() 方法用于返回 JSON 响应</span></span><br><span class="line">		c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">			<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Hello, Gin!&quot;</span>,</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	router.GET(<span class="string">&quot;/ping&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		c.String(http.StatusOK, <span class="string">&quot;pong&quot;</span>) <span class="comment">// c.String() 用于返回纯文本响应</span></span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 3. 运行服务器</span></span><br><span class="line">	<span class="comment">// 默认在 8080 端口启动</span></span><br><span class="line">	<span class="keyword">if</span> err := router.Run(<span class="string">&quot;:8080&quot;</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;Server failed to start: %v\n&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行 <code>go run your_app.go</code> 后，访问 <code>http://localhost:8080</code> 或 <code>http://localhost:8080/ping</code> 即可看到效果。</p>
<h2 id="1-路由-Routing"><a href="#1-路由-Routing" class="headerlink" title="1. 路由 (Routing)"></a>1. 路由 (Routing)</h2><p>Gin 提供了简洁的 API 来定义各种 HTTP 请求方法的路由。</p>
<h3 id="1-1-基本路由"><a href="#1-1-基本路由" class="headerlink" title="1.1 基本路由"></a>1.1 基本路由</h3><p>你可以使用 <code>router.GET()</code>, <code>router.POST()</code>, <code>router.PUT()</code>, <code>router.DELETE()</code>, <code>router.PATCH()</code>, <code>router.HEAD()</code>, <code>router.OPTIONS()</code> 等方法来处理不同的 HTTP 请求。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GET 请求</span></span><br><span class="line">router.GET(<span class="string">&quot;/users&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;data&quot;</span>: <span class="string">&quot;Get all users&quot;</span>&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// POST 请求</span></span><br><span class="line">router.POST(<span class="string">&quot;/users&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    c.JSON(http.StatusCreated, gin.H&#123;<span class="string">&quot;data&quot;</span>: <span class="string">&quot;Create a new user&quot;</span>&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// PUT 请求</span></span><br><span class="line">router.PUT(<span class="string">&quot;/users/:id&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    id := c.Param(<span class="string">&quot;id&quot;</span>) <span class="comment">// 获取路径参数</span></span><br><span class="line">    c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;data&quot;</span>: <span class="string">&quot;Update user &quot;</span> + id&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// DELETE 请求</span></span><br><span class="line">router.DELETE(<span class="string">&quot;/users/:id&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    id := c.Param(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">    c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;data&quot;</span>: <span class="string">&quot;Delete user &quot;</span> + id&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="1-2-路径参数-Path-Parameters"><a href="#1-2-路径参数-Path-Parameters" class="headerlink" title="1.2 路径参数 (Path Parameters)"></a>1.2 路径参数 (Path Parameters)</h3><p>使用冒号 <code>:</code> 定义路径参数。你可以通过 <code>c.Param(&quot;参数名&quot;)</code> 来获取。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 匹配 /users/123, /users/abc 等</span></span><br><span class="line">router.GET(<span class="string">&quot;/users/:id&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	id := c.Param(<span class="string">&quot;id&quot;</span>) <span class="comment">// 获取路径参数 &quot;id&quot;</span></span><br><span class="line">	c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;user_id&quot;</span>: id&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 多参数匹配</span></span><br><span class="line">router.GET(<span class="string">&quot;/users/:id/:action&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	id := c.Param(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">	action := c.Param(<span class="string">&quot;action&quot;</span>)</span><br><span class="line">	c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;user_id&quot;</span>: id, <span class="string">&quot;action&quot;</span>: action&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="1-3-查询字符串参数-Query-String-Parameters"><a href="#1-3-查询字符串参数-Query-String-Parameters" class="headerlink" title="1.3 查询字符串参数 (Query String Parameters)"></a>1.3 查询字符串参数 (Query String Parameters)</h3><p>通过 <code>c.Query(&quot;参数名&quot;)</code> 或 <code>c.DefaultQuery(&quot;参数名&quot;, &quot;默认值&quot;)</code> 获取 URL 中的查询参数。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 访问 /search?name=test&amp;age=18</span></span><br><span class="line">router.GET(<span class="string">&quot;/search&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	name := c.Query(<span class="string">&quot;name&quot;</span>)              <span class="comment">// 获取 &quot;name&quot; 参数，如果不存在则为空字符串</span></span><br><span class="line">	age := c.DefaultQuery(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;0&quot;</span>) <span class="comment">// 获取 &quot;age&quot; 参数，如果不存在则为 &quot;0&quot;</span></span><br><span class="line"></span><br><span class="line">	c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">		<span class="string">&quot;name&quot;</span>: name,</span><br><span class="line">		<span class="string">&quot;age&quot;</span>:  age,</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="1-4-路由组-Route-Groups"><a href="#1-4-路由组-Route-Groups" class="headerlink" title="1.4 路由组 (Route Groups)"></a>1.4 路由组 (Route Groups)</h3><p>使用 <code>router.Group()</code> 可以组织路由，并为路由组应用相同的中间件。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建一个 /api/v1 路由组</span></span><br><span class="line">v1 := router.Group(<span class="string">&quot;/api/v1&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">	v1.GET(<span class="string">&quot;/posts&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Get all v1 posts&quot;</span>&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line">	v1.POST(<span class="string">&quot;/posts&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		c.JSON(http.StatusCreated, gin.H&#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Create a v1 post&quot;</span>&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个 /api/v2 路由组</span></span><br><span class="line">v2 := router.Group(<span class="string">&quot;/api/v2&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">	v2.GET(<span class="string">&quot;/users&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Get all v2 users&quot;</span>&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-参数绑定-Binding"><a href="#2-参数绑定-Binding" class="headerlink" title="2. 参数绑定 (Binding)"></a>2. 参数绑定 (Binding)</h2><p>Gin 提供了强大的参数绑定功能，可以将请求数据（JSON, Form, Query 等）自动绑定到 Go 结构体。</p>
<h3 id="2-1-JSON-请求体绑定"><a href="#2-1-JSON-请求体绑定" class="headerlink" title="2.1 JSON 请求体绑定"></a>2.1 JSON 请求体绑定</h3><p>使用 <code>c.BindJSON(&amp;struct&#123;&#125;)</code> 或 <code>c.ShouldBindJSON(&amp;struct&#123;&#125;)</code>。<code>ShouldBindJSON</code> 在绑定失败时会返回错误，你可以根据错误进行处理。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> LoginForm <span class="keyword">struct</span> &#123;</span><br><span class="line">	User     <span class="type">string</span> <span class="string">`json:&quot;user&quot; binding:&quot;required&quot;`</span>     <span class="comment">// `required` 标签表示该字段是必需的</span></span><br><span class="line">	Password <span class="type">string</span> <span class="string">`json:&quot;password&quot; binding:&quot;required&quot;`</span> <span class="comment">// `json` 标签用于 JSON 字段名映射</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">router.POST(<span class="string">&quot;/login&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> form LoginForm</span><br><span class="line">	<span class="comment">// Try to bind JSON to form</span></span><br><span class="line">	<span class="keyword">if</span> err := c.ShouldBindJSON(&amp;form); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		c.JSON(http.StatusBadRequest, gin.H&#123;<span class="string">&quot;error&quot;</span>: err.Error()&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> form.User == <span class="string">&quot;admin&quot;</span> &amp;&amp; form.Password == <span class="string">&quot;password&quot;</span> &#123;</span><br><span class="line">		c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;login success&quot;</span>&#125;)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		c.JSON(http.StatusUnauthorized, gin.H&#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;unauthorized&quot;</span>&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>示例 JSON 请求体:</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;user&quot;</span><span class="punctuation">:</span> <span class="string">&quot;admin&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;password&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-Form-x-www-form-urlencoded-或-multipart-form-data-绑定"><a href="#2-2-Form-x-www-form-urlencoded-或-multipart-form-data-绑定" class="headerlink" title="2.2 Form (x-www-form-urlencoded 或 multipart&#x2F;form-data) 绑定"></a>2.2 Form (x-www-form-urlencoded 或 multipart&#x2F;form-data) 绑定</h3><p>使用 <code>c.Bind(&amp;struct&#123;&#125;)</code> 或 <code>c.ShouldBind(&amp;struct&#123;&#125;)</code>。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> UserForm <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name  <span class="type">string</span> <span class="string">`form:&quot;name&quot; binding:&quot;required&quot;`</span></span><br><span class="line">	Email <span class="type">string</span> <span class="string">`form:&quot;email&quot; binding:&quot;required,email&quot;`</span> <span class="comment">// 示例：email 字段需要是有效的邮箱格式</span></span><br><span class="line">	Age   <span class="type">int</span>    <span class="string">`form:&quot;age&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">router.POST(<span class="string">&quot;/submit_user&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> userForm UserForm</span><br><span class="line">	<span class="keyword">if</span> err := c.ShouldBind(&amp;userForm); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		c.JSON(http.StatusBadRequest, gin.H&#123;<span class="string">&quot;error&quot;</span>: err.Error()&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;User received&quot;</span>, <span class="string">&quot;user&quot;</span>: userForm&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>示例 Form 请求体 (Content-Type: application&#x2F;x-www-form-urlencoded):</strong> <code>name=John+Doe&amp;email=john%40example.com&amp;age=30</code></p>
<h3 id="2-3-查询参数绑定"><a href="#2-3-查询参数绑定" class="headerlink" title="2.3 查询参数绑定"></a>2.3 查询参数绑定</h3><p>可以将查询参数绑定到结构体。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> PersonQuery <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="type">string</span> <span class="string">`form:&quot;name&quot;`</span></span><br><span class="line">	City <span class="type">string</span> <span class="string">`form:&quot;city&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">router.GET(<span class="string">&quot;/person&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> person PersonQuery</span><br><span class="line">	<span class="keyword">if</span> c.ShouldBindQuery(&amp;person) == <span class="literal">nil</span> &#123;</span><br><span class="line">		c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;query_name&quot;</span>: person.Name, <span class="string">&quot;query_city&quot;</span>: person.City&#125;)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		c.JSON(http.StatusBadRequest, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Invalid query parameters&quot;</span>&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>示例 URL:</strong> <code>/person?name=Alice&amp;city=NewYork</code></p>
<h2 id="3-响应-Responses"><a href="#3-响应-Responses" class="headerlink" title="3. 响应 (Responses)"></a>3. 响应 (Responses)</h2><p>Gin 提供了多种发送响应的方法。</p>
<h3 id="3-1-JSON-响应"><a href="#3-1-JSON-响应" class="headerlink" title="3.1 JSON 响应"></a>3.1 JSON 响应</h3><p>这是最常用的响应类型。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// c.JSON(http.StatusOK, gin.H&#123;&quot;foo&quot;: &quot;bar&quot;&#125;) // 简单的 map</span></span><br><span class="line"><span class="comment">// c.JSON(http.StatusOK, someStructInstance)    // Go 结构体</span></span><br><span class="line"><span class="comment">// c.JSON(http.StatusOK, []SomeStruct&#123;&#125;)        // 结构体切片</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-纯文本响应"><a href="#3-2-纯文本响应" class="headerlink" title="3.2 纯文本响应"></a>3.2 纯文本响应</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c.String(http.StatusOK, <span class="string">&quot;Hello, %s&quot;</span>, <span class="string">&quot;World&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="3-3-HTML-响应"><a href="#3-3-HTML-响应" class="headerlink" title="3.3 HTML 响应"></a>3.3 HTML 响应</h3><p>你需要加载 HTML 模板。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 加载模板文件</span></span><br><span class="line">router.LoadHTMLGlob(<span class="string">&quot;templates/*&quot;</span>) <span class="comment">// 假设 HTML 文件在 templates 目录下</span></span><br><span class="line"></span><br><span class="line">router.GET(<span class="string">&quot;/index&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	c.HTML(http.StatusOK, <span class="string">&quot;index.html&quot;</span>, gin.H&#123;</span><br><span class="line">		<span class="string">&quot;title&quot;</span>: <span class="string">&quot;Gin HTML Page&quot;</span>,</span><br><span class="line">		<span class="string">&quot;data&quot;</span>:  <span class="string">&quot;Welcome to Gin!&quot;</span>,</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><strong><code>templates/index.html</code> 示例:</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>&#123;&#123; .title &#125;&#125;<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123; .data &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-4-重定向-Redirect"><a href="#3-4-重定向-Redirect" class="headerlink" title="3.4 重定向 (Redirect)"></a>3.4 重定向 (Redirect)</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">router.GET(<span class="string">&quot;/redirect&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	c.Redirect(http.StatusMovedPermanently, <span class="string">&quot;http://www.google.com&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="4-中间件-Middlewares"><a href="#4-中间件-Middlewares" class="headerlink" title="4. 中间件 (Middlewares)"></a>4. 中间件 (Middlewares)</h2><p>中间件是在请求被处理之前或之后执行的代码。Gin 支持全局中间件、路由组中间件和单个路由中间件。</p>
<h3 id="4-1-全局中间件"><a href="#4-1-全局中间件" class="headerlink" title="4.1 全局中间件"></a>4.1 全局中间件</h3><p>应用于所有路由。<code>gin.Default()</code> 已经默认包含了 <code>Logger</code> 和 <code>Recovery</code>。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 手动添加中间件 (如果不用 gin.Default())</span></span><br><span class="line"><span class="comment">// router := gin.New()</span></span><br><span class="line"><span class="comment">// router.Use(gin.Logger())   // 请求日志</span></span><br><span class="line"><span class="comment">// router.Use(gin.Recovery()) // 崩溃恢复</span></span><br></pre></td></tr></table></figure>

<h3 id="4-2-路由组中间件"><a href="#4-2-路由组中间件" class="headerlink" title="4.2 路由组中间件"></a>4.2 路由组中间件</h3><p>应用于路由组内的所有路由。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">AuthMiddleware</span><span class="params">()</span></span> gin.HandlerFunc &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		token := c.GetHeader(<span class="string">&quot;Authorization&quot;</span>)</span><br><span class="line">		<span class="keyword">if</span> token != <span class="string">&quot;valid-token&quot;</span> &#123; <span class="comment">// 简单模拟认证</span></span><br><span class="line">			c.AbortWithStatusJSON(http.StatusUnauthorized, gin.H&#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Unauthorized&quot;</span>&#125;)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">		c.Next() <span class="comment">// 调用链中的下一个中间件或处理函数</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">authorized := router.Group(<span class="string">&quot;/admin&quot;</span>, AuthMiddleware()) <span class="comment">// 为 /admin 组应用 AuthMiddleware</span></span><br><span class="line">&#123;</span><br><span class="line">	authorized.GET(<span class="string">&quot;/dashboard&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Welcome to admin dashboard&quot;</span>&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-单个路由中间件"><a href="#4-3-单个路由中间件" class="headerlink" title="4.3 单个路由中间件"></a>4.3 单个路由中间件</h3><p>只应用于特定的路由。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">router.GET(<span class="string">&quot;/ping_auth&quot;</span>, AuthMiddleware(), <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;pong with auth&quot;</span>&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="4-4-中间件中的上下文数据传递"><a href="#4-4-中间件中的上下文数据传递" class="headerlink" title="4.4 中间件中的上下文数据传递"></a>4.4 中间件中的上下文数据传递</h3><p>你可以使用 <code>c.Set()</code> 和 <code>c.Get()</code> 在中间件之间或中间件和处理函数之间传递数据。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">UserInfoMiddleware</span><span class="params">()</span></span> gin.HandlerFunc &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		<span class="comment">// 假设从 JWT 或其他地方解析出用户信息</span></span><br><span class="line">		userID := <span class="string">&quot;user123&quot;</span></span><br><span class="line">		c.Set(<span class="string">&quot;userID&quot;</span>, userID) <span class="comment">// 设置上下文变量</span></span><br><span class="line">		c.Next()</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">router.GET(<span class="string">&quot;/profile&quot;</span>, UserInfoMiddleware(), <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	userID, exists := c.Get(<span class="string">&quot;userID&quot;</span>) <span class="comment">// 获取上下文变量</span></span><br><span class="line">	<span class="keyword">if</span> !exists &#123;</span><br><span class="line">		c.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;User ID not found in context&quot;</span>&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;message&quot;</span>: fmt.Sprintf(<span class="string">&quot;Welcome, User %s&quot;</span>, userID)&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="5-错误处理-Error-Handling"><a href="#5-错误处理-Error-Handling" class="headerlink" title="5. 错误处理 (Error Handling)"></a>5. 错误处理 (Error Handling)</h2><p>Gin 允许你收集和处理请求过程中发生的错误。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">router.GET(<span class="string">&quot;/error_example&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	<span class="comment">// 记录一个错误</span></span><br><span class="line">	c.Error(fmt.Errorf(<span class="string">&quot;this is a custom error&quot;</span>))</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 也可以在错误后中止请求链</span></span><br><span class="line">	<span class="comment">// c.AbortWithError(http.StatusInternalServerError, fmt.Errorf(&quot;something bad happened&quot;))</span></span><br><span class="line"></span><br><span class="line">	c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Check server logs for errors&quot;</span>&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>Gin 的 <code>Logger</code> 中间件会自动打印 <code>c.Errors</code> 中的错误。你也可以创建自定义的错误处理中间件来集中管理错误响应。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>Gin 是一个快速、灵活且易于使用的 Go Web 框架。掌握以上基础知识，你就可以开始构建功能强大的 Web 应用了。</p>
<p>Gin 还有许多高级特性，例如：</p>
<ul>
<li><strong>文件上传</strong></li>
<li><strong>静态文件服务</strong></li>
<li><strong>HTML 模板渲染</strong></li>
<li><strong>Cookie 和 Session 管理</strong></li>
<li><strong>Multipart 表单处理</strong></li>
<li><strong>自定义验证器</strong></li>
</ul>
<p>查阅 <a target="_blank" rel="noopener" href="https://gin-gonic.com/zh-cn/docs/">Gin 官方文档</a> 以获取更多详细信息和高级用法。</p>
<hr>
<h1 id="GORM-数据库操作速查手册"><a href="#GORM-数据库操作速查手册" class="headerlink" title="GORM 数据库操作速查手册"></a>GORM 数据库操作速查手册</h1><p>GORM 是 Go 语言中一个功能强大的 ORM (Object-Relational Mapping) 库。它提供了简洁的 API 来操作数据库，支持多种数据库（如 MySQL, PostgreSQL, SQLite, SQL Server 等）。</p>
<p>本文档将介绍 GORM 的常用操作：插入 (Create)、查询 (Retrieve)、更新 (Update) 和删除 (Delete)，并演示如何将查询结果赋值给 Go 语言的变量。</p>
<h2 id="准备工作-1"><a href="#准备工作-1" class="headerlink" title="准备工作"></a>准备工作</h2><p>在开始之前，确保你已经安装了 GORM 和相应的数据库驱动。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">go get -u gorm.io/gorm</span><br><span class="line">go get -u gorm.io/driver/sqlite <span class="comment"># 示例中使用 SQLite，你可以替换为其他数据库驱动</span></span><br></pre></td></tr></table></figure>

<h3 id="数据库连接与模型定义"><a href="#数据库连接与模型定义" class="headerlink" title="数据库连接与模型定义"></a>数据库连接与模型定义</h3><p>首先，我们需要建立数据库连接和定义一个数据模型。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;gorm.io/gorm&quot;</span></span><br><span class="line">	<span class="string">&quot;gorm.io/driver/sqlite&quot;</span> <span class="comment">// 示例使用 SQLite</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// User 是一个 GORM 模型，映射到数据库中的 `users` 表</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	<span class="comment">// gorm.Model 包含了常用的字段: ID, CreatedAt, UpdatedAt, DeletedAt</span></span><br><span class="line">	<span class="comment">// ID 是自增主键</span></span><br><span class="line">	gorm.Model</span><br><span class="line">	Name    <span class="type">string</span> <span class="string">`gorm:&quot;size:255;not null&quot;`</span> <span class="comment">// 姓名，非空</span></span><br><span class="line">	Email   <span class="type">string</span> <span class="string">`gorm:&quot;unique;not null&quot;`</span>   <span class="comment">// 邮箱，唯一且非空</span></span><br><span class="line">	Age     <span class="type">uint</span>   <span class="comment">// 年龄</span></span><br><span class="line">	Balance <span class="type">float64</span> <span class="string">`gorm:&quot;default:0.0&quot;`</span> <span class="comment">// 余额，默认值为 0.0</span></span><br><span class="line">	<span class="comment">// 还可以添加其他字段，例如：</span></span><br><span class="line">	<span class="comment">// IsActive bool</span></span><br><span class="line">	<span class="comment">// Address string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Global DB instance (全局 DB 实例，实际项目中通常通过依赖注入管理)</span></span><br><span class="line"><span class="keyword">var</span> DB *gorm.DB</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> err <span class="type">error</span></span><br><span class="line">	<span class="comment">// 连接到 SQLite 数据库 (test.db)</span></span><br><span class="line">	DB, err = gorm.Open(sqlite.Open(<span class="string">&quot;test.db&quot;</span>), &amp;gorm.Config&#123;&#125;)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(<span class="string">&quot;failed to connect database: &quot;</span> + err.Error())</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 自动迁移模式，根据 User 结构体创建或更新数据库表</span></span><br><span class="line">	err = DB.AutoMigrate(&amp;User&#123;&#125;)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(<span class="string">&quot;failed to auto migrate: &quot;</span> + err.Error())</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">&quot;Database connected and migrated successfully!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 这里可以调用各种操作函数进行演示</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;\n--- 开始 GORM 操作演示 ---&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 插入操作</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;\n--- 插入 (Create) ---&quot;</span>)</span><br><span class="line">	user1 := createUser(<span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;alice@example.com&quot;</span>, <span class="number">30</span>)</span><br><span class="line">	createUser(<span class="string">&quot;Bob&quot;</span>, <span class="string">&quot;bob@example.com&quot;</span>, <span class="number">25</span>)</span><br><span class="line">	createUsersBatch([]User&#123;</span><br><span class="line">		&#123;Name: <span class="string">&quot;Charlie&quot;</span>, Email: <span class="string">&quot;charlie@example.com&quot;</span>, Age: <span class="number">35</span>&#125;,</span><br><span class="line">		&#123;Name: <span class="string">&quot;David&quot;</span>, Email: <span class="string">&quot;david@example.com&quot;</span>, Age: <span class="number">40</span>&#125;,</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 查询操作</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;\n--- 查询 (Retrieve) ---&quot;</span>)</span><br><span class="line">	findUserByID(user1.ID)</span><br><span class="line">	findUserByEmail(<span class="string">&quot;bob@example.com&quot;</span>)</span><br><span class="line">	findAllUsers()</span><br><span class="line">	findUsersByName(<span class="string">&quot;Alice&quot;</span>)</span><br><span class="line">	findUserWithConditions()</span><br><span class="line">	findPaginatedUsers(<span class="number">1</span>, <span class="number">2</span>) <span class="comment">// 第一页，每页2条</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 更新操作</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;\n--- 更新 (Update) ---&quot;</span>)</span><br><span class="line">	updateUserByID(user1.ID, <span class="string">&quot;Alice Smith&quot;</span>, <span class="string">&quot;alice.smith@example.com&quot;</span>)</span><br><span class="line">	updateUserColumnsByEmail(<span class="string">&quot;bob@example.com&quot;</span>, <span class="number">26</span>, <span class="number">100.5</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 删除操作</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;\n--- 删除 (Delete) ---&quot;</span>)</span><br><span class="line">	deleteUserByID(user1.ID) <span class="comment">// 软删除</span></span><br><span class="line">	<span class="comment">// hardDeleteUserByID(user1.ID) // 硬删除 (如果需要)</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 再次查询所有用户，看软删除效果</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;\n--- 再次查询所有用户 (After Delete) ---&quot;</span>)</span><br><span class="line">	findAllUsers()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="1-插入数据-Create"><a href="#1-插入数据-Create" class="headerlink" title="1. 插入数据 (Create)"></a>1. 插入数据 (Create)</h2><p>使用 <code>DB.Create()</code> 方法将新的记录插入到数据库中。</p>
<h3 id="1-1-插入单条记录"><a href="#1-1-插入单条记录" class="headerlink" title="1.1 插入单条记录"></a>1.1 插入单条记录</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// createUser 插入单条用户记录</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">createUser</span><span class="params">(name, email <span class="type">string</span>, age <span class="type">uint</span>)</span></span> *User &#123;</span><br><span class="line">	newUser := User&#123;</span><br><span class="line">		Name:  name,</span><br><span class="line">		Email: email,</span><br><span class="line">		Age:   age,</span><br><span class="line">	&#125;</span><br><span class="line">	result := DB.Create(&amp;newUser) <span class="comment">// 传入结构体指针</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> result.Error != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;Error creating user %s: %v\n&quot;</span>, name, result.Error)</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Successfully created user: %s (ID: %d), Rows Affected: %d\n&quot;</span>, newUser.Name, newUser.ID, result.RowsAffected)</span><br><span class="line">	<span class="keyword">return</span> &amp;newUser <span class="comment">// GORM 会将新记录的 ID 填充回结构体</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>使用示例：</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user1 := createUser(<span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;alice@example.com&quot;</span>, <span class="number">30</span>)</span><br><span class="line"><span class="comment">// 此时 user1.ID 会被 GORM 填充为新插入记录的自增 ID</span></span><br></pre></td></tr></table></figure>

<h3 id="1-2-批量插入记录"><a href="#1-2-批量插入记录" class="headerlink" title="1.2 批量插入记录"></a>1.2 批量插入记录</h3><p>传递一个结构体切片给 <code>DB.Create()</code> 即可实现批量插入。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// createUsersBatch 批量插入用户记录</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">createUsersBatch</span><span class="params">(users []User)</span></span> &#123;</span><br><span class="line">	result := DB.Create(&amp;users) <span class="comment">// 传入结构体切片指针</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> result.Error != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;Error creating users batch: %v\n&quot;</span>, result.Error)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Successfully created %d users in batch.\n&quot;</span>, result.RowsAffected)</span><br><span class="line">	<span class="keyword">for</span> _, user := <span class="keyword">range</span> users &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;  - %s (ID: %d)\n&quot;</span>, user.Name, user.ID)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>使用示例：</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">createUsersBatch([]User&#123;</span><br><span class="line">	&#123;Name: <span class="string">&quot;Charlie&quot;</span>, Email: <span class="string">&quot;charlie@example.com&quot;</span>, Age: <span class="number">35</span>&#125;,</span><br><span class="line">	&#123;Name: <span class="string">&quot;David&quot;</span>, Email: <span class="string">&quot;david@example.com&quot;</span>, Age: <span class="number">40</span>&#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="2-查询数据-Retrieve"><a href="#2-查询数据-Retrieve" class="headerlink" title="2. 查询数据 (Retrieve)"></a>2. 查询数据 (Retrieve)</h2><p>GORM 提供了多种查询方法，可以灵活地检索数据。查询结果会赋值给 Go 语言的变量。</p>
<h3 id="2-1-根据主键查询-First-Find"><a href="#2-1-根据主键查询-First-Find" class="headerlink" title="2.1 根据主键查询 (First &#x2F; Find)"></a>2.1 根据主键查询 (First &#x2F; Find)</h3><ul>
<li><code>First(&amp;dest, primaryKey)</code>: 查找主键匹配的第一个记录。如果没有找到记录，<code>result.Error</code> 会是 <code>gorm.ErrRecordNotFound</code>。</li>
<li><code>Find(&amp;dest, primaryKey)</code>: 查找主键匹配的所有记录。如果找到多个，只会赋值给切片。</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// findUserByID 根据 ID 查询用户</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">findUserByID</span><span class="params">(id <span class="type">uint</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> user User</span><br><span class="line">	<span class="comment">// First 会根据主键查找，如果找不到会返回 gorm.ErrRecordNotFound</span></span><br><span class="line">	result := DB.First(&amp;user, id) <span class="comment">// 传入结构体指针和主键值</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> result.Error != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> result.Error == gorm.ErrRecordNotFound &#123;</span><br><span class="line">			fmt.Printf(<span class="string">&quot;User with ID %d not found.\n&quot;</span>, id)</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			fmt.Printf(<span class="string">&quot;Error finding user by ID %d: %v\n&quot;</span>, id, result.Error)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Found User by ID %d: Name=%s, Email=%s, Age=%d\n&quot;</span>, user.ID, user.Name, user.Email, user.Age)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>使用示例：</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">findUserByID(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<h3 id="2-2-根据条件查询-Where"><a href="#2-2-根据条件查询-Where" class="headerlink" title="2.2 根据条件查询 (Where)"></a>2.2 根据条件查询 (Where)</h3><p>使用 <code>Where()</code> 方法添加查询条件。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// findUserByEmail 根据邮箱查询用户</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">findUserByEmail</span><span class="params">(email <span class="type">string</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> user User</span><br><span class="line">	<span class="comment">// Where 方法用于构建查询条件</span></span><br><span class="line">	result := DB.Where(<span class="string">&quot;email = ?&quot;</span>, email).First(&amp;user) <span class="comment">// 使用占位符防止 SQL 注入</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> result.Error != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> result.Error == gorm.ErrRecordNotFound &#123;</span><br><span class="line">			fmt.Printf(<span class="string">&quot;User with email %s not found.\n&quot;</span>, email)</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			fmt.Printf(<span class="string">&quot;Error finding user by email %s: %v\n&quot;</span>, email, result.Error)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Found User by Email %s: Name=%s, Age=%d\n&quot;</span>, user.Email, user.Name, user.Age)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// findUsersByName 根据姓名模糊查询所有匹配的用户</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">findUsersByName</span><span class="params">(name <span class="type">string</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> users []User <span class="comment">// 声明一个结构体切片来存储多条记录</span></span><br><span class="line">	<span class="comment">// 使用 LIKE 进行模糊匹配</span></span><br><span class="line">	result := DB.Where(<span class="string">&quot;name LIKE ?&quot;</span>, <span class="string">&quot;%&quot;</span>+name+<span class="string">&quot;%&quot;</span>).Find(&amp;users)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> result.Error != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;Error finding users by name %s: %v\n&quot;</span>, name, result.Error)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(users) == <span class="number">0</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;No users found with name containing &#x27;%s&#x27;.\n&quot;</span>, name)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Found %d users with name containing &#x27;%s&#x27;:\n&quot;</span>, <span class="built_in">len</span>(users), name)</span><br><span class="line">	<span class="keyword">for</span> _, user := <span class="keyword">range</span> users &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;  - ID: %d, Name: %s, Email: %s\n&quot;</span>, user.ID, user.Name, user.Email)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// findUserWithConditions 复杂条件查询</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">findUserWithConditions</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> user User</span><br><span class="line">	<span class="comment">// 链式调用多个 Where 条件</span></span><br><span class="line">	result := DB.Where(<span class="string">&quot;age &gt; ?&quot;</span>, <span class="number">20</span>).Where(<span class="string">&quot;name LIKE ?&quot;</span>, <span class="string">&quot;%lice%&quot;</span>).First(&amp;user)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> result.Error != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> result.Error == gorm.ErrRecordNotFound &#123;</span><br><span class="line">			fmt.Println(<span class="string">&quot;No user found with age &gt; 20 and name like &#x27;%lice%&#x27;.&quot;</span>)</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			fmt.Printf(<span class="string">&quot;Error finding user with conditions: %v\n&quot;</span>, result.Error)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Found User with conditions: ID=%d, Name=%s, Age=%d\n&quot;</span>, user.ID, user.Name, user.Age)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>使用示例：</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">findUserByEmail(<span class="string">&quot;bob@example.com&quot;</span>)</span><br><span class="line">findUsersByName(<span class="string">&quot;li&quot;</span>) <span class="comment">// 查找名字中包含 &quot;li&quot; 的用户</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-查询所有记录-Find"><a href="#2-3-查询所有记录-Find" class="headerlink" title="2.3 查询所有记录 (Find)"></a>2.3 查询所有记录 (Find)</h3><p>不带 <code>Where()</code> 条件的 <code>Find()</code> 方法会查询表中的所有记录。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// findAllUsers 查询所有用户</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">findAllUsers</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> users []User <span class="comment">// 声明一个结构体切片</span></span><br><span class="line">	result := DB.Find(&amp;users)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> result.Error != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;Error finding all users: %v\n&quot;</span>, result.Error)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(users) == <span class="number">0</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;No users found in the database.&quot;</span>)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Found %d users:\n&quot;</span>, <span class="built_in">len</span>(users))</span><br><span class="line">	<span class="keyword">for</span> _, user := <span class="keyword">range</span> users &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;  - ID: %d, Name: %s, Email: %s, Age: %d, CreatedAt: %s\n&quot;</span>,</span><br><span class="line">			user.ID, user.Name, user.Email, user.Age, user.CreatedAt.Format(<span class="string">&quot;2006-01-02 15:04:05&quot;</span>))</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>使用示例：</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">findAllUsers()</span><br></pre></td></tr></table></figure>

<h3 id="2-4-排序、限制和偏移-Order-Limit-Offset"><a href="#2-4-排序、限制和偏移-Order-Limit-Offset" class="headerlink" title="2.4 排序、限制和偏移 (Order, Limit, Offset)"></a>2.4 排序、限制和偏移 (Order, Limit, Offset)</h3><p>用于分页和排序查询结果。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// findPaginatedUsers 分页查询用户</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">findPaginatedUsers</span><span class="params">(page, pageSize <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> users []User</span><br><span class="line">	offset := (page - <span class="number">1</span>) * pageSize <span class="comment">// 计算偏移量</span></span><br><span class="line"></span><br><span class="line">	result := DB.Offset(offset).Limit(pageSize).Order(<span class="string">&quot;created_at desc&quot;</span>).Find(&amp;users)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> result.Error != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;Error finding paginated users (Page %d, Size %d): %v\n&quot;</span>, page, pageSize, result.Error)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(users) == <span class="number">0</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;No users found on page %d (size %d).\n&quot;</span>, page, pageSize)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Found %d users on Page %d (Size %d):\n&quot;</span>, <span class="built_in">len</span>(users), page, pageSize)</span><br><span class="line">	<span class="keyword">for</span> _, user := <span class="keyword">range</span> users &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;  - ID: %d, Name: %s, CreatedAt: %s\n&quot;</span>, user.ID, user.Name, user.CreatedAt.Format(<span class="string">&quot;2006-01-02 15:04:05&quot;</span>))</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>使用示例：</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">findPaginatedUsers(<span class="number">1</span>, <span class="number">2</span>) <span class="comment">// 查询第一页，每页2条</span></span><br></pre></td></tr></table></figure>

<h2 id="3-更新数据-Update"><a href="#3-更新数据-Update" class="headerlink" title="3. 更新数据 (Update)"></a>3. 更新数据 (Update)</h2><p>GORM 提供了多种更新数据的方法。</p>
<h3 id="3-1-更新单个字段-Update"><a href="#3-1-更新单个字段-Update" class="headerlink" title="3.1 更新单个字段 (Update)"></a>3.1 更新单个字段 (Update)</h3><p><code>Update()</code> 方法用于更新模型的单个字段。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// updateUserByID 根据 ID 更新用户姓名和邮箱</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">updateUserByID</span><span class="params">(id <span class="type">uint</span>, newName, newEmail <span class="type">string</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> user User</span><br><span class="line">	<span class="comment">// 首先找到记录</span></span><br><span class="line">	result := DB.First(&amp;user, id)</span><br><span class="line">	<span class="keyword">if</span> result.Error != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;Error finding user ID %d for update: %v\n&quot;</span>, id, result.Error)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 更新单个字段</span></span><br><span class="line">	<span class="comment">// DB.Model(&amp;user).Update(&quot;name&quot;, newName) // 更新单个字段</span></span><br><span class="line">	<span class="comment">// DB.Model(&amp;user).Update(&quot;email&quot;, newEmail)</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 更新多个字段 (使用 map 或结构体)</span></span><br><span class="line">	result = DB.Model(&amp;user).Updates(User&#123;Name: newName, Email: newEmail&#125;) <span class="comment">// 使用结构体更新</span></span><br><span class="line">	<span class="comment">// 或者</span></span><br><span class="line">	<span class="comment">// result = DB.Model(&amp;user).Updates(map[string]interface&#123;&#125;&#123;&quot;name&quot;: newName, &quot;email&quot;: newEmail&#125;) // 使用 map 更新</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> result.Error != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;Error updating user ID %d: %v\n&quot;</span>, id, result.Error)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Successfully updated user ID %d to Name: %s, Email: %s, Rows Affected: %d\n&quot;</span>, id, newName, newEmail, result.RowsAffected)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>使用示例：</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">updateUserByID(<span class="number">1</span>, <span class="string">&quot;Alice Smith&quot;</span>, <span class="string">&quot;alice.smith@example.com&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="3-2-更新多个字段-Updates"><a href="#3-2-更新多个字段-Updates" class="headerlink" title="3.2 更新多个字段 (Updates)"></a>3.2 更新多个字段 (Updates)</h3><p><code>Updates()</code> 方法用于更新模型的多个字段。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// updateUserColumnsByEmail 根据邮箱更新用户年龄和余额</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">updateUserColumnsByEmail</span><span class="params">(email <span class="type">string</span>, newAge <span class="type">uint</span>, newBalance <span class="type">float64</span>)</span></span> &#123;</span><br><span class="line">	<span class="comment">// 使用 Where 找到记录，然后用 Updates 更新</span></span><br><span class="line">	result := DB.Model(&amp;User&#123;&#125;).Where(<span class="string">&quot;email = ?&quot;</span>, email).Updates(<span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;</span><br><span class="line">		<span class="string">&quot;age&quot;</span>:     newAge,</span><br><span class="line">		<span class="string">&quot;balance&quot;</span>: newBalance,</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> result.Error != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;Error updating user by email %s: %v\n&quot;</span>, email, result.Error)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> result.RowsAffected == <span class="number">0</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;No user found with email %s to update.\n&quot;</span>, email)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;Successfully updated user with email %s, Rows Affected: %d\n&quot;</span>, email, result.RowsAffected)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>使用示例：</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">updateUserColumnsByEmail(<span class="string">&quot;bob@example.com&quot;</span>, <span class="number">26</span>, <span class="number">100.5</span>)</span><br></pre></td></tr></table></figure>

<h3 id="3-3-计数器更新-Inc-Dec"><a href="#3-3-计数器更新-Inc-Dec" class="headerlink" title="3.3 计数器更新 (Inc &#x2F; Dec)"></a>3.3 计数器更新 (Inc &#x2F; Dec)</h3><p>用于原子性地增加或减少字段值。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// incrementUserAge 增加用户年龄</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">incrementUserAge</span><span class="params">(id <span class="type">uint</span>, delta <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> user User</span><br><span class="line">	result := DB.First(&amp;user, id)</span><br><span class="line">	<span class="keyword">if</span> result.Error != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;Error finding user ID %d for age increment: %v\n&quot;</span>, id, result.Error)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	result = DB.Model(&amp;user).Update(<span class="string">&quot;age&quot;</span>, gorm.Expr(<span class="string">&quot;age + ?&quot;</span>, delta))</span><br><span class="line">	<span class="comment">// 或者使用 Inc/Dec 方法 (GORM v1.20.0+):</span></span><br><span class="line">	<span class="comment">// result = DB.Model(&amp;user).Inc(&quot;age&quot;, delta)</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> result.Error != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;Error incrementing age for user ID %d: %v\n&quot;</span>, id, result.Error)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Successfully incremented age for user ID %d, Rows Affected: %d\n&quot;</span>, id, result.RowsAffected)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-删除数据-Delete"><a href="#4-删除数据-Delete" class="headerlink" title="4. 删除数据 (Delete)"></a>4. 删除数据 (Delete)</h2><p>GORM 支持软删除和硬删除。</p>
<h3 id="4-1-软删除-Soft-Delete"><a href="#4-1-软删除-Soft-Delete" class="headerlink" title="4.1 软删除 (Soft Delete)"></a>4.1 软删除 (Soft Delete)</h3><p>如果你的模型嵌入了 <code>gorm.Model</code>（或包含 <code>DeletedAt gorm.DeletedAt</code> 字段），GORM 默认会进行软删除。它不会真正删除记录，而是将 <code>DeletedAt</code> 字段设置为当前时间。</p>
<p>软删除的记录在常规查询中不会被检索到，除非使用 <code>Unscoped()</code> 方法。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// deleteUserByID 软删除用户</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">deleteUserByID</span><span class="params">(id <span class="type">uint</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> user User</span><br><span class="line">	<span class="comment">// 使用 Delete 方法进行软删除</span></span><br><span class="line">	result := DB.Delete(&amp;user, id) <span class="comment">// 传入结构体指针和主键值</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> result.Error != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;Error soft deleting user ID %d: %v\n&quot;</span>, id, result.Error)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Successfully soft deleted user ID %d, Rows Affected: %d\n&quot;</span>, id, result.RowsAffected)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// findDeletedUserByID 查找被软删除的用户 (需要 Unscoped)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">findDeletedUserByID</span><span class="params">(id <span class="type">uint</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> user User</span><br><span class="line">	<span class="comment">// 使用 Unscoped() 方法可以查询被软删除的记录</span></span><br><span class="line">	result := DB.Unscoped().First(&amp;user, id)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> result.Error != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> result.Error == gorm.ErrRecordNotFound &#123;</span><br><span class="line">			fmt.Printf(<span class="string">&quot;User with ID %d (including deleted) not found.\n&quot;</span>, id)</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			fmt.Printf(<span class="string">&quot;Error finding deleted user by ID %d: %v\n&quot;</span>, id, result.Error)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Found Deleted User by ID %d: Name=%s, DeletedAt=%s\n&quot;</span>, user.ID, user.Name, user.DeletedAt.Format(<span class="string">&quot;2006-01-02 15:04:05&quot;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>使用示例：</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">deleteUserByID(<span class="number">1</span>) <span class="comment">// 软删除 ID 为 1 的用户</span></span><br><span class="line">findUserByID(<span class="number">1</span>)   <span class="comment">// 此时应该找不到 ID 为 1 的用户</span></span><br><span class="line">findDeletedUserByID(<span class="number">1</span>) <span class="comment">// 可以找到被软删除的用户</span></span><br></pre></td></tr></table></figure>

<h3 id="4-2-硬删除-Permanent-Delete"><a href="#4-2-硬删除-Permanent-Delete" class="headerlink" title="4.2 硬删除 (Permanent Delete)"></a>4.2 硬删除 (Permanent Delete)</h3><p>如果你想彻底从数据库中删除记录，可以使用 <code>Unscoped().Delete()</code>。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hardDeleteUserByID 硬删除用户</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hardDeleteUserByID</span><span class="params">(id <span class="type">uint</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> user User</span><br><span class="line">	<span class="comment">// 使用 Unscoped().Delete() 进行硬删除</span></span><br><span class="line">	result := DB.Unscoped().Delete(&amp;user, id)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> result.Error != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;Error hard deleting user ID %d: %v\n&quot;</span>, id, result.Error)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Successfully hard deleted user ID %d, Rows Affected: %d\n&quot;</span>, id, result.RowsAffected)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>使用示例：</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hardDeleteUserByID(1) // 硬删除 ID 为 1 的用户</span></span><br></pre></td></tr></table></figure>

<h2 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h2><p>本文档涵盖了 GORM 中最常用的数据库操作方法。GORM 还有许多高级功能，例如：</p>
<ul>
<li><strong>关联 (Associations)</strong>：一对一、一对多、多对多关系。</li>
<li><strong>事务 (Transactions)</strong>：确保一系列数据库操作的原子性。</li>
<li><strong>预加载 (Preloading)</strong>：一次性加载关联数据以避免 N+1 查询问题。</li>
<li><strong>Hook (钩子)</strong>：在创建、更新、删除等操作前后执行自定义逻辑。</li>
<li><strong>原生 SQL (Raw SQL)</strong>：当 ORM 无法满足需求时，直接执行 SQL 语句。</li>
</ul>
<p>查阅 <a target="_blank" rel="noopener" href="https://gorm.io/zh_CN/docs/index.html">GORM 官方文档</a> 以获取更多详细信息和高级用法。 </p>
<hr>
<h1 id="Viper-极简配置读取指南"><a href="#Viper-极简配置读取指南" class="headerlink" title="Viper 极简配置读取指南"></a>Viper 极简配置读取指南</h1><p>Viper 是 Go 语言中一个非常方便的配置库。如果你想从文件中读取配置，并将其映射到 Go 结构体以便于类型安全的调用，Viper 能轻松搞定。</p>
<h2 id="1-安装-Viper"><a href="#1-安装-Viper" class="headerlink" title="1. 安装 Viper"></a>1. 安装 Viper</h2><p>首先，确保你的项目安装了 Viper</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get github.com/spf13/viper</span><br></pre></td></tr></table></figure>

<h2 id="2-准备配置文件"><a href="#2-准备配置文件" class="headerlink" title="2. 准备配置文件"></a>2. 准备配置文件</h2><p>Viper 支持多种配置文件格式，比如 YAML、JSON、TOML 等。我们以 <strong>YAML</strong> 格式为例，创建一个名为 <code>config.yaml</code> 的文件在你的项目根目录下：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config.yaml</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">MyWebApp</span></span><br><span class="line"><span class="attr">database:</span></span><br><span class="line">  <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">  <span class="attr">user:</span> <span class="string">admin</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">supersecret</span></span><br><span class="line">  <span class="comment"># 这个 timeout 字段在结构体中会用到，如果配置文件没有，会用结构体的默认值</span></span><br><span class="line">  <span class="attr">timeout_seconds:</span> <span class="number">10</span></span><br></pre></td></tr></table></figure>

<h2 id="3-编写-Go-代码读取配置并绑定到结构体"><a href="#3-编写-Go-代码读取配置并绑定到结构体" class="headerlink" title="3. 编写 Go 代码读取配置并绑定到结构体"></a>3. 编写 Go 代码读取配置并绑定到结构体</h2><p>下面是一个简单的 Go 程序，演示了如何使用 Viper 读取 <code>config.yaml</code> 文件中的配置，并将其绑定到一个 Go 结构体。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span> <span class="comment">// 用于输出错误信息</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/spf13/viper&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Config 结构体映射整个配置文件。</span></span><br><span class="line"><span class="comment">// `mapstructure` 标签告诉 Viper 如何将配置键映射到结构体字段。</span></span><br><span class="line"><span class="keyword">type</span> Config <span class="keyword">struct</span> &#123;</span><br><span class="line">	Server   ServerConfig   <span class="string">`mapstructure:&quot;server&quot;`</span></span><br><span class="line">	Database DatabaseConfig <span class="string">`mapstructure:&quot;database&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ServerConfig 映射 &#x27;server&#x27; 配置部分。</span></span><br><span class="line"><span class="keyword">type</span> ServerConfig <span class="keyword">struct</span> &#123;</span><br><span class="line">	Port <span class="type">int</span>    <span class="string">`mapstructure:&quot;port&quot;`</span></span><br><span class="line">	Name <span class="type">string</span> <span class="string">`mapstructure:&quot;name&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// DatabaseConfig 映射 &#x27;database&#x27; 配置部分。</span></span><br><span class="line"><span class="keyword">type</span> DatabaseConfig <span class="keyword">struct</span> &#123;</span><br><span class="line">	Host           <span class="type">string</span> <span class="string">`mapstructure:&quot;host&quot;`</span></span><br><span class="line">	User           <span class="type">string</span> <span class="string">`mapstructure:&quot;user&quot;`</span></span><br><span class="line">	Password       <span class="type">string</span> <span class="string">`mapstructure:&quot;password&quot;`</span></span><br><span class="line">	TimeoutSeconds <span class="type">int</span>    <span class="string">`mapstructure:&quot;timeout_seconds&quot;`</span> <span class="comment">// 即使配置文件没有，结构体也有默认值</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 1. 设置配置文件的名称 (不带扩展名)</span></span><br><span class="line">	viper.SetConfigName(<span class="string">&quot;config&quot;</span>) <span class="comment">// 对应 config.yaml, config.json 等</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 2. 设置配置文件的类型 (可选，但推荐明确指定)</span></span><br><span class="line">	viper.SetConfigType(<span class="string">&quot;yaml&quot;</span>) <span class="comment">// 明确告诉 Viper 配置文件是 YAML 格式</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 3. 添加查找配置文件的路径</span></span><br><span class="line">	<span class="comment">// Viper 会按照添加的顺序查找，找到第一个就停止</span></span><br><span class="line">	viper.AddConfigPath(<span class="string">&quot;.&quot;</span>)        <span class="comment">// 在当前目录查找</span></span><br><span class="line">	viper.AddConfigPath(<span class="string">&quot;./config&quot;</span>) <span class="comment">// 在当前目录下的 &#x27;config&#x27; 文件夹中查找 (如果你把 config.yaml 放在这里)</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 4. 读取配置文件</span></span><br><span class="line">	<span class="keyword">if</span> err := viper.ReadInConfig(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="comment">// 如果配置文件没找到，这通常不是一个致命错误，</span></span><br><span class="line">		<span class="comment">// 因为你可能想在生产环境通过环境变量或代码默认值提供配置。</span></span><br><span class="line">		<span class="keyword">if</span> _, ok := err.(viper.ConfigFileNotFoundError); ok &#123;</span><br><span class="line">			fmt.Println(<span class="string">&quot;No config file found, continuing with defaults or environment variables.&quot;</span>)</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">// 其他类型的错误（如文件损坏），是致命错误</span></span><br><span class="line">			log.Fatalf(<span class="string">&quot;Fatal error reading config file: %s \n&quot;</span>, err)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;Config file &#x27;%s&#x27; loaded successfully!\n&quot;</span>, viper.ConfigFileUsed())</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 5. 绑定配置到结构体</span></span><br><span class="line">	<span class="comment">// 定义一个 Config 结构体变量来接收配置</span></span><br><span class="line">	<span class="keyword">var</span> appConfig Config</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置默认值到结构体字段（可选，但推荐）</span></span><br><span class="line">	<span class="comment">// 如果配置文件中没有 `timeout_seconds`，这里设置的 10 会生效。</span></span><br><span class="line">	appConfig.Database.TimeoutSeconds = <span class="number">10</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err := viper.Unmarshal(&amp;appConfig); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalf(<span class="string">&quot;Unable to unmarshal config into struct: %s \n&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 6. 通过结构体访问配置值 (推荐，类型安全，方便调用)</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;\n--- 通过结构体访问配置 ---&quot;</span>)</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Server Name: %s\n&quot;</span>, appConfig.Server.Name)</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Server Port: %d\n&quot;</span>, appConfig.Server.Port)</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Database Host: %s\n&quot;</span>, appConfig.Database.Host)</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Database User: %s\n&quot;</span>, appConfig.Database.User)</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Database Password: %s\n&quot;</span>, appConfig.Database.Password)</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Database Timeout (seconds): %d\n&quot;</span>, appConfig.Database.TimeoutSeconds)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 还可以直接通过 Viper 实例获取值（适用于少量或不方便映射到结构体的配置）</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;\n--- 直接通过 Viper.Get() 访问配置 ---&quot;</span>)</span><br><span class="line">	<span class="comment">// 注意：当使用 Unmarshal 后，结构体是主要的访问方式。</span></span><br><span class="line">	<span class="comment">// 但 Viper 实例仍然可以获取任何已加载的配置。</span></span><br><span class="line">	fmt.Printf(<span class="string">&quot;Server Port (from Viper.GetInt): %d\n&quot;</span>, viper.GetInt(<span class="string">&quot;server.port&quot;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-运行你的程序"><a href="#4-运行你的程序" class="headerlink" title="4. 运行你的程序"></a>4. 运行你的程序</h2><ol>
<li><p>将上面的 Go 代码保存为 <code>main.go</code>。</p>
</li>
<li><p>确保 <code>config.yaml</code> 文件与 <code>main.go</code> 在同一目录下。</p>
</li>
<li><p>打开终端，进入该目录，然后运行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go run main.go</span><br></pre></td></tr></table></figure></li>
</ol>
<p>你将看到程序成功读取 <code>config.yaml</code>，并将其内容绑定到 <code>appConfig</code> 结构体，然后通过结构体字段访问配置值。</p>
<h3 id="结构体绑定小贴士："><a href="#结构体绑定小贴士：" class="headerlink" title="结构体绑定小贴士："></a>结构体绑定小贴士：</h3><ul>
<li><strong><code>mapstructure</code> 标签</strong>: <code>mapstructure:&quot;key_name&quot;</code> 告诉 Viper 如何将配置文件中的 <code>key_name</code> 字段映射到 Go 结构体的对应字段。这是必不可少的。</li>
<li><strong>嵌套结构体</strong>: 对于配置文件中的嵌套配置（如 <code>server</code> 和 <code>database</code>），Go 结构体也应使用嵌套结构体来匹配。</li>
<li><strong>默认值</strong>: 如果结构体字段是基本类型（如 <code>int</code>, <code>string</code>, <code>bool</code>），并且你在代码中给它赋了初始值（例如 <code>TimeoutSeconds int = 10</code>），那么在配置文件中没有这个键时，这个默认值就会被保留。如果配置文件有，则会被覆盖。</li>
</ul>
<hr>
<h1 id="Redis-的使用"><a href="#Redis-的使用" class="headerlink" title="Redis 的使用"></a>Redis 的使用</h1><p>Redis 是一个开源的（BSD 许可）内存数据结构存储，可用作数据库、缓存和消息代理。它支持多种数据结构，如字符串、哈希、列表、集合、有序集合等。在 Gin 框架中集成 Redis 可以极大地提高应用程序的性能和可扩展性。</p>
<p>本教程将介绍如何在 Gin 应用程序中连接 Redis、进行基本操作（如设置和获取键值）、以及如何使用 Redis 进行会话管理和缓存。</p>
<h2 id="1-环境准备"><a href="#1-环境准备" class="headerlink" title="1. 环境准备"></a>1. 环境准备</h2><p>在开始之前，请确保您的开发环境已准备就绪。</p>
<h3 id="1-1-安装-Go-Redis-客户端"><a href="#1-1-安装-Go-Redis-客户端" class="headerlink" title="1.1 安装 Go Redis 客户端"></a>1.1 安装 Go Redis 客户端</h3><p>我们将使用 <code>go-redis/redis/v8</code> 库作为 Redis 客户端。它是 Go 语言中最流行和功能最丰富的 Redis 客户端之一。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get -u github.com/go-redis/redis/v8</span><br></pre></td></tr></table></figure>

<h3 id="1-2-安装和运行-Redis-服务器"><a href="#1-2-安装和运行-Redis-服务器" class="headerlink" title="1.2 安装和运行 Redis 服务器"></a>1.2 安装和运行 Redis 服务器</h3><p>您可以通过多种方式安装和运行 Redis 服务器：</p>
<ul>
<li><p><strong>Docker (推荐)</strong>：最简单快捷的方式。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run --name my-redis -p 6379:6379 -d redis/redis-stack-server:latest</span><br><span class="line">    <span class="comment"># 或者只运行 Redis 核心</span></span><br><span class="line">    <span class="comment"># docker run --name my-redis -p 6379:6379 -d redis:latest</span></span><br></pre></td></tr></table></figure>

<p>这将启动一个名为 <code>my-redis</code> 的 Redis 容器，并将容器的 6379 端口映射到主机的 6379 端口。</p>
</li>
<li><p><strong>手动安装</strong>：</p>
<ul>
<li><strong>macOS (Homebrew)</strong>: <code>brew install redis</code></li>
<li><strong>Linux (apt&#x2F;yum)</strong>: <code>sudo apt update &amp;&amp; sudo apt install redis-server</code> 或 <code>sudo yum install redis</code></li>
<li><strong>Windows</strong>: 可以从官方网站下载或使用 WSL2。</li>
</ul>
</li>
</ul>
<p>安装完成后，确保 Redis 服务器正在运行（默认监听 6379 端口）。您可以使用 <code>redis-cli ping</code> 来测试连接。如果返回 <code>PONG</code> 则表示连接成功。</p>
<h3 id="1-3-Redis-配置修改-Windows"><a href="#1-3-Redis-配置修改-Windows" class="headerlink" title="1.3 Redis 配置修改 (Windows)"></a>1.3 Redis 配置修改 (Windows)</h3><p>在 Windows 系统中，Redis 通常以服务形式运行或通过命令行手动启动。它的行为通过 <strong><code>redis.windows.conf</code></strong> 文件进行配置。</p>
<h4 id="1-3-1-找到-Redis-配置文件"><a href="#1-3-1-找到-Redis-配置文件" class="headerlink" title="1.3.1 找到 Redis 配置文件"></a>1.3.1 找到 Redis 配置文件</h4><p>如果您是手动安装 Redis for Windows，<code>redis.windows.conf</code> 文件通常位于您解压 Redis 安装包的根目录下。</p>
<p>例如：<code>C:\Program Files\Redis\redis.windows.conf</code> 或 <code>C:\redis-x.x.x\redis.windows.conf</code>。</p>
<p>找到文件后，使用记事本、Notepad++ 或 VS Code 等文本编辑器打开它。</p>
<h4 id="1-3-2-主要配置项更改"><a href="#1-3-2-主要配置项更改" class="headerlink" title="1.3.2 主要配置项更改"></a>1.3.2 主要配置项更改</h4><p>以下是一些您可能会经常更改或需要注意的重要配置项及其修改建议。请根据您的需求取消注释（删除行首的 <code>#</code>）并修改对应的值。</p>
<ul>
<li><p><strong><code>bind</code></strong></p>
<ul>
<li><p><strong>作用</strong>：指定 Redis 服务器监听的 IP 地址。</p>
</li>
<li><p>修改：默认情况下，Redis for Windows 可能没有明确的 <code>bind</code> 设置，或者它会监听所有可用接口。如果您需要限制访问，可以将其设置为特定 IP 地址。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># bind 127.0.0.1           # 默认可能没有这一行，或只监听本地</span><br><span class="line">bind 0.0.0.0               # 监听所有可用 IP (仅用于测试，生产环境请谨慎)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>重要提示</strong>：在没有密码或防火墙保护的情况下，将 <code>bind</code> 设置为 <code>0.0.0.0</code> 并暴露在公网是非常危险的。</p>
</li>
</ul>
</li>
<li><p><strong><code>port</code></strong></p>
<ul>
<li><p><strong>作用</strong>：指定 Redis 服务器监听的 TCP 端口。</p>
</li>
<li><p>修改：如果您希望 Redis 监听非标准端口，可以在此修改</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">port 6379 # 保持默认或修改为其他端口，如 6380</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong><code>protected-mode</code></strong></p>
<ul>
<li><p><strong>作用</strong>：保护模式，在没有 <code>bind</code> 设置和 <code>requirepass</code>（密码）设置的情况下，只允许本地回环地址（127.0.0.1）访问。</p>
</li>
<li><p>修改：强烈建议保持为 <code>yes</code>。如果您需要从外部连接且不设置密码（不推荐），则必须将其设置为 <code>no</code>，但同时需要设置 Windows 防火墙规则来限制访问。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protected-mode yes</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong><code>requirepass</code></strong></p>
<ul>
<li><p><strong>作用</strong>：设置 Redis 连接密码。</p>
</li>
<li><p>修改：**在生产环境中，强烈建议设置一个强密码。**取消注释并替换 <code>foobared</code> 为您的密码。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">requirepass your_strong_password_here # 设置您的密码</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong><code>databases</code></strong></p>
<ul>
<li><p><strong>作用</strong>：设置可用的数据库数量。Redis 默认有 16 个数据库，索引从 0 到 15。</p>
</li>
<li><p>修改：通常默认值已足够，根据您的应用程序需求调整。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">databases 16</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong><code>maxmemory</code></strong></p>
<ul>
<li><p><strong>作用</strong>：设置 Redis 可用的最大内存量。当达到此限制时，Redis 将根据 <code>maxmemory-policy</code> 配置来决定如何处理新数据。</p>
</li>
<li><p>修改：在生产环境中，强烈建议设置此项，以防止 Redis 使用过多内存导致系统不稳定。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">maxmemory 2gb # 设置最大内存为 2GB</span><br><span class="line"># 当达到 maxmemory 限制时，优先删除带有过期时间的键，并且删除最少使用的键</span><br><span class="line">maxmemory-policy allkeys-lru</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong><code>daemonize</code></strong></p>
<ul>
<li><p><strong>作用</strong>：在 Linux&#x2F;macOS 上，这会使 Redis 作为守护进程（后台进程）运行。在 Windows 上，这个设置通常<strong>不生效</strong>或行为不同，因为 Windows 服务或控制台程序有自己的后台机制。如果您是通过 <code>redis-server.exe</code> 直接运行，它通常会占用控制台窗口。如果您将其作为服务安装，则由服务管理器控制后台运行。</p>
</li>
<li><p>修改</p>
<p>：通常无需在 Windows 下修改此项，保持 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">no</span><br></pre></td></tr></table></figure>

<p> 即可。</p>
<p>代码段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">daemonize no</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong><code>loglevel</code></strong></p>
<ul>
<li><p><strong>作用</strong>：设置日志级别。可选值有 <code>debug</code>, <code>verbose</code>, <code>notice</code>, <code>warning</code>。</p>
</li>
<li><p>修改</p>
<p>：开发&#x2F;调试阶段可以设置为 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">debug</span><br></pre></td></tr></table></figure>

<p> 或 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">verbose</span><br></pre></td></tr></table></figure>

<p>生产环境通常设置为 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">notice</span><br></pre></td></tr></table></figure>

<p> 或 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">warning</span><br></pre></td></tr></table></figure>

<p>，以减少日志量。</p>
<p>代码段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loglevel notice</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<hr>
<h4 id="1-3-3-重启-Redis-Windows"><a href="#1-3-3-重启-Redis-Windows" class="headerlink" title="1.3.3 重启 Redis (Windows)"></a>1.3.3 重启 Redis (Windows)</h4><p>修改配置文件后，您需要重启 Redis 服务器以使更改生效。重启方式取决于您如何在 Windows 上运行 Redis。</p>
<h5 id="1-3-3-1-作为-Windows-服务运行"><a href="#1-3-3-1-作为-Windows-服务运行" class="headerlink" title="1.3.3.1 作为 Windows 服务运行"></a>1.3.3.1 作为 Windows 服务运行</h5><p>如果您的 Redis 实例是作为 Windows 服务安装并运行的（这是推荐的生产环境部署方式），可以通过 Windows 的服务管理器来重启：</p>
<ol>
<li>按下 <code>Win + R</code> 键，输入 <code>services.msc</code>，然后按回车键打开 <strong>服务</strong> 管理器。</li>
<li>在服务列表中找到名为 <strong><code>Redis</code></strong> 或类似名称（例如 <code>Redis6379</code>）的服务。</li>
<li>右键点击该服务，然后选择 <strong>重启</strong>。</li>
</ol>
<h5 id="1-3-3-2-通过命令行手动运行"><a href="#1-3-3-2-通过命令行手动运行" class="headerlink" title="1.3.3.2 通过命令行手动运行"></a>1.3.3.2 通过命令行手动运行</h5><p>如果您是通过命令行直接运行 <code>redis-server.exe</code>，您需要先停止当前的进程，然后重新启动它：</p>
<ol>
<li><p><strong>停止当前 Redis 进程：</strong></p>
<ul>
<li><p>打开一个新的命令提示符 (CMD) 或 PowerShell 窗口。</p>
</li>
<li><p>使用 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli.exe</span><br></pre></td></tr></table></figure>

<p> 连接到您的 Redis 实例并发送 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHUTDOWN</span><br></pre></td></tr></table></figure>

<p> 命令。</p>
<p>DOS</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli.exe -h 127.0.0.1 -p 6379 SHUTDOWN</span><br></pre></td></tr></table></figure>

<ul>
<li><p>如果设置了密码，请添加 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-a</span><br></pre></td></tr></table></figure>

<p> 参数：</p>
<p>DOS</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli.exe -h 127.0.0.1 -p 6379 -a your_password SHUTDOWN</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>如果 Redis 运行在控制台窗口中，发送 <code>SHUTDOWN</code> 命令后，该控制台窗口通常会自动关闭。</p>
</li>
</ul>
</li>
<li><p><strong>使用更新后的配置文件启动 Redis 服务器：</strong></p>
<ul>
<li><p>打开一个新的命令提示符 (CMD) 或 PowerShell 窗口。</p>
</li>
<li><p>导航到 <code>redis-server.exe</code> 所在的目录。</p>
</li>
<li><p>执行以下命令，指定您的配置文件路径：</p>
<p>DOS</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-server.exe redis.windows.conf</span><br><span class="line"># 或如果配置文件在其他路径：</span><br><span class="line"># redis-server.exe C:\path\to\your\redis.windows.conf</span><br></pre></td></tr></table></figure>
</li>
<li><p>这将会在当前控制台窗口中启动 Redis。如果您想让它在后台运行（不占用控制台），可以考虑使用 <code>start</code> 命令（但通常建议安装为服务）。</p>
</li>
</ul>
</li>
</ol>
<p>重启后，您可以使用 <code>redis-cli.exe</code> 连接到 Redis 并执行 <code>PING</code> 命令或 <code>CONFIG GET &lt;config_name&gt;</code> 命令来验证新的配置是否已生效。</p>
<h2 id="2-基本-Redis-操作"><a href="#2-基本-Redis-操作" class="headerlink" title="2. 基本 Redis 操作"></a>2. 基本 Redis 操作</h2><p>在使用 Gin 之前，我们先了解 <code>go-redis</code> 库的基本操作。</p>
<h3 id="2-1-连接-Redis"><a href="#2-1-连接-Redis" class="headerlink" title="2.1 连接 Redis"></a>2.1 连接 Redis</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/go-redis/redis/v8&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ctx = context.Background()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 创建 Redis 客户端实例</span></span><br><span class="line">	rdb := redis.NewClient(&amp;redis.Options&#123;</span><br><span class="line">		Addr:     <span class="string">&quot;localhost:6379&quot;</span>, <span class="comment">// Redis 服务器地址</span></span><br><span class="line">		Password: <span class="string">&quot;&quot;</span>,               <span class="comment">// 如果有密码，请填写</span></span><br><span class="line">		DB:       <span class="number">0</span>,                <span class="comment">// 数据库索引，默认为 0</span></span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// PING 命令检查连接</span></span><br><span class="line">	pong, err := rdb.Ping(ctx).Result()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;Error connecting to Redis:&quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">&quot;Redis connected:&quot;</span>, pong) <span class="comment">// 应该输出 PONG</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-设置和获取字符串"><a href="#2-2-设置和获取字符串" class="headerlink" title="2.2 设置和获取字符串"></a>2.2 设置和获取字符串</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/go-redis/redis/v8&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ctx = context.Background()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	rdb := redis.NewClient(&amp;redis.Options&#123;</span><br><span class="line">		Addr: <span class="string">&quot;localhost:6379&quot;</span>,</span><br><span class="line">		DB:   <span class="number">0</span>,</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置一个键值对</span></span><br><span class="line">	err := rdb.Set(ctx, <span class="string">&quot;mykey&quot;</span>, <span class="string">&quot;Hello Redis from Go!&quot;</span>, <span class="number">0</span>).Err() <span class="comment">// 0 表示永不过期</span></span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;Error setting key:&quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">&quot;Key &#x27;mykey&#x27; set successfully.&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 获取键的值</span></span><br><span class="line">	val, err := rdb.Get(ctx, <span class="string">&quot;mykey&quot;</span>).Result()</span><br><span class="line">	<span class="keyword">if</span> err == redis.Nil &#123; <span class="comment">// 如果键不存在</span></span><br><span class="line">		fmt.Println(<span class="string">&quot;Key &#x27;mykey&#x27; does not exist.&quot;</span>)</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;Error getting key:&quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;Value of &#x27;mykey&#x27;:&quot;</span>, val)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 删除键</span></span><br><span class="line">	_, err = rdb.Del(ctx, <span class="string">&quot;mykey&quot;</span>).Result()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;Error deleting key:&quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">&quot;Key &#x27;mykey&#x27; deleted successfully.&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 再次尝试获取已删除的键</span></span><br><span class="line">	val, err = rdb.Get(ctx, <span class="string">&quot;mykey&quot;</span>).Result()</span><br><span class="line">	<span class="keyword">if</span> err == redis.Nil &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;Key &#x27;mykey&#x27; is now deleted.&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-设置过期时间"><a href="#2-3-设置过期时间" class="headerlink" title="2.3 设置过期时间"></a>2.3 设置过期时间</h3><p>Redis 可以为键设置过期时间，使其在一段时间后自动删除。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/go-redis/redis/v8&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ctx = context.Background()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	rdb := redis.NewClient(&amp;redis.Options&#123;</span><br><span class="line">		Addr: <span class="string">&quot;localhost:6379&quot;</span>,</span><br><span class="line">		DB:   <span class="number">0</span>,</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置一个带过期时间的键 (5 秒后过期)</span></span><br><span class="line">	err := rdb.Set(ctx, <span class="string">&quot;expire_key&quot;</span>, <span class="string">&quot;This key will expire.&quot;</span>, <span class="number">5</span>*time.Second).Err()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;Error setting key with expiry:&quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">&quot;Key &#x27;expire_key&#x27; set with 5s expiry.&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 立即获取</span></span><br><span class="line">	val, _ := rdb.Get(ctx, <span class="string">&quot;expire_key&quot;</span>).Result()</span><br><span class="line">	fmt.Println(<span class="string">&quot;Initial value of &#x27;expire_key&#x27;:&quot;</span>, val)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 等待 6 秒，让键过期</span></span><br><span class="line">	time.Sleep(<span class="number">6</span> * time.Second)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 再次获取，应该已经过期</span></span><br><span class="line">	val, err = rdb.Get(ctx, <span class="string">&quot;expire_key&quot;</span>).Result()</span><br><span class="line">	<span class="keyword">if</span> err == redis.Nil &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;Key &#x27;expire_key&#x27; has expired.&quot;</span>)</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;Error getting expired key:&quot;</span>, err)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;Value of &#x27;expire_key&#x27; (should be expired):&quot;</span>, val)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-在-Gin-中集成-Redis"><a href="#3-在-Gin-中集成-Redis" class="headerlink" title="3. 在 Gin 中集成 Redis"></a>3. 在 Gin 中集成 Redis</h2><p>现在我们将把 Redis 功能集成到 Gin 应用程序中。</p>
<h3 id="3-1-初始化-Redis-客户端"><a href="#3-1-初始化-Redis-客户端" class="headerlink" title="3.1 初始化 Redis 客户端"></a>3.1 初始化 Redis 客户端</h3><p>在 Gin 应用程序启动时，最好只初始化一次 Redis 客户端，并将其作为依赖注入到处理函数中，或者存储在一个全局变量中（但推荐依赖注入）。</p>
<p>我们通常将 Redis 客户端实例存储在 Gin 的 <code>gin.Context</code> 中，或者作为自定义结构体的字段传递。</p>
<p><strong><code>main.go</code></strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/go-redis/redis/v8&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个全局的 Redis 客户端变量 (或者通过依赖注入)</span></span><br><span class="line"><span class="keyword">var</span> Rdb *redis.Client</span><br><span class="line"><span class="keyword">var</span> Ctx = context.Background()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">initRedis</span><span class="params">()</span></span> &#123;</span><br><span class="line">	Rdb = redis.NewClient(&amp;redis.Options&#123;</span><br><span class="line">		Addr:     <span class="string">&quot;localhost:6379&quot;</span>, <span class="comment">// Redis 服务器地址</span></span><br><span class="line">		Password: <span class="string">&quot;&quot;</span>,               <span class="comment">// 如果有密码，请填写</span></span><br><span class="line">		DB:       <span class="number">0</span>,                <span class="comment">// 数据库索引</span></span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 测试连接</span></span><br><span class="line">	pong, err := Rdb.Ping(Ctx).Result()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalf(<span class="string">&quot;Could not connect to Redis: %v&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">&quot;Connected to Redis:&quot;</span>, pong)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 初始化 Redis 客户端</span></span><br><span class="line">	initRedis()</span><br><span class="line"></span><br><span class="line">	router := gin.Default()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 注册 Redis 相关的路由</span></span><br><span class="line">	router.GET(<span class="string">&quot;/set/:key/:value&quot;</span>, setKeyValue)</span><br><span class="line">	router.GET(<span class="string">&quot;/get/:key&quot;</span>, getKeyValue)</span><br><span class="line">	router.DELETE(<span class="string">&quot;/delete/:key&quot;</span>, deleteKey)</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">&quot;Gin server running on :8080&quot;</span>)</span><br><span class="line">	router.Run(<span class="string">&quot;:8080&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-创建-Gin-路由处理-Redis-操作"><a href="#3-2-创建-Gin-路由处理-Redis-操作" class="headerlink" title="3.2 创建 Gin 路由处理 Redis 操作"></a>3.2 创建 Gin 路由处理 Redis 操作</h3><p>接下来，我们将为 Redis 操作创建 Gin 的路由处理函数。</p>
<p><strong><code>main.go</code> (续)</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// setKeyValue 处理 /set/:key/:value 路由，将键值对存储到 Redis</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">setKeyValue</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	key := c.Param(<span class="string">&quot;key&quot;</span>)</span><br><span class="line">	value := c.Param(<span class="string">&quot;value&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置键值对，并设置 1 分钟过期时间</span></span><br><span class="line">	err := Rdb.Set(Ctx, key, value, <span class="number">1</span>*time.Minute).Err()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		c.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;error&quot;</span>: fmt.Sprintf(<span class="string">&quot;Failed to set key: %v&quot;</span>, err)&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;message&quot;</span>: fmt.Sprintf(<span class="string">&quot;Key &#x27;%s&#x27; set successfully with value &#x27;%s&#x27;&quot;</span>, key, value)&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// getKeyValue 处理 /get/:key 路由，从 Redis 获取键的值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getKeyValue</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	key := c.Param(<span class="string">&quot;key&quot;</span>)</span><br><span class="line"></span><br><span class="line">	val, err := Rdb.Get(Ctx, key).Result()</span><br><span class="line">	<span class="keyword">if</span> err == redis.Nil &#123;</span><br><span class="line">		c.JSON(http.StatusNotFound, gin.H&#123;<span class="string">&quot;error&quot;</span>: fmt.Sprintf(<span class="string">&quot;Key &#x27;%s&#x27; not found&quot;</span>, key)&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		c.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;error&quot;</span>: fmt.Sprintf(<span class="string">&quot;Failed to get key: %v&quot;</span>, err)&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;key&quot;</span>: key, <span class="string">&quot;value&quot;</span>: val&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// deleteKey 处理 /delete/:key 路由，从 Redis 删除键</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">deleteKey</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	key := c.Param(<span class="string">&quot;key&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Del 方法返回受影响的键数量</span></span><br><span class="line">	deleted, err := Rdb.Del(Ctx, key).Result()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		c.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;error&quot;</span>: fmt.Sprintf(<span class="string">&quot;Failed to delete key: %v&quot;</span>, err)&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> deleted == <span class="number">0</span> &#123;</span><br><span class="line">		c.JSON(http.StatusNotFound, gin.H&#123;<span class="string">&quot;message&quot;</span>: fmt.Sprintf(<span class="string">&quot;Key &#x27;%s&#x27; not found or already deleted&quot;</span>, key)&#125;)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;message&quot;</span>: fmt.Sprintf(<span class="string">&quot;Key &#x27;%s&#x27; deleted successfully&quot;</span>, key)&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-3-处理错误"><a href="#3-3-处理错误" class="headerlink" title="3.3 处理错误"></a>3.3 处理错误</h3><p>在实际应用中，处理 Redis 操作可能出现的错误至关重要。<code>go-redis</code> 库在键不存在时会返回 <code>redis.Nil</code> 错误，其他网络或 Redis 服务器错误则会返回不同的错误类型。务必对这些错误进行检查和处理。</p>
<h2 id="4-使用-Redis-作为缓存"><a href="#4-使用-Redis-作为缓存" class="headerlink" title="4. 使用 Redis 作为缓存"></a>4. 使用 Redis 作为缓存</h2><p>Redis 最常见的用途之一是作为应用程序的缓存层。我们可以创建一个 Gin 中间件来实现简单的缓存功能。</p>
<h3 id="4-1-实现缓存中间件"><a href="#4-1-实现缓存中间件" class="headerlink" title="4.1 实现缓存中间件"></a>4.1 实现缓存中间件</h3><p>这个中间件将尝试从 Redis 获取响应，如果命中缓存，则直接返回；如果未命中，则继续执行后续处理函数，并将结果缓存起来。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;bytes&quot;</span></span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/go-redis/redis/v8&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ... (initRedis, Rdb, Ctx declarations from previous section)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// CacheMiddleware 是一个简单的缓存中间件</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">CacheMiddleware</span><span class="params">(cacheDuration time.Duration)</span></span> gin.HandlerFunc &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		<span class="comment">// 生成缓存键：通常使用请求的 URL 或更复杂的哈希</span></span><br><span class="line">		cacheKey := <span class="string">&quot;cache:&quot;</span> + c.Request.RequestURI</span><br><span class="line">		log.Printf(<span class="string">&quot;Attempting to fetch from cache for key: %s\n&quot;</span>, cacheKey)</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 尝试从 Redis 获取缓存数据</span></span><br><span class="line">		cachedResponse, err := Rdb.Get(Ctx, cacheKey).Result()</span><br><span class="line">		<span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="comment">// 缓存命中！直接返回缓存的数据</span></span><br><span class="line">			log.Printf(<span class="string">&quot;Cache HIT for key: %s\n&quot;</span>, cacheKey)</span><br><span class="line">			c.Header(<span class="string">&quot;X-Cache&quot;</span>, <span class="string">&quot;HIT&quot;</span>)</span><br><span class="line">			c.Data(http.StatusOK, <span class="string">&quot;application/json&quot;</span>, []<span class="type">byte</span>(cachedResponse))</span><br><span class="line">			c.Abort() <span class="comment">// 阻止后续处理函数执行</span></span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> err == redis.Nil &#123;</span><br><span class="line">			log.Printf(<span class="string">&quot;Cache MISS for key: %s\n&quot;</span>, cacheKey)</span><br><span class="line">			c.Header(<span class="string">&quot;X-Cache&quot;</span>, <span class="string">&quot;MISS&quot;</span>)</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			log.Printf(<span class="string">&quot;Error getting from Redis cache: %v\n&quot;</span>, err)</span><br><span class="line">			<span class="comment">// 如果 Redis 出错，不阻止请求继续执行</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 创建一个响应写入器，捕获响应内容</span></span><br><span class="line">		blw := &amp;bodyLogWriter&#123;body: bytes.NewBufferString(<span class="string">&quot;&quot;</span>), ResponseWriter: c.Writer&#125;</span><br><span class="line">		c.Writer = blw</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 继续处理请求</span></span><br><span class="line">		c.Next()</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 检查状态码，只缓存成功的响应 (200 OK)</span></span><br><span class="line">		<span class="keyword">if</span> c.Writer.Status() == http.StatusOK &#123;</span><br><span class="line">			<span class="comment">// 将响应内容缓存到 Redis</span></span><br><span class="line">			err = Rdb.Set(Ctx, cacheKey, blw.body.String(), cacheDuration).Err()</span><br><span class="line">			<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">				log.Printf(<span class="string">&quot;Error setting Redis cache: %v\n&quot;</span>, err)</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				log.Printf(<span class="string">&quot;Response cached for key: %s, duration: %s\n&quot;</span>, cacheKey, cacheDuration)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// bodyLogWriter 是一个自定义的 ResponseWriter，用于捕获响应体</span></span><br><span class="line"><span class="keyword">type</span> bodyLogWriter <span class="keyword">struct</span> &#123;</span><br><span class="line">	gin.ResponseWriter</span><br><span class="line">	body *bytes.Buffer</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(w bodyLogWriter)</span></span> Write(b []<span class="type">byte</span>) (<span class="type">int</span>, <span class="type">error</span>) &#123;</span><br><span class="line">	w.body.Write(b)</span><br><span class="line">	<span class="keyword">return</span> w.ResponseWriter.Write(b)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(w bodyLogWriter)</span></span> WriteString(s <span class="type">string</span>) (<span class="type">int</span>, <span class="type">error</span>) &#123;</span><br><span class="line">	w.body.WriteString(s)</span><br><span class="line">	<span class="keyword">return</span> w.ResponseWriter.WriteString(s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// main 函数 (续)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	initRedis()</span><br><span class="line">	router := gin.Default()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 应用全局 Logger 中间件</span></span><br><span class="line">	router.Use(gin.Logger())</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置一个带缓存的路由组</span></span><br><span class="line">	cachedGroup := router.Group(<span class="string">&quot;/cached&quot;</span>)</span><br><span class="line">	<span class="comment">// 将缓存中间件应用于此组，缓存 10 秒</span></span><br><span class="line">	cachedGroup.Use(CacheMiddleware(<span class="number">10</span> * time.Second))</span><br><span class="line">	&#123;</span><br><span class="line">		cachedGroup.GET(<span class="string">&quot;/data&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">			log.Println(<span class="string">&quot;Executing /cached/data handler (simulating slow operation)...&quot;</span>)</span><br><span class="line">			time.Sleep(<span class="number">2</span> * time.Second) <span class="comment">// 模拟一个耗时操作</span></span><br><span class="line">			c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;data&quot;</span>: <span class="string">&quot;This is cached data!&quot;</span>, <span class="string">&quot;timestamp&quot;</span>: time.Now().Format(time.RFC3339)&#125;)</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 非缓存路由</span></span><br><span class="line">	router.GET(<span class="string">&quot;/no-cache-data&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		log.Println(<span class="string">&quot;Executing /no-cache-data handler...&quot;</span>)</span><br><span class="line">		c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;data&quot;</span>: <span class="string">&quot;This data is not cached.&quot;</span>, <span class="string">&quot;timestamp&quot;</span>: time.Now().Format(time.RFC3339)&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">&quot;Gin server running on :8080&quot;</span>)</span><br><span class="line">	router.Run(<span class="string">&quot;:8080&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-在路由中使用缓存"><a href="#4-2-在路由中使用缓存" class="headerlink" title="4.2 在路由中使用缓存"></a>4.2 在路由中使用缓存</h3><p>在上面的例子中，我们已经演示了如何将 <code>CacheMiddleware</code> 应用到一个路由组 (<code>/cached</code>)。所有该组下的路由都会受益于缓存。</p>
<p><strong>测试缓存：</strong></p>
<ol>
<li>启动 Gin 服务器。</li>
<li>第一次访问 <code>http://localhost:8080/cached/data</code>：您会看到日志输出 <code>Executing /cached/data handler...</code> 和 <code>Cache MISS</code>，请求会延迟 2 秒。</li>
<li>在 10 秒内再次访问 <code>http://localhost:8080/cached/data</code>：您会看到日志输出 <code>Cache HIT</code>，请求会立即返回，且 <code>timestamp</code> 值与第一次相同（因为它返回的是缓存的数据）。</li>
<li>等待 10 秒以上，再次访问 <code>http://localhost:8080/cached/data</code>：缓存过期，您会再次看到 <code>Cache MISS</code> 和 2 秒延迟，<code>timestamp</code> 值会更新。</li>
<li>访问 <code>http://localhost:8080/no-cache-data</code>：每次访问都会立即返回，没有缓存。</li>
</ol>
<h2 id="5-高级用法（可选）"><a href="#5-高级用法（可选）" class="headerlink" title="5. 高级用法（可选）"></a>5. 高级用法（可选）</h2><h3 id="5-1-Redis-连接池"><a href="#5-1-Redis-连接池" class="headerlink" title="5.1 Redis 连接池"></a>5.1 Redis 连接池</h3><p><code>go-redis</code> 客户端本身就包含了连接池管理。在 <code>redis.NewClient</code> 中，您可以配置 <code>PoolSize</code>、<code>MinIdleConns</code> 等选项来优化连接池行为。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">rdb := redis.NewClient(&amp;redis.Options&#123;</span><br><span class="line">    Addr:         <span class="string">&quot;localhost:6379&quot;</span>,</span><br><span class="line">    Password:     <span class="string">&quot;&quot;</span>,</span><br><span class="line">    DB:           <span class="number">0</span>,</span><br><span class="line">    PoolSize:     <span class="number">10</span>,  <span class="comment">// 最大连接数</span></span><br><span class="line">    MinIdleConns: <span class="number">5</span>,   <span class="comment">// 最小空闲连接数</span></span><br><span class="line">    PoolTimeout:  <span class="number">30</span> * time.Second, <span class="comment">// 从连接池获取连接的超时时间</span></span><br><span class="line">    IdleTimeout:  <span class="number">5</span> * time.Minute,  <span class="comment">// 空闲连接的关闭时间</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="5-2-使用-Redis-实现分布式锁"><a href="#5-2-使用-Redis-实现分布式锁" class="headerlink" title="5.2 使用 Redis 实现分布式锁"></a>5.2 使用 Redis 实现分布式锁</h3><p>当您有多个服务实例需要对共享资源进行互斥访问时，可以使用 Redis 实现分布式锁。<code>go-redis</code> 提供了 <code>SetNX</code>（Set if Not eXists）和 <code>Expire</code> 命令的封装，可以用来构建简单的锁。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/go-redis/redis/v8&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ObtainLock 尝试获取分布式锁</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ObtainLock</span><span class="params">(client *redis.Client, key <span class="type">string</span>, value <span class="type">string</span>, expiration time.Duration)</span></span> (<span class="type">bool</span>, <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="comment">// SetNX 命令在键不存在时设置键值，并设置过期时间</span></span><br><span class="line">	<span class="comment">// 如果设置成功，返回 true；如果键已存在，返回 false</span></span><br><span class="line">	ok, err := client.SetNX(Ctx, key, value, expiration).Result()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>, err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ok, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ReleaseLock 释放分布式锁</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ReleaseLock</span><span class="params">(client *redis.Client, key <span class="type">string</span>, value <span class="type">string</span>)</span></span> (<span class="type">bool</span>, <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="comment">// 使用 Lua 脚本确保原子性：检查值是否匹配，然后删除键</span></span><br><span class="line">	<span class="comment">// 这是为了防止 A 释放了 B 的锁</span></span><br><span class="line">	script := <span class="string">`</span></span><br><span class="line"><span class="string">		if redis.call(&quot;GET&quot;, KEYS[1]) == ARGV[1] then</span></span><br><span class="line"><span class="string">			return redis.call(&quot;DEL&quot;, KEYS[1])</span></span><br><span class="line"><span class="string">		else</span></span><br><span class="line"><span class="string">			return 0</span></span><br><span class="line"><span class="string">		end</span></span><br><span class="line"><span class="string">	`</span></span><br><span class="line">	result, err := client.Eval(Ctx, script, []<span class="type">string</span>&#123;key&#125;, value).Result()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>, err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> result.(<span class="type">int64</span>) == <span class="number">1</span>, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在 Gin 路由中使用</span></span><br><span class="line"><span class="comment">// router.GET(&quot;/lock-resource&quot;, func(c *gin.Context) &#123;</span></span><br><span class="line"><span class="comment">//     lockKey := &quot;my_resource_lock&quot;</span></span><br><span class="line"><span class="comment">//     lockValue := &quot;unique_session_id_123&quot; // 建议使用 UUID 或其他唯一标识</span></span><br><span class="line"><span class="comment">//     lockTTL := 10 * time.Second</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//     locked, err := ObtainLock(Rdb, lockKey, lockValue, lockTTL)</span></span><br><span class="line"><span class="comment">//     if err != nil &#123;</span></span><br><span class="line"><span class="comment">//         c.JSON(http.StatusInternalServerError, gin.H&#123;&quot;error&quot;: &quot;Failed to obtain lock&quot;&#125;)</span></span><br><span class="line"><span class="comment">//         return</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//     if !locked &#123;</span></span><br><span class="line"><span class="comment">//         c.JSON(http.StatusConflict, gin.H&#123;&quot;message&quot;: &quot;Resource is currently locked by another process&quot;&#125;)</span></span><br><span class="line"><span class="comment">//         return</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//     defer func() &#123;</span></span><br><span class="line"><span class="comment">//         released, releaseErr := ReleaseLock(Rdb, lockKey, lockValue)</span></span><br><span class="line"><span class="comment">//         if releaseErr != nil &#123;</span></span><br><span class="line"><span class="comment">//             log.Printf(&quot;Failed to release lock for %s: %v&quot;, lockKey, releaseErr)</span></span><br><span class="line"><span class="comment">//         &#125; else if !released &#123;</span></span><br><span class="line"><span class="comment">//             log.Printf(&quot;Lock %s not released by current process (value mismatch)&quot;, lockKey)</span></span><br><span class="line"><span class="comment">//         &#125; else &#123;</span></span><br><span class="line"><span class="comment">//             log.Printf(&quot;Lock %s released successfully&quot;, lockKey)</span></span><br><span class="line"><span class="comment">//         &#125;</span></span><br><span class="line"><span class="comment">//     &#125;()</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//     // 执行需要加锁的业务逻辑</span></span><br><span class="line"><span class="comment">//     time.Sleep(5 * time.Second) // 模拟业务操作</span></span><br><span class="line"><span class="comment">//     c.JSON(http.StatusOK, gin.H&#123;&quot;message&quot;: &quot;Resource accessed successfully with lock&quot;&#125;)</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br></pre></td></tr></table></figure>

<h3 id="5-3-Pub-Sub（发布-订阅）"><a href="#5-3-Pub-Sub（发布-订阅）" class="headerlink" title="5.3 Pub&#x2F;Sub（发布&#x2F;订阅）"></a>5.3 Pub&#x2F;Sub（发布&#x2F;订阅）</h3><p>Redis 支持发布&#x2F;订阅模式，允许客户端订阅频道并接收其他客户端发布的消息，这在实现实时通知或事件驱动架构时非常有用。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/go-redis/redis/v8&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Rdb *redis.Client</span><br><span class="line"><span class="keyword">var</span> Ctx = context.Background()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">initRedis</span><span class="params">()</span></span> &#123;</span><br><span class="line">	Rdb = redis.NewClient(&amp;redis.Options&#123;</span><br><span class="line">		Addr: <span class="string">&quot;localhost:6379&quot;</span>,</span><br><span class="line">		DB:   <span class="number">0</span>,</span><br><span class="line">	&#125;)</span><br><span class="line">	_, err := Rdb.Ping(Ctx).Result()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalf(<span class="string">&quot;Could not connect to Redis: %v&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">&quot;Connected to Redis for Pub/Sub&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// SubscribeToChannel 订阅一个 Redis 频道</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SubscribeToChannel</span><span class="params">(channel <span class="type">string</span>)</span></span> &#123;</span><br><span class="line">	pubsub := Rdb.Subscribe(Ctx, channel)</span><br><span class="line">	<span class="keyword">defer</span> pubsub.Close() <span class="comment">// 确保订阅器在退出时关闭</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 等待订阅就绪</span></span><br><span class="line">	_, err := pubsub.Receive(Ctx)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Printf(<span class="string">&quot;Error receiving from pubsub: %v&quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	log.Printf(<span class="string">&quot;Subscribed to channel: %s&quot;</span>, channel)</span><br><span class="line"></span><br><span class="line">	ch := pubsub.Channel() <span class="comment">// 获取消息通道</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> msg := <span class="keyword">range</span> ch &#123;</span><br><span class="line">		log.Printf(<span class="string">&quot;Received message from channel &#x27;%s&#x27;: %s&quot;</span>, msg.Channel, msg.Payload)</span><br><span class="line">		<span class="comment">// 在这里处理接收到的消息，例如推送到 WebSocket 客户端</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	initRedis()</span><br><span class="line"></span><br><span class="line">	router := gin.Default()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 启动一个 goroutine 监听 Redis 消息</span></span><br><span class="line">	<span class="keyword">go</span> SubscribeToChannel(<span class="string">&quot;my_chat_channel&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 发布消息的路由</span></span><br><span class="line">	router.GET(<span class="string">&quot;/publish/:message&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		message := c.Param(<span class="string">&quot;message&quot;</span>)</span><br><span class="line">		err := Rdb.Publish(Ctx, <span class="string">&quot;my_chat_channel&quot;</span>, message).Err()</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			c.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;error&quot;</span>: fmt.Sprintf(<span class="string">&quot;Failed to publish message: %v&quot;</span>, err)&#125;)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">		c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;message&quot;</span>: fmt.Sprintf(<span class="string">&quot;Message &#x27;%s&#x27; published to &#x27;my_chat_channel&#x27;&quot;</span>, message)&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">&quot;Gin server running on :8080&quot;</span>)</span><br><span class="line">	router.Run(<span class="string">&quot;:8080&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>测试 Pub&#x2F;Sub：</strong></p>
<ol>
<li>运行上面的 Gin 应用程序。</li>
<li>访问 <code>http://localhost:8080/publish/hello_world</code>。</li>
<li>查看应用程序的控制台输出，您会看到 <code>Received message from channel &#39;my_chat_channel&#39;: hello_world</code>，表明消息已成功发布并被订阅者接收。</li>
</ol>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imgs.161517.xyz/2025/03/27/22-00-44-kid1412.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imgs.161517.xyz/2025/03/27/22-00-44-kid1412.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">King Leonardo</div><div class="post-copyright__author_desc">个人博客</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://example.com/2025/06/02/backend-go/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://example.com/2025/06/02/backend-go/')">Go + Gin</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://imgs.161517.xyz/2025/06/02/wechat-pay-qr.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imgs.161517.xyz/2025/06/02/wechat-pay-qr.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://imgs.161517.xyz/2025/06/02/alipay-qr.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imgs.161517.xyz/2025/06/02/alipay-qr.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://example.com/2025/06/02/backend-go/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=Go + Gin&amp;url=http://example.com/2025/06/02/backend-go/&amp;pic=https://imgs.161517.xyz/2025/05/10/1008.jpg" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">LeoBlog</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/Backend/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>Backend<span class="tagsPageCount">1</span></a><a class="post-meta__box__tags" href="/tags/Go/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>Go<span class="tagsPageCount">1</span></a><a class="post-meta__box__tags" href="/tags/Gin/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>Gin<span class="tagsPageCount">1</span></a><a class="post-meta__box__tags" href="/tags/Viper/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>Viper<span class="tagsPageCount">1</span></a><a class="post-meta__box__tags" href="/tags/GORM/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>GORM<span class="tagsPageCount">1</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://imgs.161517.xyz/2025/05/10/1008.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/03/15/hello-world/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Hello World</div></div></a></div><div class="next-post pull-right"><a href="/2025/06/02/WebBlog/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imgs.161517.xyz/2025/05/10/1010.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Hexo 博客搭建指南</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imgs.161517.xyz/2025/03/27/22-00-44-kid1412.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__description">这是我的个人博客，用于交流、学习技术，欢迎访问！</div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">King Leonardo</h1><div class="author-info__desc">个人博客</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/kingleonardo999" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a></div></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://imgs.161517.xyz/2025/03/27/19-05-30-front.jpg) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://imgs.161517.xyz/2025/03/27/19-00-44-back.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Go-%E9%A1%B9%E7%9B%AE%E5%B7%A5%E7%A8%8B%E5%8C%96%E6%8C%87%E5%8D%97"><span class="toc-number">1.</span> <span class="toc-text">Go 项目工程化指南</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Go-%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%88%9B%E5%BB%BA%E4%B8%8E%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">1.1.</span> <span class="toc-text">1. Go 项目的创建与初始化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E5%88%9D%E5%A7%8B%E5%8C%96%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84-Go-Modules-%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.1 初始化一个新的 Go Modules 项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-Go-%E9%A1%B9%E7%9B%AE%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84"><span class="toc-number">1.1.2.</span> <span class="toc-text">1.2 Go 项目基本结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E6%88%90%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6"><span class="toc-number">1.1.3.</span> <span class="toc-text">1.3 编译和打包成可执行文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-1-%E5%9F%BA%E6%9C%AC%E7%BC%96%E8%AF%91"><span class="toc-number">1.1.3.1.</span> <span class="toc-text">1.3.1 基本编译</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-2-%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91-Cross-Compilation"><span class="toc-number">1.1.3.2.</span> <span class="toc-text">1.3.2 交叉编译 (Cross-Compilation)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-3-%E5%87%8F%E5%B0%8F%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6%E5%A4%A7%E5%B0%8F"><span class="toc-number">1.1.3.3.</span> <span class="toc-text">1.3.3 减小可执行文件大小</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-4-%E7%94%9F%E6%88%90%E9%9D%99%E6%80%81%E9%93%BE%E6%8E%A5%E7%9A%84%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6-%E6%8E%A8%E8%8D%90%E7%94%A8%E4%BA%8E-Docker"><span class="toc-number">1.1.3.4.</span> <span class="toc-text">1.3.4 生成静态链接的二进制文件 (推荐用于 Docker)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E4%BE%9D%E8%B5%96%E7%AE%A1%E7%90%86"><span class="toc-number">1.2.</span> <span class="toc-text">2. 依赖管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E6%B7%BB%E5%8A%A0%E6%96%B0%E7%9A%84%E4%BE%9D%E8%B5%96"><span class="toc-number">1.2.1.</span> <span class="toc-text">2.1 添加新的依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E6%9B%B4%E6%96%B0%E7%8E%B0%E6%9C%89%E4%BE%9D%E8%B5%96"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.2 更新现有依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E7%A7%BB%E9%99%A4%E4%B8%8D%E5%86%8D%E4%BD%BF%E7%94%A8%E7%9A%84%E4%BE%9D%E8%B5%96"><span class="toc-number">1.2.3.</span> <span class="toc-text">2.3 移除不再使用的依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-%E6%9F%A5%E7%9C%8B%E4%BE%9D%E8%B5%96%E5%9B%BE"><span class="toc-number">1.2.4.</span> <span class="toc-text">2.4 查看依赖图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-%E4%BE%9B%E5%BA%94%E5%95%86%E6%A8%A1%E5%BC%8F-Vendor-Mode"><span class="toc-number">1.2.5.</span> <span class="toc-text">2.5 供应商模式 (Vendor Mode)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E6%8B%89%E5%8F%96%E5%88%AB%E4%BA%BA%E7%9A%84-Go-%E9%A1%B9%E7%9B%AE%E5%B9%B6%E4%B8%8B%E8%BD%BD%E4%BE%9D%E8%B5%96"><span class="toc-number">1.3.</span> <span class="toc-text">3. 拉取别人的 Go 项目并下载依赖</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E5%85%8B%E9%9A%86%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.3.1.</span> <span class="toc-text">3.1 克隆项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E4%B8%8B%E8%BD%BD%E5%B9%B6%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96"><span class="toc-number">1.3.2.</span> <span class="toc-text">3.2 下载并安装依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E7%BC%96%E8%AF%91%E5%92%8C%E8%BF%90%E8%A1%8C%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.3.3.</span> <span class="toc-text">3.3 编译和运行项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-%E5%A4%84%E7%90%86%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86%E9%97%AE%E9%A2%98"><span class="toc-number">1.3.4.</span> <span class="toc-text">3.4 处理网络代理问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-%E5%A4%84%E7%90%86%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93%E4%BE%9D%E8%B5%96"><span class="toc-number">1.3.5.</span> <span class="toc-text">3.5 处理私有仓库依赖</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%B8%B8%E8%A7%81%E7%9A%84%E5%B7%A5%E7%A8%8B%E5%8C%96%E9%97%AE%E9%A2%98%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">1.4.</span> <span class="toc-text">4. 常见的工程化问题与解决方案</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E8%A7%A3%E5%86%B3%E4%BE%9D%E8%B5%96%E7%89%88%E6%9C%AC%E5%86%B2%E7%AA%81"><span class="toc-number">1.4.1.</span> <span class="toc-text">4.1 解决依赖版本冲突</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E8%B7%A8%E5%B9%B3%E5%8F%B0%E7%BC%96%E8%AF%91"><span class="toc-number">1.4.2.</span> <span class="toc-text">4.2 跨平台编译</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E4%BB%A3%E7%A0%81%E9%A3%8E%E6%A0%BC%E6%A3%80%E6%9F%A5%E4%B8%8E%E6%A0%BC%E5%BC%8F%E5%8C%96"><span class="toc-number">1.4.3.</span> <span class="toc-text">4.3 代码风格检查与格式化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E4%B8%8E%E9%9B%86%E6%88%90%E6%B5%8B%E8%AF%95"><span class="toc-number">1.4.4.</span> <span class="toc-text">4.4 单元测试与集成测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-Git-%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-number">1.4.5.</span> <span class="toc-text">4.5 Git 版本控制最佳实践</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6-Docker-%E5%8C%96-Go-%E5%BA%94%E7%94%A8"><span class="toc-number">1.4.6.</span> <span class="toc-text">4.6 Docker 化 Go 应用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E8%AF%AD"><span class="toc-number">1.5.</span> <span class="toc-text">结语</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Gin-Web-Framework"><span class="toc-number">2.</span> <span class="toc-text">Gin Web Framework</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-number">2.1.</span> <span class="toc-text">准备工作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%BB%93%E6%9E%84"><span class="toc-number">2.1.1.</span> <span class="toc-text">基础结构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E8%B7%AF%E7%94%B1-Routing"><span class="toc-number">2.2.</span> <span class="toc-text">1. 路由 (Routing)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E5%9F%BA%E6%9C%AC%E8%B7%AF%E7%94%B1"><span class="toc-number">2.2.1.</span> <span class="toc-text">1.1 基本路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E8%B7%AF%E5%BE%84%E5%8F%82%E6%95%B0-Path-Parameters"><span class="toc-number">2.2.2.</span> <span class="toc-text">1.2 路径参数 (Path Parameters)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E6%9F%A5%E8%AF%A2%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8F%82%E6%95%B0-Query-String-Parameters"><span class="toc-number">2.2.3.</span> <span class="toc-text">1.3 查询字符串参数 (Query String Parameters)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-%E8%B7%AF%E7%94%B1%E7%BB%84-Route-Groups"><span class="toc-number">2.2.4.</span> <span class="toc-text">1.4 路由组 (Route Groups)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%8F%82%E6%95%B0%E7%BB%91%E5%AE%9A-Binding"><span class="toc-number">2.3.</span> <span class="toc-text">2. 参数绑定 (Binding)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-JSON-%E8%AF%B7%E6%B1%82%E4%BD%93%E7%BB%91%E5%AE%9A"><span class="toc-number">2.3.1.</span> <span class="toc-text">2.1 JSON 请求体绑定</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-Form-x-www-form-urlencoded-%E6%88%96-multipart-form-data-%E7%BB%91%E5%AE%9A"><span class="toc-number">2.3.2.</span> <span class="toc-text">2.2 Form (x-www-form-urlencoded 或 multipart&#x2F;form-data) 绑定</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E6%9F%A5%E8%AF%A2%E5%8F%82%E6%95%B0%E7%BB%91%E5%AE%9A"><span class="toc-number">2.3.3.</span> <span class="toc-text">2.3 查询参数绑定</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%93%8D%E5%BA%94-Responses"><span class="toc-number">2.4.</span> <span class="toc-text">3. 响应 (Responses)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-JSON-%E5%93%8D%E5%BA%94"><span class="toc-number">2.4.1.</span> <span class="toc-text">3.1 JSON 响应</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E7%BA%AF%E6%96%87%E6%9C%AC%E5%93%8D%E5%BA%94"><span class="toc-number">2.4.2.</span> <span class="toc-text">3.2 纯文本响应</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-HTML-%E5%93%8D%E5%BA%94"><span class="toc-number">2.4.3.</span> <span class="toc-text">3.3 HTML 响应</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-%E9%87%8D%E5%AE%9A%E5%90%91-Redirect"><span class="toc-number">2.4.4.</span> <span class="toc-text">3.4 重定向 (Redirect)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E4%B8%AD%E9%97%B4%E4%BB%B6-Middlewares"><span class="toc-number">2.5.</span> <span class="toc-text">4. 中间件 (Middlewares)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E5%85%A8%E5%B1%80%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">2.5.1.</span> <span class="toc-text">4.1 全局中间件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E8%B7%AF%E7%94%B1%E7%BB%84%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">2.5.2.</span> <span class="toc-text">4.2 路由组中间件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E5%8D%95%E4%B8%AA%E8%B7%AF%E7%94%B1%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">2.5.3.</span> <span class="toc-text">4.3 单个路由中间件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-%E4%B8%AD%E9%97%B4%E4%BB%B6%E4%B8%AD%E7%9A%84%E4%B8%8A%E4%B8%8B%E6%96%87%E6%95%B0%E6%8D%AE%E4%BC%A0%E9%80%92"><span class="toc-number">2.5.4.</span> <span class="toc-text">4.4 中间件中的上下文数据传递</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86-Error-Handling"><span class="toc-number">2.6.</span> <span class="toc-text">5. 错误处理 (Error Handling)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">2.7.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#GORM-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C%E9%80%9F%E6%9F%A5%E6%89%8B%E5%86%8C"><span class="toc-number">3.</span> <span class="toc-text">GORM 数据库操作速查手册</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C-1"><span class="toc-number">3.1.</span> <span class="toc-text">准备工作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E4%B8%8E%E6%A8%A1%E5%9E%8B%E5%AE%9A%E4%B9%89"><span class="toc-number">3.1.1.</span> <span class="toc-text">数据库连接与模型定义</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE-Create"><span class="toc-number">3.2.</span> <span class="toc-text">1. 插入数据 (Create)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E6%8F%92%E5%85%A5%E5%8D%95%E6%9D%A1%E8%AE%B0%E5%BD%95"><span class="toc-number">3.2.1.</span> <span class="toc-text">1.1 插入单条记录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E6%89%B9%E9%87%8F%E6%8F%92%E5%85%A5%E8%AE%B0%E5%BD%95"><span class="toc-number">3.2.2.</span> <span class="toc-text">1.2 批量插入记录</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE-Retrieve"><span class="toc-number">3.3.</span> <span class="toc-text">2. 查询数据 (Retrieve)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E6%A0%B9%E6%8D%AE%E4%B8%BB%E9%94%AE%E6%9F%A5%E8%AF%A2-First-Find"><span class="toc-number">3.3.1.</span> <span class="toc-text">2.1 根据主键查询 (First &#x2F; Find)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E6%A0%B9%E6%8D%AE%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2-Where"><span class="toc-number">3.3.2.</span> <span class="toc-text">2.2 根据条件查询 (Where)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E6%9F%A5%E8%AF%A2%E6%89%80%E6%9C%89%E8%AE%B0%E5%BD%95-Find"><span class="toc-number">3.3.3.</span> <span class="toc-text">2.3 查询所有记录 (Find)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-%E6%8E%92%E5%BA%8F%E3%80%81%E9%99%90%E5%88%B6%E5%92%8C%E5%81%8F%E7%A7%BB-Order-Limit-Offset"><span class="toc-number">3.3.4.</span> <span class="toc-text">2.4 排序、限制和偏移 (Order, Limit, Offset)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE-Update"><span class="toc-number">3.4.</span> <span class="toc-text">3. 更新数据 (Update)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E6%9B%B4%E6%96%B0%E5%8D%95%E4%B8%AA%E5%AD%97%E6%AE%B5-Update"><span class="toc-number">3.4.1.</span> <span class="toc-text">3.1 更新单个字段 (Update)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E6%9B%B4%E6%96%B0%E5%A4%9A%E4%B8%AA%E5%AD%97%E6%AE%B5-Updates"><span class="toc-number">3.4.2.</span> <span class="toc-text">3.2 更新多个字段 (Updates)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E8%AE%A1%E6%95%B0%E5%99%A8%E6%9B%B4%E6%96%B0-Inc-Dec"><span class="toc-number">3.4.3.</span> <span class="toc-text">3.3 计数器更新 (Inc &#x2F; Dec)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE-Delete"><span class="toc-number">3.5.</span> <span class="toc-text">4. 删除数据 (Delete)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E8%BD%AF%E5%88%A0%E9%99%A4-Soft-Delete"><span class="toc-number">3.5.1.</span> <span class="toc-text">4.1 软删除 (Soft Delete)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E7%A1%AC%E5%88%A0%E9%99%A4-Permanent-Delete"><span class="toc-number">3.5.2.</span> <span class="toc-text">4.2 硬删除 (Permanent Delete)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-1"><span class="toc-number">3.6.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Viper-%E6%9E%81%E7%AE%80%E9%85%8D%E7%BD%AE%E8%AF%BB%E5%8F%96%E6%8C%87%E5%8D%97"><span class="toc-number">4.</span> <span class="toc-text">Viper 极简配置读取指南</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%AE%89%E8%A3%85-Viper"><span class="toc-number">4.1.</span> <span class="toc-text">1. 安装 Viper</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%87%86%E5%A4%87%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">4.2.</span> <span class="toc-text">2. 准备配置文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E7%BC%96%E5%86%99-Go-%E4%BB%A3%E7%A0%81%E8%AF%BB%E5%8F%96%E9%85%8D%E7%BD%AE%E5%B9%B6%E7%BB%91%E5%AE%9A%E5%88%B0%E7%BB%93%E6%9E%84%E4%BD%93"><span class="toc-number">4.3.</span> <span class="toc-text">3. 编写 Go 代码读取配置并绑定到结构体</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E8%BF%90%E8%A1%8C%E4%BD%A0%E7%9A%84%E7%A8%8B%E5%BA%8F"><span class="toc-number">4.4.</span> <span class="toc-text">4. 运行你的程序</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E4%BD%93%E7%BB%91%E5%AE%9A%E5%B0%8F%E8%B4%B4%E5%A3%AB%EF%BC%9A"><span class="toc-number">4.4.1.</span> <span class="toc-text">结构体绑定小贴士：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis-%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">5.</span> <span class="toc-text">Redis 的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">5.1.</span> <span class="toc-text">1. 环境准备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E5%AE%89%E8%A3%85-Go-Redis-%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">5.1.1.</span> <span class="toc-text">1.1 安装 Go Redis 客户端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E5%AE%89%E8%A3%85%E5%92%8C%E8%BF%90%E8%A1%8C-Redis-%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">5.1.2.</span> <span class="toc-text">1.2 安装和运行 Redis 服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-Redis-%E9%85%8D%E7%BD%AE%E4%BF%AE%E6%94%B9-Windows"><span class="toc-number">5.1.3.</span> <span class="toc-text">1.3 Redis 配置修改 (Windows)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-1-%E6%89%BE%E5%88%B0-Redis-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">5.1.3.1.</span> <span class="toc-text">1.3.1 找到 Redis 配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-2-%E4%B8%BB%E8%A6%81%E9%85%8D%E7%BD%AE%E9%A1%B9%E6%9B%B4%E6%94%B9"><span class="toc-number">5.1.3.2.</span> <span class="toc-text">1.3.2 主要配置项更改</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-3-%E9%87%8D%E5%90%AF-Redis-Windows"><span class="toc-number">5.1.3.3.</span> <span class="toc-text">1.3.3 重启 Redis (Windows)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-3-3-1-%E4%BD%9C%E4%B8%BA-Windows-%E6%9C%8D%E5%8A%A1%E8%BF%90%E8%A1%8C"><span class="toc-number">5.1.3.3.1.</span> <span class="toc-text">1.3.3.1 作为 Windows 服务运行</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-3-3-2-%E9%80%9A%E8%BF%87%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%89%8B%E5%8A%A8%E8%BF%90%E8%A1%8C"><span class="toc-number">5.1.3.3.2.</span> <span class="toc-text">1.3.3.2 通过命令行手动运行</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%9F%BA%E6%9C%AC-Redis-%E6%93%8D%E4%BD%9C"><span class="toc-number">5.2.</span> <span class="toc-text">2. 基本 Redis 操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E8%BF%9E%E6%8E%A5-Redis"><span class="toc-number">5.2.1.</span> <span class="toc-text">2.1 连接 Redis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E8%AE%BE%E7%BD%AE%E5%92%8C%E8%8E%B7%E5%8F%96%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">5.2.2.</span> <span class="toc-text">2.2 设置和获取字符串</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E8%AE%BE%E7%BD%AE%E8%BF%87%E6%9C%9F%E6%97%B6%E9%97%B4"><span class="toc-number">5.2.3.</span> <span class="toc-text">2.3 设置过期时间</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%9C%A8-Gin-%E4%B8%AD%E9%9B%86%E6%88%90-Redis"><span class="toc-number">5.3.</span> <span class="toc-text">3. 在 Gin 中集成 Redis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E5%88%9D%E5%A7%8B%E5%8C%96-Redis-%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">5.3.1.</span> <span class="toc-text">3.1 初始化 Redis 客户端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E5%88%9B%E5%BB%BA-Gin-%E8%B7%AF%E7%94%B1%E5%A4%84%E7%90%86-Redis-%E6%93%8D%E4%BD%9C"><span class="toc-number">5.3.2.</span> <span class="toc-text">3.2 创建 Gin 路由处理 Redis 操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E5%A4%84%E7%90%86%E9%94%99%E8%AF%AF"><span class="toc-number">5.3.3.</span> <span class="toc-text">3.3 处理错误</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E4%BD%BF%E7%94%A8-Redis-%E4%BD%9C%E4%B8%BA%E7%BC%93%E5%AD%98"><span class="toc-number">5.4.</span> <span class="toc-text">4. 使用 Redis 作为缓存</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E5%AE%9E%E7%8E%B0%E7%BC%93%E5%AD%98%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">5.4.1.</span> <span class="toc-text">4.1 实现缓存中间件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E5%9C%A8%E8%B7%AF%E7%94%B1%E4%B8%AD%E4%BD%BF%E7%94%A8%E7%BC%93%E5%AD%98"><span class="toc-number">5.4.2.</span> <span class="toc-text">4.2 在路由中使用缓存</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%89"><span class="toc-number">5.5.</span> <span class="toc-text">5. 高级用法（可选）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-Redis-%E8%BF%9E%E6%8E%A5%E6%B1%A0"><span class="toc-number">5.5.1.</span> <span class="toc-text">5.1 Redis 连接池</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E4%BD%BF%E7%94%A8-Redis-%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81"><span class="toc-number">5.5.2.</span> <span class="toc-text">5.2 使用 Redis 实现分布式锁</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-Pub-Sub%EF%BC%88%E5%8F%91%E5%B8%83-%E8%AE%A2%E9%98%85%EF%BC%89"><span class="toc-number">5.5.3.</span> <span class="toc-text">5.3 Pub&#x2F;Sub（发布&#x2F;订阅）</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/06/02/WebBlog/" title="Hexo 博客搭建指南"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imgs.161517.xyz/2025/05/10/1010.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Hexo 博客搭建指南"/></a><div class="content"><a class="title" href="/2025/06/02/WebBlog/" title="Hexo 博客搭建指南">Hexo 博客搭建指南</a><time datetime="2025-06-02T14:18:48.373Z" title="发表于 2025-06-02 22:18:48">2025-06-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/02/backend-go/" title="Go + Gin"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imgs.161517.xyz/2025/05/10/1008.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Go + Gin"/></a><div class="content"><a class="title" href="/2025/06/02/backend-go/" title="Go + Gin">Go + Gin</a><time datetime="2025-06-02T12:30:45.605Z" title="发表于 2025-06-02 20:30:45">2025-06-02</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/03/15/hello-world/" title="Hello World">Hello World</a><time datetime="2025-03-15T03:32:28.488Z" title="发表于 2025-03-15 11:32:28">2025-03-15</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2025 By <a class="footer-bar-link" href="/" title="King Leonardo" target="_blank">King Leonardo</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">3</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">9</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">4</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Backend/" style="font-size: 0.88rem;">Backend<sup>1</sup></a><a href="/tags/GORM/" style="font-size: 0.88rem;">GORM<sup>1</sup></a><a href="/tags/Gin/" style="font-size: 0.88rem;">Gin<sup>1</sup></a><a href="/tags/Go/" style="font-size: 0.88rem;">Go<sup>1</sup></a><a href="/tags/Hexo/" style="font-size: 0.88rem;">Hexo<sup>1</sup></a><a href="/tags/Markdown/" style="font-size: 0.88rem;">Markdown<sup>1</sup></a><a href="/tags/Viper/" style="font-size: 0.88rem;">Viper<sup>1</sup></a><a href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" style="font-size: 0.88rem;">前端开发<sup>1</sup></a><a href="/tags/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/" style="font-size: 0.88rem;">博客搭建<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("03/15/2025 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2025 By 安知鱼 V1.6.14",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 King Leonardo 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>